<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />

    <style>
      body {
        --font: Roboto, Arial, 'Bitstream Vera Sans', sans-serif;
        --mono-font: Roboto Mono, monospace;

        background: var(--background);
        color: var(--on-background);
        margin: 0;
        padding: 0;
      }

      * {
        font-size: 14px;
        font-family: var(--font);
        box-sizing: border-box;
      }

      code,
      pre {
        font-family: var(--mono-font);
      }

      body.resizing {
        user-select: none;
      }

      select,
      option {
        border-radius: 4px;
        margin: 0;
        padding: 4px 4px;
        background-color: var(--surface);
        color: var(--on-surface);
        fill: var(--on-surface);
        line-height: 20px;
        vertical-align: middle;
      }

      select {
        border: solid 1px var(--on-surface);
        border-radius: 4px;
        overflow: hidden;
        margin: 8px;
      }

      option:hover {
        background-color: var(--surface-1dp);
      }

      option:focus {
        background-color: var(--primary);
        color: var(--on-primary);
        transition: background-color 0.1s cubic-bezier(0.4, 0, 0.2, 1);
      }

      option:checked {
        background-color: var(--primary);
        color: var(--on-primary);
        fill: var(--on-primary);
      }

      select {
        overflow-y: auto;
      }

      .input-like,
      input {
        border: solid 1px var(--on-surface);
        color: var(--on-surface);
        background: var(--surface);
        display: inline-block;
        border-radius: 4px;
        margin: 4px 2px;
        padding: 4px 4px;
      }

      .button-like,
      button {
        align-items: center;
        background: transparent;
        border-radius: 4px;
        border: solid 1px var(--on-surface);
        box-shadow: none;
        color: var(--on-surface);
        display: inline-flex;
        fill: var(--on-surface);
        font-size: 14px;
        height: 24px;
        justify-content: center;
        margin: 4px 2px;
        min-width: auto;
        padding: 0 4px;
        text-align: center;
        text-transform: none;

        svg {
          width: 20px;
          height: 20px;
        }

        &:active {
          background: var(--surface-2dp);
        }
      }

      .button-like:hover,
      button.hover,
      button:hover,
      .button-like:focus,
      button.focus,
      button:focus {
        opacity: 0.85;
        outline: none;
        background-color: var(--surface-1dp);
      }

      .button-like:disabled,
      button:disabled {
        opacity: 0.85;
        background: var(--on-disabled);
        color: var(--disabled);
        fill: var(--disabled);
      }

      .button-like-action,
      .button-like.action,
      button.action {
        color: var(--on-primary);
        fill: var(--on-primary);
        border: none;
        background: var(--surface-1dp);
      }

      .button-like.action:hover,
      button.action.hover,
      button.action:hover {
        opacity: 0.85;
      }

      .button-like.action:disabled,
      button.action.disabled,
      button.action:disabled {
        opacity: 0.85;
        background: var(--on-disabled);
        color: var(--disabled);
        fill: var(--disabled);
      }

      chart-parent {
        grid-area: chart;
        overflow-y: scroll;
        scrollbar-color: var(--transparent-overlay) rgb(0, 0, 0, 0);
      }

      timeline-parent {
        grid-area: timeline;
        overflow-y: scroll;
        scrollbar-color: rgb(0, 0, 0, 0) rgb(0, 0, 0, 0);
      }

      #overlay {
        position: absolute;
        top: 0;
        left: 0;
      }

      vertical-divider {
        grid-area: vertical-divider;
        display: flex;
        flex-direction: column;
        cursor: col-resize;
        justify-content: center;

        divider-thumb {
          display: inline-block;
          background:
            linear-gradient(315deg, transparent 75%, #414141 0)-10px 0,
            linear-gradient(45deg, transparent 75%, #d1d1d1 0)-10px 0,
            linear-gradient(135deg, #b1b1b1 50%, transparent 0) 0 0,
            linear-gradient(45deg, #515050 50%, #2d2d2d 0) 0 0 #313030;
          background-size: 4px 4px;
          height: 40px;
        }

        &.dragging {
          background: var(--surface-2dp);
        }
      }

      panels-parent {
        grid-area: panels;

        ul li {
          cursor: pointer;
        }
      }

      header {
        grid-area: header;
      }

      footer {
        grid-area: footer;
      }

      explan-main {
        display: grid;
        grid-gap: 0;
        grid-template-columns: 70% 10px auto;
        grid-template-rows: auto auto 1fr auto;
        grid-template-areas:
          'header   header           header'
          'timeline vertical-divider panels'
          'chart    vertical-divider panels'
          'footer   footer           footer';

        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        position: absolute;
      }

      error-popup {
        padding: 16px;
        border: solid 1px;
        border-radius: 8px;
        display: flex;
        position: absolute;
        bottom: 16px;
        left: 16px;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        animation-name: popup;
        animation-duration: 0.5s;
      }

      @keyframes popup {
        from {
          bottom: 0;
        }

        to {
          bottom: 16px;
        }
      }

      chart-parent,
      timeline-parent,
      radar-parent,
      chart-parent {
        display: flex;
        position: relative;
      }

      search-task-panel {
        border-bottom: solid 1px var(--on-surface-muted);
        display: block;
      }

      selected-task-panel,
      dependencies-panel,
      task-completion-panel,
      simulation-panel {
        display: block;
        padding: 8px;

        .aligned-td {
          display: flex;
          align-items: center;
        }
      }

      selected-task-panel td.task-description {
        display: flex;

        p a {
          color: var(--on-surface-muted);
        }
      }

      image-export-panel {
        input:invalid {
          background-color: var(--error);
          color: var(--on-error);
        }
      }

      panels-parent {
        display: block;

        tab-buttons {
          display: block;
          padding-left: 12px;

          button {
            opacity: 0.7;
          }

          button.selected {
            opacity: 1;
          }
        }

        tab-panel {
          display: block;
          background-color: var(--surface);
          margin-top: 0;
          padding: 12px;
          border-radius: 12px;
          margin: 8px 16px 8px 8px;

          h3 {
            margin-top: 0;
          }
        }
      }

      nav {
        display: flex;
        padding: 8px;
        justify-content: space-between;

        button.icon-button {
          background: var(--background);
          border: none;
        }
      }

      .hidden {
        display: none;
      }

      button[disabled] {
        color: var(--disabled);
        fill: var(--disabled);
      }

      task-search-control {
        ul {
          list-style-type: none;
          padding-inline-start: 4px;

          li {
            font-family: 'Courier New', Courier, monospace;
            padding: 4px;

            b {
              color: var(--primary);
            }
          }

          li[data-focus] {
            color: var(--primary);
            outline: dashed 1px;
          }

          li:hover {
            text-decoration: underline;
          }
        }

        ul {
          display: none;
        }

        &:focus-within ul {
          display: block;
        }
      }

      dependencies-panel {
        display: block;

        th {
          text-align: left;
        }

        button.delete {
          border-radius: 2px;
          border: solid 1px var(--surface);
          background: var(--surface);
          color: var(--on-surface);

          &:hover {
            border: solid 1px var(--on-surface-muted);
          }

          &:active {
            background: var(--surface-1dp);
          }
        }
      }

      simulation-panel {
        .added {
          color: var(--added);
        }

        .removed {
          color: var(--removed);
        }

        table.paths td {
          cursor: pointer;
        }
      }

      plan-config-panel > div {
        margin-left: 8px;
      }

      edit-metrics-panel,
      edit-resources-panel {
        td,
        th {
          padding: 8px;
          text-align: left;
        }
      }
      edit-resource-definition p {
        font-size: 80%;
        color: var(--on-surface-muted);
        margin: 0;
        padding: 0;
      }

      .icon-button {
        background-color: var(--surface);
        border-radius: 2px;
        border: solid 1px var(--surface);
        background: var(--surface);
        color: var(--on-surface);
        fill: var(--on-surface-muted);

        &:hover {
          border: dashed 1px var(--on-surface-muted);
        }

        &:active {
          background: var(--surface-1dp);
        }
      }

      dialog {
        background: var(--surface);
        color: var(--on-surface);

        .dialog-footer {
          display: flex;
          flex-direction: row;
          justify-content: right;
          padding: 16px 0 0 0;
        }
      }

      .underline-first-char:first-letter {
        text-decoration: underline;
      }

      #project-tab {
        h3 {
          margin-top: 8px;
          text-decoration: underline;
        }
      }

      body {
        --primary: hsl(214, 70%, 47%);
        --on-primary: #ffffff;
        --primary-variant: rgba(59, 114, 177, 0.2);
        --on-primary-variant: #000000;
        --secondary: hsl(136, 54%, 40%);
        --secondary-variant: hsl(137, 7%, 79%);
        --on-secondary: #000000;
        --background: #fafafa;
        --on-background: #000000;
        --surface: #ffffff;
        --on-surface: #000000;
        --on-surface-muted: hsl(0, 0%, 24%);
        --surface-1dp: #eee;
        --surface-2dp: #bdbdbd;
        --disabled: #f5f5f5;
        --on-disabled: #616161;
        --error: #b71c1c;
        --on-error: #ffffff;
        --transparent-overlay: rgba(0, 0, 0, 0.25);
        --group-color: rgba(90, 206, 6, 0.15);

        --added: rgba(24, 132, 47);
        --removed: rgba(175, 15, 29);
      }

      body.darkmode {
        input {
          color-scheme: dark;
        }

        --primary: hsl(210, 72%, 45%);
        --on-primary: #000000;
        --primary-variant: rgba(59, 114, 177, 0.2);
        --on-primary-variant: #ffffff;
        --secondary: hsl(146, 75%, 33%);
        --secondary-variant: hsl(150, 2%, 22%);
        --on-secondary: #000000;
        --background: #000000;
        --on-background: #ffffff;
        --surface: #0f0f0f;
        --surface-1dp: #424242;
        --surface-2dp: #616161;
        --disabled: #757575;
        --on-disabled: #e0e0e0;
        --on-surface: #ffffff;
        --on-surface-muted: hsl(0, 0%, 74%);
        --error: #ec407a;
        --on-error: #000000;
        --transparent-overlay: rgba(255, 255, 255, 0.1);
        --group-color: rgba(89, 206, 6, 0.1);

        --added: rgb(36, 180, 67);
        --removed: rgb(227, 22, 39);
      }
    </style>
  </head>

  <body class="darkmode">
    <!-- These are hidden because they are never displayed, but used as templates
    for actual icons via the <use> tag. See `/icons/icons.ts`.

    Icons copied from https://github.com/marella/material-design-icons/blob/main/svg/filled/.
    View all icons here: https://fonts.google.com/icons
    -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      style="display: none"
    >
      <path
        id="delete-icon"
        d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"
      />
      <path
        id="edit-icon"
        d="m14.06 9.02.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83a.996.996 0 0 0 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"
      />
      <path
        id="keyboard-up-icon"
        d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"
      />
      <path
        id="keyboard-down-icon"
        d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"
      />
      <g id="keyboard-double-up-icon">
        <path d="M6 17.59 7.41 19 12 14.42 16.59 19 18 17.59l-6-6z" />
        <path d="m6 11 1.41 1.41L12 7.83l4.59 4.58L18 11l-6-6z" />
      </g>
      <g id="keyboard-double-down-icon">
        <path d="M18 6.41 16.59 5 12 9.58 7.41 5 6 6.41l6 6z" />
        <path d="m18 13-1.41-1.41L12 16.17l-4.59-4.58L6 13l6 6z" />
      </g>
      <path id="add-icon" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
      <path id="check" d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
      <path
        id="dup"
        d="M18 4v5H6V4h12m0-2H6c-1.1 0-2 .9-2 2v5c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 13v5H6v-5h12m0-2H6c-1.1 0-2 .9-2 2v5c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-5c0-1.1-.9-2-2-2z"
      />
      <g id="split">
        <path
          d="M 0.046875 7.65625 L 0.046875 9.65625 L 9.4003906 9.65625 L 9.4003906 14.65625 L 0.046875 14.65625 L 0.046875 16.65625 L 9.4003906 16.65625 C 10.50039 16.65625 11.400391 15.756249 11.400391 14.65625 L 11.400391 9.65625 C 11.400391 8.5562511 10.50039 7.65625 9.4003906 7.65625 L 0.046875 7.65625 z "
        />
        <path
          d="M 15.429688 7.6289062 C 14.329689 7.6289062 13.429688 8.5289073 13.429688 9.6289062 L 13.429688 14.628906 C 13.429688 15.728905 14.329689 16.628906 15.429688 16.628906 L 24.046875 16.628906 L 24.046875 14.628906 L 15.429688 14.628906 L 15.429688 9.6289062 L 24.046875 9.6289062 L 24.046875 7.6289062 L 15.429688 7.6289062 z "
        />
      </g>
      <path
        id="calculate"
        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5.97 4.06L14.09 6l1.41 1.41L16.91 6l1.06 1.06-1.41 1.41 1.41 1.41-1.06 1.06-1.41-1.4-1.41 1.41-1.06-1.06 1.41-1.41-1.41-1.42zm-6.78.66h5v1.5h-5v-1.5zM11.5 16h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2V16zm6.5 1.25h-5v-1.5h5v1.5zm0-2.5h-5v-1.5h5v1.5z"
      />
      <path
        id="search"
        d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
      />
      />
    </svg>
    <explan-main>
      <header>
        <nav>
          <span>
            <label> Group by <groupby-control></groupby-control> </label>
            <label>
              <input type="checkbox" id="radar-toggle" checked />
              Show radar.
            </label>
            <button id="reset-zoom">Reset Zoom</button>
            <label>
              <input type="checkbox" id="critical-paths-toggle" />
              Only show critical paths
            </label>
            <span id="download-controls">
              <button id="download-button">Download PNG</button>
              <button id="download-json">Download JSON</button>
              <a id="download-link" download="plan.png" class="hidden" href=""
                >Download</a
              >
            </span>
            <label id="upload">
              Upload
              <input
                type="file"
                id="file-upload"
                accept="image/png, application/json"
            /></label>
            <button
              id="catchup"
              title="Set the completion of all tasks to match today."
            >
              Catch Up All
            </button>
          </span>
          <button
            id="dark-mode-toggle"
            class="icon-button"
            title="Toggle between light mode and dark mode."
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
            >
              <path
                id="invert-colors"
                d="M12 4.81V19c-3.31 0-6-2.63-6-5.87 0-1.56.62-3.03 1.75-4.14L12 4.81M6.35 7.56C4.9 8.99 4 10.96 4 13.13 4 17.48 7.58 21 12 21s8-3.52 8-7.87c0-2.17-.9-4.14-2.35-5.57L12 2 6.35 7.56z"
              />
            </svg>
          </button>
        </nav>
        <radar-parent>
          <canvas id="radar" width="1000" height="1000"></canvas>
        </radar-parent>
      </header>
      <timeline-parent>
        <canvas id="timeline" width="1000" height="1000"></canvas>
      </timeline-parent>
      <chart-parent>
        <canvas id="zoomed" width="1000" height="1000"></canvas>
        <canvas id="overlay" width="1000" height="1000"></canvas>
      </chart-parent>
      <vertical-divider>
        <divider-thumb></divider-thumb>
      </vertical-divider>
      <panels-parent>
        <tab-buttons>
          <button data-target="task-tab" class="selected">Task</button>
          <button data-target="project-tab">Project</button>
          <button data-target="simulate-tab">Simulation</button>
          <button data-target="config-tab">Config</button>
        </tab-buttons>
        <tab-panel id="task-tab">
          <search-task-panel class="hidden">
            <task-search-control></task-search-control>
          </search-task-panel>
          <selected-task-panel> </selected-task-panel>
          <task-completion-panel> </task-completion-panel>
          <dependencies-panel> </dependencies-panel>
        </tab-panel>
        <tab-panel id="project-tab" class="hidden">
          <plan-config-panel> </plan-config-panel>
          <edit-resources-panel> </edit-resources-panel>
          <edit-metrics-panel> </edit-metrics-panel>
        </tab-panel>
        <tab-panel id="simulate-tab" class="hidden">
          <button id="simulate">Simulate</button>
          <simulation-panel> </simulation-panel>
        </tab-panel>
        <tab-panel id="config-tab" class="hidden">
          <image-export-panel> </image-export-panel>
        </tab-panel>
      </panels-parent>
      <footer></footer>
      <keyboard-map-dialog> </keyboard-map-dialog>
      <add-dependency-dialog>
        <dialog>
          <h2>Predecessor/Successor</h2>
          <task-search-control></task-search-control>
          <div class="dialog-footer">
            <button id="dependency-cancel">Cancel</button>
          </div>
        </dialog>
      </add-dependency-dialog>
      <edit-resource-definition> </edit-resource-definition>
      <edit-metric-definition> </edit-metric-definition>
      <developer-panel> </developer-panel>
      <error-popup class="hidden"> </error-popup>
      <prompt-dialog>
        <dialog>
          <h3></h3>
          <input type="text" />
          <div class="dialog-footer">
            <button id="prompt-cancel">Cancel</button>
            <button id="prompt-ok">OK</button>
          </div>
        </dialog>
      </prompt-dialog>
      <edit-description-dialog>
        <dialog>
          <h3>Description</h3>
          <textarea rows="5" cols="80"> </textarea>
          <div class="dialog-footer">
            <button id="description-cancel">Cancel</button>
            <button id="description-ok">OK</button>
          </div>
        </dialog>
      </edit-description-dialog>
    </explan-main>
    
    <script type="module">
      "use strict";(()=>{var Ja=Object.create;var io=Object.defineProperty;var Xa=Object.getOwnPropertyDescriptor;var Ya=Object.getOwnPropertyNames;var Qa=Object.getPrototypeOf,Za=Object.prototype.hasOwnProperty;var el=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var tl=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ya(e))!Za.call(n,i)&&i!==t&&io(n,i,{get:()=>e[i],enumerable:!(r=Xa(e,i))||r.enumerable});return n};var nl=(n,e,t)=>(t=n!=null?Ja(Qa(n)):{},tl(e||!n||!n.__esModule?io(t,"default",{value:n,enumerable:!0}):t,n));var wa=el((Sa,Ei)=>{((n,e)=>{typeof define=="function"&&define.amd?define([],e):typeof Ei=="object"&&Ei.exports?Ei.exports=e():n.fuzzysort=e()})(Sa,n=>{"use strict";var e=(f,d)=>{if(!f||!d)return Q;var y=T(f);he(d)||(d=m(d));var M=y.bitflags;return(M&d._bitflags)!==M?Q:P(y,d)},t=(f,d,y)=>{if(!f)return y?.all?S(d,y):pt;var M=T(f),E=M.bitflags,x=M.containsSpace,b=u(y?.threshold||0),w=y?.limit||ke,R=0,N=0,L=d.length;function K(mt){R<w?(Rt.add(mt),++R):(++N,mt._score>Rt.peek()._score&&Rt.replaceTop(mt))}if(y?.key)for(var G=y.key,F=0;F<L;++F){var pe=d[F],j=Re(pe,G);if(j&&(he(j)||(j=m(j)),(E&j._bitflags)===E)){var J=P(M,j);J!==Q&&(J._score<b||(J.obj=pe,K(J)))}}else if(y?.keys){var st=y.keys,De=st.length;e:for(var F=0;F<L;++F){var pe=d[F];{for(var me=0,B=0;B<De;++B){var G=st[B],j=Re(pe,G);if(!j){ze[B]=it;continue}he(j)||(j=m(j)),ze[B]=j,me|=j._bitflags}if((E&me)!==E)continue}if(x)for(let W=0;W<M.spaceSearches.length;W++)de[W]=ee;for(var B=0;B<De;++B){if(j=ze[B],j===it){be[B]=it;continue}if(be[B]=P(M,j,!1,x),be[B]===Q){be[B]=it;continue}if(x)for(let X=0;X<M.spaceSearches.length;X++){if(ve[X]>-1e3&&de[X]>ee){var ae=(de[X]+ve[X])/4;ae>de[X]&&(de[X]=ae)}ve[X]>de[X]&&(de[X]=ve[X])}}if(x){for(let W=0;W<M.spaceSearches.length;W++)if(de[W]===ee)continue e}else{var U=!1;for(let W=0;W<De;W++)if(be[W]._score!==ee){U=!0;break}if(!U)continue}var Te=new a(De);for(let W=0;W<De;W++)Te[W]=be[W];if(x){var ie=0;for(let W=0;W<M.spaceSearches.length;W++)ie+=de[W]}else{var ie=ee;for(let X=0;X<De;X++){var J=Te[X];if(J._score>-1e3&&ie>ee){var ae=(ie+J._score)/4;ae>ie&&(ie=ae)}J._score>ie&&(ie=J._score)}}if(Te.obj=pe,Te._score=ie,y?.scoreFn){if(ie=y.scoreFn(Te),!ie)continue;ie=u(ie),Te._score=ie}ie<b||K(Te)}}else for(var F=0;F<L;++F){var j=d[F];if(j&&(he(j)||(j=m(j)),(E&j._bitflags)===E)){var J=P(M,j);J!==Q&&(J._score<b||K(J))}}if(R===0)return pt;for(var ot=new Array(R),F=R-1;F>=0;--F)ot[F]=Rt.poll();return ot.total=R+N,ot},r=(f,d="<b>",y="</b>")=>{for(var M=typeof d=="function"?d:void 0,E=f.target,x=E.length,b=f.indexes,w="",R=0,N=0,L=!1,K=[],G=0;G<x;++G){var F=E[G];if(b[N]===G){if(++N,L||(L=!0,M?(K.push(w),w=""):w+=d),N===b.length){M?(w+=F,K.push(M(w,R++)),w="",K.push(E.substr(G+1))):w+=F+y+E.substr(G+1);break}}else L&&(L=!1,M?(K.push(M(w,R++)),w=""):w+=y);w+=F}return M?K:w},i=f=>{typeof f=="number"?f=""+f:typeof f!="string"&&(f="");var d=$(f);return l(f,{_targetLower:d._lower,_targetLowerCodes:d.lowerCodes,_bitflags:d.bitflags})},s=()=>{O.clear(),we.clear()};class o{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((d,y)=>d-y)}set indexes(d){return this._indexes=d}highlight(d,y){return r(this,d,y)}get score(){return c(this._score)}set score(d){this._score=u(d)}}class a extends Array{get score(){return c(this._score)}set score(d){this._score=u(d)}}var l=(f,d)=>{let y=new o;return y.target=f,y.obj=d.obj??Q,y._score=d._score??ee,y._indexes=d._indexes??[],y._targetLower=d._targetLower??"",y._targetLowerCodes=d._targetLowerCodes??Q,y._nextBeginningIndexes=d._nextBeginningIndexes??Q,y._bitflags=d._bitflags??0,y},c=f=>f===ee?0:f>1?f:Math.E**(((-f+1)**.04307-1)*-2),u=f=>f===0?ee:f>1?f:1-Math.pow(Math.log(f)/-2+1,1/.04307),p=f=>{typeof f=="number"?f=""+f:typeof f!="string"&&(f=""),f=f.trim();var d=$(f),y=[];if(d.containsSpace){var M=f.split(/\s+/);M=[...new Set(M)];for(var E=0;E<M.length;E++)if(M[E]!==""){var x=$(M[E]);y.push({lowerCodes:x.lowerCodes,_lower:M[E].toLowerCase(),containsSpace:!1})}}return{lowerCodes:d.lowerCodes,_lower:d._lower,containsSpace:d.containsSpace,bitflags:d.bitflags,spaceSearches:y}},m=f=>{if(f.length>999)return i(f);var d=O.get(f);return d!==void 0||(d=i(f),O.set(f,d)),d},T=f=>{if(f.length>999)return p(f);var d=we.get(f);return d!==void 0||(d=p(f),we.set(f,d)),d},S=(f,d)=>{var y=[];y.total=f.length;var M=d?.limit||ke;if(d?.key)for(var E=0;E<f.length;E++){var x=f[E],b=Re(x,d.key);if(b!=Q){he(b)||(b=m(b));var w=l(b.target,{_score:b._score,obj:x});if(y.push(w),y.length>=M)return y}}else if(d?.keys)for(var E=0;E<f.length;E++){for(var x=f[E],R=new a(d.keys.length),N=d.keys.length-1;N>=0;--N){var b=Re(x,d.keys[N]);if(!b){R[N]=it;continue}he(b)||(b=m(b)),b._score=ee,b._indexes.len=0,R[N]=b}if(R.obj=x,R._score=ee,y.push(R),y.length>=M)return y}else for(var E=0;E<f.length;E++){var b=f[E];if(b!=Q&&(he(b)||(b=m(b)),b._score=ee,b._indexes.len=0,y.push(b),y.length>=M))return y}return y},P=(f,d,y=!1,M=!1)=>{if(y===!1&&f.containsSpace)return C(f,d,M);for(var E=f._lower,x=f.lowerCodes,b=x[0],w=d._targetLowerCodes,R=x.length,N=w.length,F=0,L=0,K=0;;){var G=b===w[L];if(G){if(ge[K++]=L,++F,F===R)break;b=x[F]}if(++L,L>=N)return Q}var F=0,pe=!1,j=0,J=d._nextBeginningIndexes;J===Q&&(J=d._nextBeginningIndexes=Se(d.target)),L=ge[0]===0?0:J[ge[0]-1];var st=0;if(L!==N)for(;;)if(L>=N){if(F<=0||(++st,st>200))break;--F;var De=rt[--j];L=J[De]}else{var G=x[F]===w[L];if(G){if(rt[j++]=L,++F,F===R){pe=!0;break}++L}else L=J[L]}var me=R<=1?-1:d._targetLower.indexOf(E,ge[0]),B=!!~me,ae=B?me===0||d._nextBeginningIndexes[me-1]===me:!1;if(B&&!ae){for(var U=0;U<J.length;U=J[U])if(!(U<=me)){for(var Te=0;Te<R&&x[Te]===d._targetLowerCodes[U+Te];Te++);if(Te===R){me=U,ae=!0;break}}}var ie=W=>{for(var X=0,ro=0,je=1;je<R;++je)W[je]-W[je-1]!==1&&(X-=W[je],++ro);var Ga=W[R-1]-W[0]-(R-1);if(X-=(12+Ga)*ro,W[0]!==0&&(X-=W[0]*W[0]*.2),!pe)X*=1e3;else{for(var Mi=1,je=J[0];je<N;je=J[je])++Mi;Mi>24&&(X*=(Mi-24)*10)}return X-=(N-R)/2,B&&(X/=1+R*R*1),ae&&(X/=1+R*R*1),X-=(N-R)/2,X};if(pe)if(ae){for(var U=0;U<R;++U)ge[U]=me+U;var ot=ge,mt=ie(ge)}else var ot=rt,mt=ie(rt);else{if(B)for(var U=0;U<R;++U)ge[U]=me+U;var ot=ge,mt=ie(ot)}d._score=mt;for(var U=0;U<R;++U)d._indexes[U]=ot[U];d._indexes.len=R;let En=new o;return En.target=d.target,En._score=d._score,En._indexes=d._indexes,En},C=(f,d,y)=>{for(var M=new Set,E=0,x=Q,b=0,w=f.spaceSearches,R=w.length,N=0,L=()=>{for(let ae=N-1;ae>=0;ae--)d._nextBeginningIndexes[Be[ae*2+0]]=Be[ae*2+1]},K=!1,B=0;B<R;++B){ve[B]=ee;var G=w[B];if(x=P(G,d),y){if(x===Q)continue;K=!0}else if(x===Q)return L(),Q;var F=B===R-1;if(!F){var pe=x._indexes,j=!0;for(let U=0;U<pe.len-1;U++)if(pe[U+1]-pe[U]!==1){j=!1;break}if(j){var J=pe[pe.len-1]+1,st=d._nextBeginningIndexes[J-1];for(let U=J-1;U>=0&&st===d._nextBeginningIndexes[U];U--)d._nextBeginningIndexes[U]=J,Be[N*2+0]=U,Be[N*2+1]=st,N++}}E+=x._score/R,ve[B]=x._score/R,x._indexes[0]<b&&(E-=(b-x._indexes[0])*2),b=x._indexes[0];for(var De=0;De<x._indexes.len;++De)M.add(x._indexes[De])}if(y&&!K)return Q;L();var me=P(f,d,!0);if(me!==Q&&me._score>E){if(y)for(var B=0;B<R;++B)ve[B]=me._score/R;return me}y&&(x=d),x._score=E;var B=0;for(let ae of M)x._indexes[B++]=ae;return x._indexes.len=B,x},A=f=>f.replace(/\p{Script=Latin}+/gu,d=>d.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),$=f=>{f=A(f);for(var d=f.length,y=f.toLowerCase(),M=[],E=0,x=!1,b=0;b<d;++b){var w=M[b]=y.charCodeAt(b);if(w===32){x=!0;continue}var R=w>=97&&w<=122?w-97:w>=48&&w<=57?26:w<=127?30:31;E|=1<<R}return{lowerCodes:M,bitflags:E,containsSpace:x,_lower:y}},nt=f=>{for(var d=f.length,y=[],M=0,E=!1,x=!1,b=0;b<d;++b){var w=f.charCodeAt(b),R=w>=65&&w<=90,N=R||w>=97&&w<=122||w>=48&&w<=57,L=R&&!E||!x||!N;E=R,x=N,L&&(y[M++]=b)}return y},Se=f=>{f=A(f);for(var d=f.length,y=nt(f),M=[],E=y[0],x=0,b=0;b<d;++b)E>b?M[b]=E:(E=y[++x],M[b]=E===void 0?d:E);return M},O=new Map,we=new Map,ge=[],rt=[],Be=[],de=[],ve=[],ze=[],be=[],Re=(f,d)=>{var y=f[d];if(y!==void 0)return y;if(typeof d=="function")return d(f);var M=d;Array.isArray(d)||(M=d.split("."));for(var E=M.length,x=-1;f&&++x<E;)f=f[M[x]];return f},he=f=>typeof f=="object"&&typeof f._bitflags=="number",ke=1/0,ee=-ke,pt=[];pt.total=0;var Q=null,it=i(""),zt=f=>{var d=[],y=0,M={},E=x=>{for(var b=0,w=d[b],R=1;R<y;){var N=R+1;b=R,N<y&&d[N]._score<d[R]._score&&(b=N),d[b-1>>1]=d[b],R=1+(b<<1)}for(var L=b-1>>1;b>0&&w._score<d[L]._score;L=(b=L)-1>>1)d[b]=d[L];d[b]=w};return M.add=x=>{var b=y;d[y++]=x;for(var w=b-1>>1;b>0&&x._score<d[w]._score;w=(b=w)-1>>1)d[b]=d[w];d[b]=x},M.poll=x=>{if(y!==0){var b=d[0];return d[0]=d[--y],E(),b}},M.peek=x=>{if(y!==0)return d[0]},M.replaceTop=x=>{d[0]=x,E()},M},Rt=zt();return{single:e,go:t,prepare:i,cleanup:s}})});var Ai=globalThis,Sn=Ai.trustedTypes,so=Sn?Sn.createPolicy("lit-html",{createHTML:n=>n}):void 0,Pi="$lit$",We=`lit$${Math.random().toFixed(9).slice(2)}$`,Oi="?"+We,rl=`<${Oi}>`,bt=document,Wt=()=>bt.createComment(""),qt=n=>n===null||typeof n!="object"&&typeof n!="function",Li=Array.isArray,ho=n=>Li(n)||typeof n?.[Symbol.iterator]=="function",Ci=`[ 	
\f\r]`,jt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,oo=/-->/g,ao=/>/g,ft=RegExp(`>|${Ci}(?:([^\\s"'>=/]+)(${Ci}*=${Ci}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),lo=/'/g,co=/"/g,po=/^(?:script|style|textarea|title)$/i,Ii=n=>(e,...t)=>({_$litType$:n,strings:e,values:t}),k=Ii(1),hc=Ii(2),pc=Ii(3),Me=Symbol.for("lit-noChange"),te=Symbol.for("lit-nothing"),uo=new WeakMap,gt=bt.createTreeWalker(bt,129);function mo(n,e){if(!Li(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return so!==void 0?so.createHTML(e):e}var fo=(n,e)=>{let t=n.length-1,r=[],i,s=e===2?"<svg>":e===3?"<math>":"",o=jt;for(let a=0;a<t;a++){let l=n[a],c,u,p=-1,m=0;for(;m<l.length&&(o.lastIndex=m,u=o.exec(l),u!==null);)m=o.lastIndex,o===jt?u[1]==="!--"?o=oo:u[1]!==void 0?o=ao:u[2]!==void 0?(po.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=ft):u[3]!==void 0&&(o=ft):o===ft?u[0]===">"?(o=i??jt,p=-1):u[1]===void 0?p=-2:(p=o.lastIndex-u[2].length,c=u[1],o=u[3]===void 0?ft:u[3]==='"'?co:lo):o===co||o===lo?o=ft:o===oo||o===ao?o=jt:(o=ft,i=void 0);let T=o===ft&&n[a+1].startsWith("/>")?" ":"";s+=o===jt?l+rl:p>=0?(r.push(c),l.slice(0,p)+Pi+l.slice(p)+We+T):l+We+(p===-2?a:T)}return[mo(n,s+(n[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]},Kt=class n{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let s=0,o=0,a=e.length-1,l=this.parts,[c,u]=fo(e,t);if(this.el=n.createElement(c,r),gt.currentNode=this.el.content,t===2||t===3){let p=this.el.content.firstChild;p.replaceWith(...p.childNodes)}for(;(i=gt.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(let p of i.getAttributeNames())if(p.endsWith(Pi)){let m=u[o++],T=i.getAttribute(p).split(We),S=/([.?@])?(.*)/.exec(m);l.push({type:1,index:s,name:S[2],strings:T,ctor:S[1]==="."?Rn:S[1]==="?"?Dn:S[1]==="@"?Mn:kt}),i.removeAttribute(p)}else p.startsWith(We)&&(l.push({type:6,index:s}),i.removeAttribute(p));if(po.test(i.tagName)){let p=i.textContent.split(We),m=p.length-1;if(m>0){i.textContent=Sn?Sn.emptyScript:"";for(let T=0;T<m;T++)i.append(p[T],Wt()),gt.nextNode(),l.push({type:2,index:++s});i.append(p[m],Wt())}}}else if(i.nodeType===8)if(i.data===Oi)l.push({type:2,index:s});else{let p=-1;for(;(p=i.data.indexOf(We,p+1))!==-1;)l.push({type:7,index:s}),p+=We.length-1}s++}}static createElement(e,t){let r=bt.createElement("template");return r.innerHTML=e,r}};function vt(n,e,t=n,r){if(e===Me)return e;let i=r!==void 0?t._$Co?.[r]:t._$Cl,s=qt(e)?void 0:e._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(n),i._$AT(n,t,r)),r!==void 0?(t._$Co??=[])[r]=i:t._$Cl=i),i!==void 0&&(e=vt(n,i._$AS(n,e.values),i,r)),e}var wn=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:r}=this._$AD,i=(e?.creationScope??bt).importNode(t,!0);gt.currentNode=i;let s=gt.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Dt(s,s.nextSibling,this,e):l.type===1?c=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(c=new Cn(s,this,e)),this._$AV.push(c),l=r[++a]}o!==l?.index&&(s=gt.nextNode(),o++)}return gt.currentNode=bt,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},Dt=class n{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,r,i){this.type=2,this._$AH=te,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=vt(this,e,t),qt(e)?e===te||e==null||e===""?(this._$AH!==te&&this._$AR(),this._$AH=te):e!==this._$AH&&e!==Me&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):ho(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==te&&qt(this._$AH)?this._$AA.nextSibling.data=e:this.T(bt.createTextNode(e)),this._$AH=e}$(e){let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Kt.createElement(mo(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(t);else{let s=new wn(i,this),o=s.u(this.options);s.p(t),this.T(o),this._$AH=s}}_$AC(e){let t=uo.get(e.strings);return t===void 0&&uo.set(e.strings,t=new Kt(e)),t}k(e){Li(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let s of e)i===t.length?t.push(r=new n(this.O(Wt()),this.O(Wt()),this,this.options)):r=t[i],r._$AI(s),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}},kt=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,s){this.type=1,this._$AH=te,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=te}_$AI(e,t=this,r,i){let s=this.strings,o=!1;if(s===void 0)e=vt(this,e,t,0),o=!qt(e)||e!==this._$AH&&e!==Me,o&&(this._$AH=e);else{let a=e,l,c;for(e=s[0],l=0;l<s.length-1;l++)c=vt(this,a[r+l],t,l),c===Me&&(c=this._$AH[l]),o||=!qt(c)||c!==this._$AH[l],c===te?e=te:e!==te&&(e+=(c??"")+s[l+1]),this._$AH[l]=c}o&&!i&&this.j(e)}j(e){e===te?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},Rn=class extends kt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===te?void 0:e}},Dn=class extends kt{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==te)}},Mn=class extends kt{constructor(e,t,r,i,s){super(e,t,r,i,s),this.type=5}_$AI(e,t=this){if((e=vt(this,e,t,0)??te)===Me)return;let r=this._$AH,i=e===te&&r!==te||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==te&&(r===te||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},Cn=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){vt(this,e)}},go={M:Pi,P:We,A:Oi,C:1,L:fo,R:wn,D:ho,V:vt,I:Dt,H:kt,N:Dn,U:Mn,B:Rn,F:Cn},il=Ai.litHtmlPolyfillSupport;il?.(Kt,Dt),(Ai.litHtmlVersions??=[]).push("3.2.1");var H=(n,e,t)=>{let r=t?.renderBefore??e,i=r._$litPart$;if(i===void 0){let s=t?.renderBefore??null;r._$litPart$=i=new Dt(e.insertBefore(Wt(),s),s,void 0,t??{})}return i._$AI(n),i};var q=n=>k`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
  >
    <use href=#${n}>
  </svg>`;var Gt=class extends HTMLElement{message="";static displayMessage(e,t=0){document.querySelector("error-popup").displayMessageImpl(e,t)}displayMessageImpl(e,t=0){this.message=e,t!==0&&window.setTimeout(()=>this.hide(),t),this.render(),this.unhide()}unhide(){this.classList.remove("hidden")}hide(){this.classList.add("hidden")}render(){H(this.template(),this)}template(){return k`
      <span>${this.message}</span>
      <button class="icon-button" title="Close" @click=${()=>this.hide()}>
        ${q("check")}
      </button>
    `}};customElements.define("error-popup",Gt);var bo="ErrorPopup",vo=n=>{bo=n},le=n=>{bo==="ErrorPopup"?Gt.displayMessage(n.message):document.dispatchEvent(new CustomEvent("error-report",{detail:n}))},_=n=>{n.ok||le(n.error)};var Mt=acquireVsCodeApi();document.addEventListener("finished-init",()=>{let n=document.querySelector("explan-main");n.embedded(),window.addEventListener("message",async e=>{let{type:t,body:r,requestId:i}=e.data;switch(t){case"init":{if(r.untitled)return;{let s=await n.fromUint8Array(r.value);_(s);return}}case"getFileData":{let s=r.contentType,o=await n.toUnit8Array(s);if(!o.ok){reportError(e);return}Mt.postMessage({type:"response",requestId:i,body:o.value});return}case"undo":{await n.undo(),Mt.postMessage({type:"response",requestId:i});return}case"redo":{await n.redo(),Mt.postMessage({type:"response",requestId:i});return}}}),Mt.postMessage({type:"ready"})});document.addEventListener("edit-action",()=>{Mt.postMessage({type:"edit"})});document.addEventListener("error-report",n=>{console.log("from bridge",n.detail),Mt.postMessage({type:"error-report",value:n.detail.message})});function h(n){return{ok:!0,value:n}}function v(n){return typeof n=="string"?{ok:!1,error:new Error(n)}:{ok:!1,error:n}}var _e=class n{description="Does nothing";postActionWork="";undo=!1;async do(e){return h(new n)}},ye=class n{name="ActionFromOp";description="Action constructed directly from an Op.";postActionWork;undo;op;constructor(e,t,r){this.postActionWork=t,this.undo=r,this.op=e,this.description=`ActionFromOp: ${this.op.name}`}async do(e){let t=this.op.applyTo(e.plan);return t.ok?(e.plan=t.value.plan,h(new n(t.value.inverse,this.postActionWork,this.undo))):t}};var se=class n{i=0;j=0;constructor(e=0,t=0){this.i=e,this.j=t}equal(e){return e.i===this.i&&e.j===this.j}toJSON(){return{i:this.i,j:this.j}}static fromJSON(e){return new n(e.i,e.j)}},at=n=>{let e=new Map;return n.forEach(t=>{let r=e.get(t.i)||[];r.push(t),e.set(t.i,r)}),e},Ct=n=>{let e=new Map;return n.forEach(t=>{let r=e.get(t.j)||[];r.push(t),e.set(t.j,r)}),e},qe=n=>{let e={bySrc:new Map,byDst:new Map};return n.forEach(t=>{let r=e.bySrc.get(t.i)||[];r.push(t),e.bySrc.set(t.i,r),r=e.byDst.get(t.j)||[],r.push(t),e.byDst.set(t.j,r)}),e};var V=class n{name;subOps=[];constructor(e,t="unset"){this.subOps=e,this.name=t}applyAllInverseSubOpsToPlan(e,t){for(let r=0;r<t.length;r++){let i=t[r].applyTo(e);if(!i.ok)return i;e=i.value.plan}return h(e)}applyTo(e){let t=[];for(let r=0;r<this.subOps.length;r++){let i=this.subOps[r].applyTo(e);if(!i.ok){let s=this.applyAllInverseSubOpsToPlan(e,t);return s.ok?i:s}e=i.value.plan,t.unshift(i.value.inverse)}return h({plan:e,inverse:new n(t,`-${this.name}`)})}},sl=(n,e)=>{for(let t=0;t<n.length;t++){let r=n[t].applyTo(e);if(!r.ok)return r;e=r.value.plan}return h(e)},$i=(n,e)=>{let t=[];for(let r=0;r<n.length;r++){let i=n[r].applyTo(e);if(!i.ok){let s=sl(t,e);return s.ok?i:s}t.unshift(i.value.inverse),e=i.value.plan}return h({ops:t,plan:e})};var An=class{name;metricDefinition;taskMetricValues;constructor(e,t,r=new Map){this.name=e,this.metricDefinition=t,this.taskMetricValues=r}applyTo(e){return e.getMetricDefinition(this.name)!==void 0?v(`${this.name} already exists as a Metric`):(e.setMetricDefinition(this.name,this.metricDefinition),e.chart.Vertices.forEach((t,r)=>{t.setMetric(this.name,this.taskMetricValues.get(r)||this.metricDefinition.default)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new Pn(this.name)}},Pn=class{name;constructor(e){this.name=e}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`The metric with name ${this.name} does not exist and can't be deleted.`);if(t.isStatic)return v(`The static Metric ${this.name} can't be deleted.`);e.deleteMetricDefinition(this.name);let r=new Map;return e.chart.Vertices.forEach((i,s)=>{let o=i.getMetric(this.name);o!==void 0&&r.set(s,o),i.deleteMetric(this.name)}),h({plan:e,inverse:this.inverse(t,r)})}inverse(e,t){return new An(this.name,e,t)}},_i=class n{oldName;newName;constructor(e,t){this.oldName=e,this.newName=t}applyTo(e){if(e.getMetricDefinition(this.newName)!==void 0)return v(`${this.newName} already exists as a metric.`);let t=e.getMetricDefinition(this.oldName);return t===void 0?v(`${this.oldName} does not exist as a Metric`):t.isStatic?v(`Static metric ${this.oldName} can't be renamed.`):(e.setMetricDefinition(this.newName,t),e.deleteMetricDefinition(this.oldName),e.chart.Vertices.forEach(r=>{let i=r.getMetric(this.oldName)||t.default;r.setMetric(this.newName,i),r.deleteMetric(this.oldName)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.newName,this.oldName)}},Ni=class n{name;metricDefinition;taskMetricValues;constructor(e,t,r=new Map){this.name=e,this.metricDefinition=t,this.taskMetricValues=r}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`${this.name} does not exist as a Metric`);if(t.isStatic)return v(`Static metric ${this.name} can't be updated.`);this.metricDefinition.default=this.metricDefinition.range.clamp(this.metricDefinition.default),e.setMetricDefinition(this.name,this.metricDefinition);let r=new Map;return e.chart.Vertices.forEach((i,s)=>{let o=i.getMetric(this.name),a;this.taskMetricValues.has(s)?a=this.taskMetricValues.get(s):o===t.default&&this.metricDefinition.range.min<=o&&this.metricDefinition.range.max>o?(a=this.metricDefinition.default,r.set(s,o)):(a=this.metricDefinition.range.clamp(o),a=this.metricDefinition.precision.round(a),r.set(s,o)),i.setMetric(this.name,a)}),h({plan:e,inverse:this.inverse(t,r)})}inverse(e,t){return new n(this.name,e,t)}},At=class n{name;value;taskIndex;constructor(e,t,r){this.name=e,this.value=t,this.taskIndex=r}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`${this.name} does not exist as a Metric`);let r=e.chart.Vertices[this.taskIndex],i=r.getMetric(this.name)||t.default;return r.setMetric(this.name,t.clampAndRound(this.value)),h({plan:e,inverse:this.inverse(i)})}inverse(e){return new n(this.name,e,this.taskIndex)}};function On(n,e){return new V([new An(n,e)],"AddMetricOp")}function ko(n){return new V([new Pn(n)],"DeleteMetricOp")}function To(n,e){return new V([new _i(n,e)],"RenameMetricOp")}function yo(n,e){return new V([new Ni(n,e)],"UpdateMetricOp")}function Pt(n,e,t){return new V([new At(n,e,t)],"SetMetricValueOp")}var Ot=n=>n===Number.MAX_VALUE?"(max float)":n===-Number.MAX_VALUE?"(min float)":n.toString(),Ne=(n,e,t)=>n>t?t:n<e?e:n,ce=class n{_min=-Number.MAX_VALUE;_max=Number.MAX_VALUE;constructor(e=-Number.MAX_VALUE,t=Number.MAX_VALUE){t<e&&([e,t]=[t,e]),this._min=e,this._max=t}clamp(e){return Ne(e,this._min,this._max)}get min(){return this._min}get max(){return this._max}toJSON(){return{min:this._min,max:this._max}}static fromJSON(e){return e===void 0?new n:new n(e.min,e.max)}};var Ce=n=>n.toISOString().slice(0,10),ol=/\d{4}-\d{2}-\d{2}/,Lt=n=>ol.test(n)?h(new Date(n+"T12:00:00.000Z")):v(new Error(`${n} is not a valid date`)),xo=()=>{let n=new Date;return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),12,0,0))};var Jt=n=>n.stage==="unstarted"?xo():new Date(n.start);var Ln=n=>{let e={stage:"unstarted",start:""};return n.stage==="started"&&(e.stage="started",e.start=Ce(new Date(n.start))),e},In=n=>{let e={stage:"unstarted",start:0};if(n.stage===void 0)return e;if(n.stage==="started"){if(n.start===void 0)return e;let t=Lt(n.start);return t.ok?{stage:"started",start:t.value.getTime()}:e}return e};var Eo=n=>{let e={hasCycles:!1,cycle:[],order:[]},t=at(n.Edges),r=new Set;n.Vertices.forEach((l,c)=>r.add(c));let i=l=>!r.has(l),s=new Set,o=l=>{if(i(l))return!0;if(s.has(l))return!1;s.add(l);let c=t.get(l);if(c!==void 0)for(let u=0;u<c.length;u++){let p=c[u];if(!o(p.j))return!1}return s.delete(l),r.delete(l),e.order.unshift(l),!0};return o(0)||(e.hasCycles=!0,e.cycle=[...s.keys()]),e};var al="Task Name",Tt=class n{resources;metrics;name;description;id;constructor(e=""){this.name=e||al,this.metrics={},this.resources={},this.id=crypto.randomUUID(),this.description=""}toJSON(){return{resources:this.resources,metrics:this.metrics,name:this.name,description:this.description,id:this.id}}static fromJSON(e){let t=new n(e.name);return t.description=e.description||"",t.id=e.id,t.resources=e.resources,t.metrics=e.metrics,t}get duration(){return this.getMetric("Duration")}set duration(e){this.setMetric("Duration",e)}getMetric(e){return this.metrics[e]}setMetric(e,t){this.metrics[e]=t}deleteMetric(e){delete this.metrics[e]}getResource(e){return this.resources[e]}setResource(e,t){this.resources[e]=t}deleteResource(e){delete this.resources[e]}dup(){let e=new n;return e.resources=Object.assign({},this.resources),e.metrics=Object.assign({},this.metrics),e.name=this.name,e}},Xt=class n{Vertices;Edges;constructor(){let e=new Tt("Start");e.setMetric("Duration",0);let t=new Tt("Finish");t.setMetric("Duration",0),this.Vertices=[e,t],this.Edges=[new se(0,1)]}toJSON(){return{vertices:this.Vertices.map(e=>e.toJSON()),edges:this.Edges.map(e=>e.toJSON())}}static fromJSON(e){let t=new n;return t.Vertices=e.vertices.map(r=>Tt.fromJSON(r)),t.Edges=e.edges.map(r=>se.fromJSON(r)),t}};function ll(n){if(n.Vertices.length<2)return v("Chart must contain at least two node, the start and finish tasks.");let e=Ct(n.Edges),t=at(n.Edges);if(e.get(0)!==void 0)return v("The start node (0) has an incoming edge.");for(let s=1;s<n.Vertices.length;s++)if(e.get(s)===void 0)return v(`Found node that isn't (0) that has no incoming edges: ${s}`);if(t.get(n.Vertices.length-1)!==void 0)return v("The last node, which should be the Finish Milestone, has an outgoing edge.");for(let s=0;s<n.Vertices.length-1;s++)if(t.get(s)===void 0)return v(`Found node that isn't T_finish that has no outgoing edges: ${s}`);let r=n.Vertices.length;for(let s=0;s<n.Edges.length;s++){let o=n.Edges[s];if(o.i<0||o.i>=r||o.j<0||o.j>=r)return v(`Edge ${o} points to a non-existent Vertex.`)}let i=Eo(n);return i.hasCycles?v(`Chart has cycle: ${[...i.cycle].join(", ")}`):h(i.order)}function lt(n,e=null){e===null&&(e=i=>n.Vertices[i].duration);let t=ll(n);if(!t.ok)return t;if(e(0)!==0)return v(`Start Milestone must have duration of 0, instead got ${e(0)}`);if(e(n.Vertices.length-1)!==0)return v(`Finish Milestone must have duration of 0, instead got ${e(n.Vertices.length-1)}`);let r=new Set;for(let i=0;i<n.Vertices.length;i++){let s=n.Vertices[i];if(r.has(s.id))return v(new Error(`Two tasks contain the same ID: ${s.id}`));r.add(s.id)}return t}var ct=class{start;finish;constructor(e=0,t=0){this.start=e,this.finish=t}},Hi=class{early=new ct;late=new ct;slack=0};function $n(n,e=null,t,r=null,i=null){e===null&&(e=c=>n.Vertices[c].duration);let s=new Array(n.Vertices.length);for(let c=0;c<n.Vertices.length;c++)s[c]=new Hi;let o=lt(n,e);if(!o.ok)return v(o.error);let a=qe(n.Edges),l=o.value;return l.slice(1).forEach(c=>{let u=s[c];u.early.start=Math.max(...a.byDst.get(c).map(T=>s[T.i].early.finish));let p=r?.(c);p!==void 0&&(u.early.start=p);let m=i?.(c);m!==void 0?u.early.finish=m:u.early.finish=t(u.early.start+e(c))}),l.reverse().forEach(c=>{let u=s[c];if(!a.bySrc.get(c)||r?.(c))u.late.finish=u.early.finish,u.late.start=u.early.start,u.slack=0;else{let m=a.bySrc.get(c).map(T=>s[T.j].late.start);m.length===0?u.late.finish=u.early.finish:u.late.finish=Math.min(...m),u.late.start=t(u.late.finish-e(c)),u.slack=t(u.late.finish-u.early.finish)}}),h(s)}var _n=(n,e)=>{let t=[];return n.forEach((r,i)=>{e(r.late.finish-r.early.finish)<Number.EPSILON&&e(r.early.finish-r.early.start)>Number.EPSILON&&t.push(i)}),t};var yt=n=>{let e={stage:n.stage,start:0,finish:0,percentComplete:0};switch(n.stage){case"unstarted":break;case"started":e.start=n.start,e.percentComplete=n.percentComplete;break;case"finished":e.start=n.span.start,e.finish=n.span.finish;break;default:break}return e},xt=n=>{let e={stage:"unstarted"};switch(n.stage){case"unstarted":return{stage:"unstarted"};case"started":return n.start===void 0?e:{stage:"started",start:n.start,percentComplete:n.percentComplete};case"finished":return n.start===void 0||n.finish===void 0?e:{stage:"finished",span:new ct(n.start,n.finish)};default:return e}},Nn=n=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,yt(t)])),Hn=n=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,xt(t)]));var Ui=class n{value;taskCompletions=null;constructor(e,t=null){this.value=e,this.taskCompletions=t}applyTo(e){let t=In(Ln(e.status));e.status=this.value;let r=Hn(Nn(e.taskCompletion));return this.taskCompletions!==null&&(e.taskCompletion=this.taskCompletions),e.status.stage==="unstarted"&&e.chart.Vertices.forEach(i=>{e.taskCompletion[i.id]={stage:"unstarted"}}),h({plan:e,inverse:new n(t,r)})}};var Vi=class n{unit;constructor(e){this.unit=e}applyTo(e){let t=e.durationUnits.kind();return e.setDurationUnits(this.unit),h({plan:e,inverse:new n(t)})}},Yt=class n{taskIndex;value;constructor(e,t){this.taskIndex=e,this.value=t}applyTo(e){if(this.value.stage!=="unstarted"&&e.status.stage==="unstarted")return v(new Error("Can't start a task if the plan hasn't been started."));if(this.value.stage==="started"){if(this.value.start<0)return v(new Error("The start of a task can't come befoe the start of the plan."));if(this.value.percentComplete<1||this.value.percentComplete>99)return v(new Error("Percent Complete must be in [1, 99]."))}if(this.value.stage==="finished"){if(this.value.span.finish<this.value.span.start)return v(new Error("Finish can't come before Start."));if(this.value.span.start<0)return v(new Error("The start of a task can't come befoe the start of the plan."))}let t=e.getTaskCompletion(this.taskIndex);if(!t.ok)return t;let r=xt(yt(t.value)),i=e.setTaskCompletion(this.taskIndex,this.value);return i.ok?h({plan:e,inverse:new n(this.taskIndex,r)}):i}};function So(n,e){return new V([new Yt(n,e)],"SetTaskCompletionOp")}function wo(n){return new V([new Vi(n)],"SetPlanUnitsOp")}function Un(n){return new V([new Ui(n)],"SetPlanStartStateOp")}var cl=14;function Ro(n,e,t){let r=t.chart;return e===-1&&(e=r.Vertices.length-1),n<0||n>=r.Vertices.length?v(`i index out of range: ${n} not in [0, ${r.Vertices.length-1}]`):e<0||e>=r.Vertices.length?v(`j index out of range: ${e} not in [0, ${r.Vertices.length-1}]`):n===e?v(`A Task can not depend on itself: ${n} === ${e}`):h(new se(n,e))}var Ke=class{i=0;j=0;constructor(e,t){this.i=e,this.j=t}applyTo(e){this.i===-1&&(this.i=e.chart.Vertices.length-1),this.j===-1&&(this.j=e.chart.Vertices.length-1);let t=Ro(this.i,this.j,e);return t.ok?(e.chart.Edges.find(r=>r.equal(t.value))||e.chart.Edges.push(t.value),h({plan:e,inverse:this.inverse()})):t}inverse(){return new Vn(this.i,this.j)}},Vn=class{i=0;j=0;constructor(e,t){this.i=e,this.j=t}applyTo(e){this.i===-1&&(this.i=e.chart.Vertices.length-1),this.j===-1&&(this.j=e.chart.Vertices.length-1);let t=Ro(this.i,this.j,e);return t.ok?(e.chart.Edges=e.chart.Edges.filter(r=>!r.equal(t.value)),h({plan:e,inverse:this.inverse()})):t}inverse(){return new Ke(this.i,this.j)}};function en(n,e){return n<0||n>e.Vertices.length-2?v(`${n} is not in range [0, ${e.Vertices.length-2}]`):h(null)}function Fi(n,e){return n<1||n>e.Vertices.length-2?v(`${n} is not in range [1, ${e.Vertices.length-2}]`):h(null)}var Qt=class{index=0;fullTaskToBeRestored;constructor(e,t=null){this.index=e,this.fullTaskToBeRestored=t}applyTo(e){let t=e.chart,r=en(this.index,t);if(!r.ok)return r;let i=e.newTask();this.fullTaskToBeRestored!==null&&(i=this.fullTaskToBeRestored.task),e.chart.Vertices.splice(this.index+1,0,i);for(let s=0;s<t.Edges.length;s++){let o=t.Edges[s];o.i>=this.index+1&&o.i++,o.j>=this.index+1&&o.j++}return this.fullTaskToBeRestored!==null&&t.Edges.push(...this.fullTaskToBeRestored.edges),h({plan:e,inverse:this.inverse()})}inverse(){return new Zt(this.index+1)}},Fn=class{index=0;constructor(e){this.index=e}applyTo(e){let t=e.chart,r=Fi(this.index,t);if(!r.ok)return r;let s=e.chart.Vertices[this.index].dup();e.chart.Vertices.splice(this.index,0,s);for(let o=0;o<t.Edges.length;o++){let a=t.Edges[o];a.i>this.index&&a.i++,a.j>this.index&&a.j++}return h({plan:e,inverse:this.inverse()})}inverse(){return new Zt(this.index+1)}};var Bi=class n{fromTaskIndex=0;toTaskIndex=0;actualMoves;constructor(e,t,r=new Map){this.fromTaskIndex=e,this.toTaskIndex=t,this.actualMoves=r}applyTo(e){let t=e.chart,r=Fi(this.fromTaskIndex,t);if(!r.ok||(r=Fi(this.toTaskIndex,t),!r.ok))return r;if(this.actualMoves.values.length===0){let i=new Map;for(let s=0;s<t.Edges.length;s++){let o=t.Edges[s];o.i===this.fromTaskIndex&&o.j===this.toTaskIndex||o.i===this.fromTaskIndex&&(i.set(new se(this.toTaskIndex,o.j),new se(o.i,o.j)),o.i=this.toTaskIndex)}return h({plan:e,inverse:this.inverse(this.toTaskIndex,this.fromTaskIndex,i)})}else{for(let i=0;i<t.Edges.length;i++){let s=this.actualMoves.get(e.chart.Edges[i]);s!==void 0&&(e.chart.Edges[i]=s)}return h({plan:e,inverse:new n(this.toTaskIndex,this.fromTaskIndex)})}}inverse(e,t,r){return new n(e,t,r)}},zi=class{fromIndex=0;toIndex=0;constructor(e,t){this.fromIndex=e,this.toIndex=t}applyTo(e){let t=en(this.fromIndex,e.chart);if(!t.ok)return t;let r=[];return e.chart.Edges.forEach(i=>{i.i===this.fromIndex&&r.push(new se(this.toIndex,i.j)),i.j===this.fromIndex&&r.push(new se(i.i,this.toIndex))}),e.chart.Edges.push(...r),h({plan:e,inverse:new Bn(r)})}},Bn=class{edges;constructor(e){this.edges=e}applyTo(e){return e.chart.Edges=e.chart.Edges.filter(t=>this.edges.findIndex(r=>t.equal(r))===-1),h({plan:e,inverse:new ji(this.edges)})}},ji=class{edges;constructor(e){this.edges=e}applyTo(e){return e.chart.Edges.push(...this.edges),h({plan:e,inverse:new Bn(this.edges)})}},Zt=class{index=0;constructor(e){this.index=e}applyTo(e){let t=e.chart,r=en(this.index,t);if(!r.ok)return r;let i=t.Edges.filter(a=>a.i===this.index||a.j===this.index);t.Edges=t.Edges.filter(a=>!(a.i===this.index||a.j===this.index));for(let a=0;a<t.Edges.length;a++){let l=t.Edges[a];l.i>this.index&&l.i--,l.j>this.index&&l.j--}let s=t.Vertices.splice(this.index,1),o={edges:i,task:s[0]};return h({plan:e,inverse:this.inverse(o)})}inverse(e){return new Qt(this.index-1,e)}},xe=class n{constructor(){}applyTo(e){let t=qe(e.chart.Edges),r=0,i=e.chart.Vertices.length-1;for(let s=r;s<i;s++){let o=t.bySrc.get(s);if(o===void 0){let a=new se(s,i);e.chart.Edges.push(a)}else if(o.length>1&&o.find(a=>a.j===i)){let a=new se(s,i);e.chart.Edges=e.chart.Edges.filter(l=>!a.equal(l))}}for(let s=r+1;s<i;s++){let o=t.byDst.get(s);if(o===void 0){let a=new se(r,s);e.chart.Edges.push(a)}else if(o.length>1&&o.find(a=>a.i===r)){let a=new se(r,s);e.chart.Edges=e.chart.Edges.filter(l=>!a.equal(l))}}return e.chart.Edges.length===0&&e.chart.Edges.push(new se(r,i)),h({plan:e,inverse:this.inverse()})}inverse(){return new n}},zn=class n{taskIndex;name;constructor(e,t){this.taskIndex=e,this.name=t}applyTo(e){let t=en(this.taskIndex,e.chart);if(!t.ok)return t;let r=e.chart.Vertices[this.taskIndex].name;return e.chart.Vertices[this.taskIndex].name=this.name,h({plan:e,inverse:this.inverse(r)})}inverse(e){return new n(this.taskIndex,e)}},Wi=class n{taskIndex;description;constructor(e,t){this.taskIndex=e,this.description=t}applyTo(e){let t=en(this.taskIndex,e.chart);if(!t.ok)return t;let r=e.chart.Vertices[this.taskIndex].description;return e.chart.Vertices[this.taskIndex].description=this.description,h({plan:e,inverse:new n(this.taskIndex,r)})}},qi=class{taskCompletions;today;spans;constructor(e,t=-1,r=[]){this.taskCompletions=e,this.today=t,this.spans=r}applyTo(e){return e.chart.Vertices.forEach((t,r)=>{e.setTaskCompletion(r,this.taskCompletions[r])}),h({plan:e,inverse:new jn(this.today,this.spans)})}},Do=(n,e)=>{switch(e.stage){case"finished":return!1;case"started":if(e.percentComplete>n)return!1;break;case"unstarted":break}return!0},Ki=class{today;taskIndex;span;constructor(e,t,r){this.today=e,this.taskIndex=t,this.span=r}applyTo(e){let t=e.getTaskCompletion(this.taskIndex);if(!t.ok)return t;let r=t.value,i=e.chart.Vertices[this.taskIndex],s=this.span.start,o=this.span.finish;if(!(this.today<=s))if(this.today>=o)e.setTaskCompletion(this.taskIndex,{stage:"finished",span:this.span});else{let a=Ne(Math.floor(100*(this.today-s)/i.duration),1,99),l=e.getTaskCompletion(this.taskIndex);if(!l.ok)return l;Do(a,l.value)&&e.setTaskCompletion(this.taskIndex,{stage:"started",start:s,percentComplete:Ne(Math.floor(100*(this.today-s)/i.duration),1,99)})}return h({plan:e,inverse:new Yt(this.taskIndex,r)})}},jn=class{today;spans;constructor(e,t){this.today=e,this.spans=t}applyTo(e){let t=e.chart.Vertices.map((r,i)=>{let s=e.getTaskCompletion(i);return s.ok?s.value:{stage:"unstarted"}});return e.chart.Vertices.forEach((r,i)=>{let s=this.spans[i].start,o=this.spans[i].finish;if(!(this.today<=s))if(this.today>=o)e.setTaskCompletion(i,{stage:"finished",span:this.spans[i]});else{let a=Ne(Math.floor(100*(this.today-s)/r.duration),1,99),l=e.getTaskCompletion(i);if(!l.ok)return;Do(a,l.value)&&e.setTaskCompletion(i,{stage:"started",start:s,percentComplete:Ne(Math.floor(100*(this.today-s)/r.duration),1,99)})}}),h({plan:e,inverse:new qi(t,this.today,this.spans)})}},Gi=class{today;taskIndex;constructor(e,t){this.today=e,this.taskIndex=t}applyTo(e){let t=e.chart.Vertices[this.taskIndex],r=e.getTaskCompletion(this.taskIndex);if(!r.ok)return r;let i=r.value;if(i.stage!=="started")return v(new Error("Recalculating duration can only be applied to started tasks."));let s=e.chart.Vertices[this.taskIndex].duration,o=i.percentComplete,a=i.start,l=(this.today-a)/(o/100);return t.duration=e.getStaticMetricDefinition("Duration").clampAndRound(l),h({plan:e,inverse:new At("Duration",s,this.taskIndex)})}};function Mo(n){return new V([new xe,new Qt(n),new Ke(0,n+1),new Ke(n+1,-1),new xe],"InsertNewEmptyMilestoneAfterOp")}function It(n,e){return new V([new zn(n,e)],"SetTaskNameOp")}function Wn(n){let e=[new Fn(n),new Bi(n,n+1),new Ke(n,n+1)];return new V(e,"SplitTaskOp")}function qn(n){let e=[new Fn(n),new zi(n,n+1)];return new V(e,"DupTaskOp")}function Co(n){return new V([new xe,new Zt(n),new xe],"DeleteTaskOp")}function Kn(n,e){return new V([new xe,new Ke(n,e),new xe],"AddEdgeOp")}function Ao(){return new V([new xe],"RationalizeEdgesOp")}function Po(n,e){return new V([new xe,new Vn(n,e),new xe],"RemoveEdgeOp")}var ul=0;function Gn(n){return new V([new xe,new Qt(n),new At("Duration",cl,n+1),new zn(n+1,`Task ${++ul}`),new Ke(0,n+1),new Ke(n+1,-1),new xe],"InsertNewEmptyTaskAfterOp")}function Oo(n,e){return new V([new jn(n,e)],"CatchupOp")}function Lo(n,e){return new V([new Gi(n,e)],"RecalculateDurationOp")}function Io(n,e,t){return new V([new Ki(n,e,t)],"CatchupTaskOp")}function $o(n,e){return new V([new Wi(n,e)],"SetTaskDescriptionOp")}var Jn=class{description="Prompts for and adds a predecessor to the current Task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A Task must be selected."));let t=await e.querySelector("add-dependency-dialog").selectDependency(e.plan.chart,e.selectedTask,"pred");if(t===void 0)return v(new Error("No predecessor was selected."));let r=Kn(t,e.selectedTask).applyTo(e.plan);return r.ok?h(new ye(r.value.inverse,this.postActionWork=this.postActionWork,!0)):r}};var Xn=class{description="Prompts for and adds a successor to the current Task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A Task must be selected."));let t=await e.querySelector("add-dependency-dialog").selectDependency(e.plan.chart,e.selectedTask,"succ");if(t===void 0)return v(new Error("No successor was selected."));let r=Kn(e.selectedTask,t).applyTo(e.plan);return r.ok?h(new ye(r.value.inverse,this.postActionWork=this.postActionWork,!0)):r}};var Yn=class{description="Opens the developer panel.";postActionWork="";undo=!1;async do(e){return e.querySelector("developer-panel").showDialog(e),h(new _e)}};var Qn=class{description="Moves focus to search control.";postActionWork="";undo=!1;async do(e){return document.querySelector("button[data-target='task-tab']").click(),document.querySelector("search-task-panel").setKeyboardFocusToInput("name-only"),h(this)}},Zn=class{description="Moves focus to search control and does a full search of all resource values.";postActionWork="";undo=!1;async do(e){return document.querySelector("button[data-target='task-tab']").click(),document.querySelector("search-task-panel").setKeyboardFocusToInput("full-info"),h(this)}};var er=class{description="Displays the help dialog.";postActionWork="";undo=!1;async do(e){return e.querySelector("keyboard-map-dialog").showModal(),h(this)}};var tr=class{description="Undoes the zoom.";postActionWork="paintChart";undo=!1;async do(e){return e.displayRange=null,h(this)}};var nr=class{description="Splits a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=Wn(e.selectedTask).applyTo(e.plan);return t.ok?h(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},rr=class{description="Duplicates a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=qn(e.selectedTask).applyTo(e.plan);return t.ok?h(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},ir=class{description="Creates a new task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){let t=Gn(0).applyTo(e.plan);return t.ok?h(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},sr=class{description="Deletes a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=Co(e.selectedTask).applyTo(e.plan);return t.ok?(e.selectedTask=-1,h(new ye(t.value.inverse,this.postActionWork,this.undo))):t}},Ae=class{description="Moves focus to the first predecessor task.";postActionWork="planDefinitionChanged";undo=!1;predIndex=0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let r=(qe(e.plan.chart.Edges).byDst.get(e.selectedTask)||[]).map(s=>s.i);r.reverse();let i=r.length>this.predIndex&&r[this.predIndex];return i===!1||i===0?v(new Error("Can't edit that task.")):(e.selectedTask=i,h(new _e))}},or=class extends Ae{constructor(){super(),this.predIndex=1,this.description="Moves focus to the second predecessor task."}},ar=class extends Ae{constructor(){super(),this.predIndex=2,this.description="Moves focus to the third predecessor task."}},lr=class extends Ae{constructor(){super(),this.predIndex=3,this.description="Moves focus to the fourth predecessor task."}},cr=class extends Ae{constructor(){super(),this.predIndex=4,this.description="Moves focus to the fifth predecessor task."}},ur=class extends Ae{constructor(){super(),this.predIndex=5,this.description="Moves focus to the sixth predecessor task."}},dr=class extends Ae{constructor(){super(),this.predIndex=6,this.description="Moves focus to the seventh predecessor task."}},hr=class extends Ae{constructor(){super(),this.predIndex=7,this.description="Moves focus to the eighth predecessor task."}},pr=class extends Ae{constructor(){super(),this.predIndex=8,this.description="Moves focus to the ninth predecessor task."}},Pe=class{description="Moves focus to the first successor task.";postActionWork="planDefinitionChanged";undo=!1;succIndex=0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let r=(qe(e.plan.chart.Edges).bySrc.get(e.selectedTask)||[]).map(s=>s.j);r.reverse();let i=r.length>this.succIndex&&r[this.succIndex];return i===!1||i===e.plan.chart.Vertices.length-1?v(new Error("Can't edit that task.")):(e.selectedTask=i,h(new _e))}},mr=class extends Pe{constructor(){super(),this.succIndex=1,this.description="Moves focus to the second successor task."}},fr=class extends Pe{constructor(){super(),this.succIndex=2,this.description="Moves focus to the third successor task."}},gr=class extends Pe{constructor(){super(),this.succIndex=3,this.description="Moves focus to the fourth successor task."}},br=class extends Pe{constructor(){super(),this.succIndex=4,this.description="Moves focus to the fifth successor task."}},vr=class extends Pe{constructor(){super(),this.succIndex=5,this.description="Moves focus to the sixth successor task."}},kr=class extends Pe{constructor(){super(),this.succIndex=6,this.description="Moves focus to the seventh successor task."}},Tr=class extends Pe{constructor(){super(),this.succIndex=7,this.description="Moves focus to the eighth successor task."}},yr=class extends Pe{constructor(){super(),this.succIndex=8,this.description="Moves focus to the ninth successor task."}};var _o="explan-darkmode",No=()=>{window.localStorage.setItem(_o,document.body.classList.toggle("darkmode")?"1":"0")},Ho=()=>{document.body.classList.toggle("darkmode",window.localStorage.getItem(_o)==="1")};var xr=class{description="Toggles dark mode.";postActionWork="paintChart";undo=!1;async do(e){return No(),h(this)}};var Er=class{description="Toggles the radar view.";postActionWork="";undo=!1;async do(e){return e.toggleRadar(),h(this)}};var Sr=class{description="Undoes the last action.";postActionWork="";undo=!1;async do(e){let t=await Uo(e);return t.ok?h(new _e):t}},wr=class{description="Redoes the most recent undo action.";postActionWork="";undo=!1;async do(e){let t=await Vo(e);return t.ok?h(new _e):t}};var Rr={ToggleDarkModeAction:new xr,ToggleRadarAction:new Er,ResetZoomAction:new tr,UndoAction:new Sr,RedoAction:new wr,HelpAction:new er,SplitTaskAction:new nr,DupTaskAction:new rr,NewTaskAction:new ir,DeleteTaskAction:new sr,GoToSearchAction:new Qn,GoToFullSearchAction:new Zn,AddPredecessorAction:new Jn,AddSuccessorAction:new Xn,DeveloperPanelAction:new Yn,MoveFocusToPredecessor1:new Ae,MoveFocusToPredecessor2:new or,MoveFocusToPredecessor3:new ar,MoveFocusToPredecessor4:new lr,MoveFocusToPredecessor5:new cr,MoveFocusToPredecessor6:new ur,MoveFocusToPredecessor7:new dr,MoveFocusToPredecessor8:new hr,MoveFocusToPredecessor9:new pr,MoveFocusToSuccessor1:new Pe,MoveFocusToSuccessor2:new mr,MoveFocusToSuccessor3:new fr,MoveFocusToSuccessor4:new gr,MoveFocusToSuccessor5:new br,MoveFocusToSuccessor6:new vr,MoveFocusToSuccessor7:new kr,MoveFocusToSuccessor8:new Tr,MoveFocusToSuccessor9:new yr};var Dr=[],Mr=[],Fo=()=>[Dr,Mr],Uo=async n=>{let e=Dr.pop();return e?await Cr(e,n,"undo"):h(null)},Vo=async n=>{let e=Mr.pop();return e?await Cr(e,n,"redo"):h(null)},ue=async(n,e)=>Cr(Rr[n],e),Cr=async(n,e,t="normal")=>{let r=await n.do(e);if(!r.ok)return r;switch(n.postActionWork){case"":break;case"paintChart":e.paintChart();break;case"planDefinitionChanged":e.planDefinitionHasBeenChanged(),e.paintChart(),document.dispatchEvent(new CustomEvent("plan-definition-changed"));default:break}if(n.undo)switch(t){case"normal":Dr.push(r.value),Mr.length=0,document.dispatchEvent(new CustomEvent("edit-action"));break;case"undo":Mr.push(r.value);break;case"redo":Dr.push(r.value);break;default:break}return h(null)},Y=async(n,e,t,r)=>Cr(new ye(n,e,t),r);var tn=new Map([["shift-ctrl-R","ToggleRadarAction"],["shift-ctrl-M","ToggleDarkModeAction"],["shift-ctrl-Z","ResetZoomAction"],["ctrl-z","UndoAction"],["ctrl-y","RedoAction"],["shift-ctrl-H","HelpAction"],["shift-ctrl-|","SplitTaskAction"],["shift-ctrl-_","DupTaskAction"],["alt-Insert","NewTaskAction"],["alt-Delete","DeleteTaskAction"],["ctrl-f","GoToSearchAction"],["shift-ctrl-F","GoToFullSearchAction"],["shift-ctrl-<","AddPredecessorAction"],["shift-ctrl->","AddSuccessorAction"],["shift-ctrl-V","DeveloperPanelAction"],["ctrl-meta-1","MoveFocusToPredecessor1"],["ctrl-meta-2","MoveFocusToPredecessor2"],["ctrl-meta-3","MoveFocusToPredecessor3"],["ctrl-meta-4","MoveFocusToPredecessor4"],["ctrl-meta-5","MoveFocusToPredecessor5"],["ctrl-meta-6","MoveFocusToPredecessor6"],["ctrl-meta-7","MoveFocusToPredecessor7"],["ctrl-meta-8","MoveFocusToPredecessor8"],["ctrl-meta-9","MoveFocusToPredecessor9"],["ctrl-1","MoveFocusToSuccessor1"],["ctrl-2","MoveFocusToSuccessor2"],["ctrl-3","MoveFocusToSuccessor3"],["ctrl-4","MoveFocusToSuccessor4"],["ctrl-5","MoveFocusToSuccessor5"],["ctrl-6","MoveFocusToSuccessor6"],["ctrl-7","MoveFocusToSuccessor7"],["ctrl-8","MoveFocusToSuccessor8"],["ctrl-9","MoveFocusToSuccessor9"]]),Bo,zo=n=>{Bo=n,document.addEventListener("keydown",dl)},dl=async n=>{let e=`${n.shiftKey?"shift-":""}${n.ctrlKey?"ctrl-":""}${n.metaKey?"meta-":""}${n.altKey?"alt-":""}${n.key}`;console.log(e);let t=tn.get(e);if(t===void 0)return;n.stopPropagation(),n.preventDefault();let r=await ue(t,Bo);_(r)},jo=()=>{tn.delete("ctrl-z"),tn.delete("ctrl-y")};var Ji=class extends HTMLElement{connectedCallback(){let e=[...tn.entries()];e.sort(),H(k`
        <dialog>
          <table>
            ${e.map(([t,r])=>k`<tr>
                  <td>${t}</td>
                  <td>${Rr[r].description}</td>
                </tr>`)}
          </table>
        </dialog>
      `,this)}showModal(){this.querySelector("dialog").showModal()}};customElements.define("keyboard-map-dialog",Ji);var Xi=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){H(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){if(!this.explanMain)return k``;let e=this.explanMain.imageExportWidthPx;return k` <h3>Image Export</h3>
    
    <div>
        <label>
        Width (px) 
        <input 
            type=number 
            .value=${e}
            @change=${t=>this.widthChange(t)}
            min=100
            max=1000000
            step=1
            required
        >
        </lable>
    </div>
    <div>
        <label>
        <input 
            type=checkbox 
            .checked=${this.explanMain.imageExportBackgroundTransparent}
            @input=${t=>{this.transparentChange(t)}}
        >
        Transparent Background
        </label>
    </div>
    `}widthChange(e){let t=+e.target.value;t>0&&t<1e6&&(this.explanMain.imageExportWidthPx=t)}transparentChange(e){let t=e.target.checked;this.explanMain.imageExportBackgroundTransparent=t}};customElements.define("image-export-panel",Xi);var Yi=class extends HTMLElement{dialog=null;heading=null;inputElement=null;resolve=()=>{};connectedCallback(){this.dialog=this.querySelector("dialog"),this.heading=this.querySelector("h3"),this.inputElement=this.querySelector("input"),this.querySelector("#prompt-cancel").addEventListener("click",()=>{this.dialog.close(),this.resolve(null)}),this.querySelector("#prompt-ok").addEventListener("click",()=>{this.dialog.close(),this.resolve(this.inputElement.value)})}prompt(e){let t=new Promise(r=>{this.resolve=r});return this.heading.textContent=e,this.inputElement.value="",this.dialog.showModal(),t}};customElements.define("prompt-dialog",Yi);var Qi=class extends HTMLElement{dialog=null;inputElement=null;resolve=()=>{};connectedCallback(){this.dialog=this.querySelector("dialog"),this.inputElement=this.querySelector("textarea"),this.querySelector("#description-cancel").addEventListener("click",()=>{this.dialog.close(),this.resolve(null)}),this.querySelector("#description-ok").addEventListener("click",()=>{this.dialog.close(),this.resolve(this.inputElement.value)})}prompt(e){let t=new Promise(r=>{this.resolve=r});return this.inputElement.value=e,this.dialog.showModal(),t}};customElements.define("edit-description-dialog",Qi);var Zi=class extends HTMLElement{explanMain=null;groupByOptions=[];selectedGroupBy="";planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&(this.populateGroupBy(),this.render())}}populateGroupBy(){let e=this.explanMain?.plan;e!==void 0&&(this.groupByOptions=["",...Object.keys(e.resourceDefinitions)],this.groupByOptions.includes(this.selectedGroupBy)||(this.selectedGroupBy=""))}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){H(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}getSelectedGroup(){return this.selectedGroupBy}groupByChanged(e){this.selectedGroupBy=e.target.value,this.dispatchEvent(new CustomEvent("group-by-resource-changed",{bubbles:!0,detail:this.selectedGroupBy}))}template(){return k`
      <select @input=${e=>this.groupByChanged(e)}>
        ${this.groupByOptions.map(e=>{let t=e||"(none)";return k`<option
            ?selected=${e===this.selectedGroupBy}
            value="${e}"
          >
            ${t}
          </option>`})}
      </select>
    `}};customElements.define("groupby-control",Zi);var es=class extends HTMLElement{allButtons=[];connectedCallback(){this.querySelectorAll("button").forEach(e=>{let t=e.dataset.target;t&&(this.allButtons.push(e),e.addEventListener("click",()=>this.hideAllBut(t)))})}hideAllBut(e){this.allButtons.forEach(t=>{let r=document.getElementById(t.dataset.target);t.dataset.target===e?(r?.classList.remove("hidden"),t.classList.add("selected")):(r?.classList.add("hidden"),t.classList.remove("selected"))})}};customElements.define("tab-buttons",es);var hl=/^[\d\.]+$/,$t=n=>{switch(n){case"Days":return 7;case"Weekdays":return 5;default:return 0}},Ar=(n,e)=>{if(n=n.trim(),n==="")return h(0);if(n.match(hl)){let s=+n;return Number.isNaN(s)?v(new Error(`Invalid number value: ${n}`)):h(s)}if(e===0)return v(new Error(`${n} is not a valid unitless duration.`));let t=0,r=0,i=[...n];for(let s=0;s<i.length;s++){let o=i[s];if(o==="d")t+=r,r=0;else if(o==="w")t+=r*e,r=0;else if(o==="m")t+=r*(e*4+2),r=0;else if(o==="y")t+=r*e*52,r=0;else if("0123456789".includes(o))r=r*10+ +o;else return v(new Error(`invalid duration format: ${n}`))}return h(t)},ts=(n,e)=>{if(n<0)return v(new Error(`Can't convert negative days: ${n}`));if(n===0)return h("0");if(e===0)return h(`${n}`);n=Math.floor(n);let t=52*e,r=4*e+2;if(n%t===0)return h(`${n/t}y`);if(n%r===0)return h(`${n/r}m`);if(n%e===0&&n<52*e)return h(`${n/e}w`);let i=[];if(n>=t){let s=Math.floor(n/t);n=n%t,i.push(`${s}y`)}if(n>=r){let s=Math.floor(n/r);n=n%r,i.push(`${s}m`)}if(n>=e){let s=Math.floor(n/e);n=n%e,i.push(`${s}w`)}return n>0&&i.push(`${n}d`),h(i.join(""))},Wo=(n,e,t)=>{if(t===0)return h(n);let r=ts(n,e);return r.ok?Ar(r.value,t):r};var Pr=class{start;cache;lastCacheEntry;constructor(e){this.start=e,this.cache=new Map,this.cache.set(0,0),this.lastCacheEntry=0}dateToWeekday(e){let t=Lt(e);if(!t.ok)return t;let r=t.value;if(r<=this.start)return v(new Error(`${r} comes before ${this.start}`));let i=new Date(this.start.getTime()),s=Ce(i),o=0;for(;s<e;){let a=i.getDate();i.setDate(a+1);let l=i.getDay();l===0||l===6||(o+=1,s=Ce(i))}return h(o)}weekdaysToDays(e){if(e<0)return 0;e=Math.trunc(e);let t=this.cache.get(e);if(t!==void 0)return t;let r=new Date(this.start.getTime()),i=this.lastCacheEntry,s=this.cache.get(i);for(r.setDate(r.getDate()+s);i!==e;){let o=r.getDate();r.setDate(o+1),s+=1;let a=r.getDay();a===0||a===6||(i+=1,this.cache.set(i,s))}return this.lastCacheEntry=i,s}};var Et=class{start;metricDefn;unitType;constructor(e,t,r){this.start=e,this.metricDefn=t,this.unitType=r}displayTime(e){throw new Error("Method implemented in subclasses.")}asDate(e){throw new Error("Method implemented in subclasses.")}parseHumanDuration(e){return Ar(e,$t(this.unitType))}durationToHuman(e){return ts(e,$t(this.unitType))}dateStringToDuration(e){throw new Error("Method implemented in subclasses.")}kind(){return this.unitType}toJSON(){return{unitType:this.unitType}}static fromJSON(e,t,r){return Lr[is(e.unitType)](t,r)}},Or=["Unitless","Days","Weekdays"];var Lr={Unitless:(n,e)=>new ns(n,e),Days:(n,e)=>new nn(n,e),Weekdays:(n,e)=>new rs(n,e)},is=n=>Or.some(e=>e===n)?n:"Unitless",ns=class extends Et{constructor(e,t){super(e,t,"Unitless")}displayTime(e,t){return this.metricDefn.clampAndRound(e).toString()}asDate(e){return this.start}dateStringToDuration(e){let t=Ar(e,0);return t.ok?h(this.metricDefn.clampAndRound(t.value)):t}},nn=class extends Et{constructor(e,t){super(e,t,"Days")}displayTime(e){return Ce(this.asDate(e))}asDate(e){let t=new Date(this.start.getTime());return t.setDate(t.getDate()+e),t}dateStringToDuration(e){let t=Lt(e);if(!t.ok)return t;let r=t.value.getTime()-this.start.getTime()+1;return r<0?v(new Error("Dates before the plan start are not allowed.")):h(this.metricDefn.clampAndRound(r/(1e3*60*60*24)))}},rs=class extends Et{weekdays;constructor(e,t){super(e,t,"Weekdays"),this.weekdays=new Pr(e)}displayTime(e){return Ce(this.asDate(e))}asDate(e){let t=new Date(this.start.getTime());return t.setDate(t.getDate()+this.weekdays.weekdaysToDays(e)),t}dateStringToDuration(e){return this.weekdays.dateToWeekday(e)}};var ss=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){H(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){return k`
      <h3>Plan Status</h3>
      <div>
        <div>${this.unstartedContent()} ${this.startedContent()}</div>
        <label>
          Units
          <select
            size=${Or.length}
            @input=${e=>this.unitChanged(e)}
          >
            ${Or.map(e=>k`<option
                ?selected=${this.explanMain.plan.durationUnits.kind()===e}
                value=${e}
              >
                ${e}
              </option>`)}
          </select>
        </label>
      </div>
    `}async unitChanged(e){let t=e.target.value,r=await Y(wo(is(t)),"planDefinitionChanged",!0,this.explanMain);_(r),this.render()}unstartedContent(){return this.explanMain.plan.status.stage==="unstarted"?k`
        <label>
          <input type="checkbox" @input=${()=>this.start()} /> Started
        </label>
      `:k``}startedContent(){return this.explanMain.plan.status.stage==="started"?k`
        <label>
          <input type="checkbox" checked @input=${()=>this.unstart()} />
          Started
        </label>
        ${this.explanMain.plan.durationUnits.kind()==="Unitless"?k``:k`
              <input
                type="date"
                .value=${Ce(new Date(this.explanMain.plan.status.start))}
                @input=${e=>this.dateChanged(e)}
              />
            `}
      `:k``}async dateChanged(e){let t=e.target.valueAsDate.getTime(),r=await Y(Un({stage:"started",start:t}),"planDefinitionChanged",!0,this.explanMain);_(r),this.render()}async start(){let e=Date.now(),t=await Y(Un({stage:"started",start:e}),"planDefinitionChanged",!0,this.explanMain);_(t),this.render()}async unstart(){let e=await Y(Un({stage:"unstarted",start:0}),"planDefinitionChanged",!0,this.explanMain);_(e),this.render()}};customElements.define("plan-config-panel",ss);var Ge={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Ir=n=>(...e)=>({_$litDirective$:n,values:e}),_t=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var{I:Nh}=go;var qo=n=>n.strings===void 0;var pl={},Ko=(n,e=pl)=>n._$AH=e;var oe=Ir(class extends _t{constructor(n){if(super(n),n.type!==Ge.PROPERTY&&n.type!==Ge.ATTRIBUTE&&n.type!==Ge.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!qo(n))throw Error("`live` bindings can only contain a single expression")}render(n){return n}update(n,[e]){if(e===Me||e===te)return e;let t=n.element,r=n.name;if(n.type===Ge.PROPERTY){if(e===t[r])return Me}else if(n.type===Ge.BOOLEAN_ATTRIBUTE){if(!!e===t.hasAttribute(r))return Me}else if(n.type===Ge.ATTRIBUTE&&t.getAttribute(r)===e+"")return Me;return Ko(n),e}});var os=class extends HTMLElement{_value=null;set value(e){this._value=e,this.render()}render(){H(this.template(),this)}template(){return this._value===null?k``:this._value.unit.kind()==="Unitless"?k` <input
        type="text"
        .value=${oe(this._value.dateOffset)}
        @change=${t=>this.inputChanged(t)}
      />`:k`
        <input
          type="date"
          .value=${oe(Ce(this._value.unit.asDate(this._value.dateOffset)))}
          @input=${t=>this.inputChanged(t)}
        />
      `}inputChanged(e){let t=this._value.unit.dateStringToDuration(e.target.value);t.ok?this.dispatchEvent(new CustomEvent("date-picker-input",{bubbles:!0,detail:t.value})):(this.render(),le(t.error))}};customElements.define("date-picker",os);var as=class extends HTMLElement{explanMain=null;span=null;taskIndex=0;taskCompletion=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.updateOnInput()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}update(e,t,r){this.explanMain=e,this.taskIndex=t,this.span=r,this.updateOnInput()}updateOnInput(){let e=this.explanMain.plan.getTaskCompletion(this.taskIndex);e.ok&&(this.taskCompletion=e.value),H(this.template(),this)}template(){if(this.taskCompletion===null)return k``;if(this.explanMain.plan.status.stage==="unstarted")return k``;if(this.taskIndex===-1)return k``;switch(this.taskCompletion.stage){case"unstarted":return k`<div>
          <label>
            <input type="checkbox" @change=${()=>this.start()} />
            Started
          </label>
        </div>`;case"started":return k`<div>
            <label>
              <input type="checkbox" checked @change=${()=>this.unstart()} />
              Started
            </label>

            <date-picker
              .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.start}}
              @date-picker-input=${e=>this.startDateChanged(e)}
            ></date-picker>

            <label>
              <input type="checkbox" @change=${()=>this.finish()} />
              Finished
            </label>
          </div>
          <div>
            <label>
              <input
                type="number"
                min="1"
                max="99"
                step="1"
                .value=${oe(this.taskCompletion.percentComplete)}
                @change=${e=>this.percentChange(e)}
              />
              % Complete
              <button
                title="Set the completion of the task to match today."
                @click=${async()=>{let e=await this.explanMain.getToday();if(!e.ok){le(e.error);return}let t=e.value,r=await Y(Io(t,this.taskIndex,this.span),"planDefinitionChanged",!0,this.explanMain);_(r)}}
              >
                Catch Up
              </button>
            </label>
          </div>`;case"finished":return k`<div>
          <label>
            <input type="checkbox" checked @change=${()=>this.unstart()} />
            Started
          </label>

          <date-picker
            .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.span.start}}
            @date-picker-input=${e=>this.startDateChanged(e)}
          ></date-picker>

          <label>
            <input type="checkbox" checked @change=${()=>this.unfinish()} />
            Finished
          </label>

          <date-picker
            .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.span.finish}}
            @date-picker-input=${e=>this.finishDateChanged(e)}
          ></date-picker>
        </div>`;default:return this.taskCompletion,k``;break}}async taskCompletionChanged(e){let t=await Y(So(this.taskIndex,e),"planDefinitionChanged",!0,this.explanMain);t.ok||(this.updateOnInput(),le(t.error))}async start(){this.taskCompletionChanged({stage:"started",start:this.span.start,percentComplete:10})}unstart(){this.taskCompletionChanged({stage:"unstarted"})}finish(){this.taskCompletion.stage==="started"&&this.taskCompletionChanged({stage:"finished",span:new ct(this.taskCompletion.start,this.span.finish)})}unfinish(){this.taskCompletion.stage==="finished"&&this.taskCompletionChanged({stage:"started",percentComplete:90,start:this.taskCompletion.span.start})}percentChange(e){let t=xt(yt(this.taskCompletion));t.stage==="started"&&(t.percentComplete=e.target.valueAsNumber,this.taskCompletionChanged(t))}startDateChanged(e){let t=xt(yt(this.taskCompletion));t.stage==="finished"?t.span.start=e.detail:t.stage==="started"&&(t.start=e.detail),this.taskCompletionChanged(t)}finishDateChanged(e){let t=xt(yt(this.taskCompletion));t.stage==="finished"&&(t.span.finish=e.detail),this.taskCompletionChanged(t)}};customElements.define("task-completion-panel",as);var rn="",Je=class n{values;isStatic;constructor(e=[rn],t=!1){this.values=e,this.isStatic=t}toJSON(){return{values:this.values,static:this.isStatic}}static fromJSON(e){return new n(e.values,e.static)}};var $r=class{key;deleteResourceUndoState;constructor(e,t=null){this.key=e,this.deleteResourceUndoState=t}applyTo(e){return e.getResourceDefinition(this.key)!==void 0?v(`${this.key} already exists as a Resource`):(e.setResourceDefinition(this.key,this.deleteResourceUndoState&&this.deleteResourceUndoState.resourceDefinition||new Je),e.chart.Vertices.forEach((r,i)=>{r.setResource(this.key,this.deleteResourceUndoState&&this.deleteResourceUndoState.taskIndexToDeletedResourceValue.get(i)||rn)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new _r(this.key)}},_r=class{key;constructor(e){this.key=e}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`The resource with name ${this.key} does not exist and can't be deleted.`);e.deleteResourceDefinition(this.key);let r=new Map;e.chart.Vertices.forEach((s,o)=>{let a=s.getResource(this.key)||rn;r.set(o,a),s.deleteResource(this.key)});let i={resourceDefinition:t,taskIndexToDeletedResourceValue:r};return h({plan:e,inverse:this.inverse(i)})}inverse(e){return new $r(this.key,e)}},Nr=class{key;value;indicesOfTasksToChange=[];constructor(e,t,r=[]){this.key=e,this.value=t,this.indicesOfTasksToChange=r}applyTo(e){let t=e.getResourceDefinition(this.key);return t===void 0?v(`${this.key} doesn't exist as a Resource`):t.values.findIndex(i=>i===this.value)!==-1?v(`${this.value} already exists as a value in the Resource ${this.key}.`):(t.values.push(this.value),this.indicesOfTasksToChange.forEach(i=>{e.chart.Vertices[i].setResource(this.key,this.value)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new Hr(this.key,this.value,this.indicesOfTasksToChange)}},Hr=class{key;value;indicesOfTasksToChange;constructor(e,t,r=[]){this.key=e,this.value=t,this.indicesOfTasksToChange=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} doesn't exist as a Resource`);let r=t.values.findIndex(s=>s===this.value);if(r===-1)return v(`${this.value} does not exist as a value in the Resource ${this.key}.`);if(t.values.length===1)return v(`Resources must have at least one value. ${this.value} only has one value, so it can't be deleted. `);t.values.splice(r,1);let i=[];return e.chart.Vertices.forEach((s,o)=>{let a=s.getResource(this.key);a!==void 0&&a===this.value&&(s.setResource(this.key,t.values[0]),i.push(o))}),h({plan:e,inverse:this.inverse(i)})}inverse(e){return new Nr(this.key,this.value,e)}},ls=class n{oldKey;newKey;constructor(e,t){this.oldKey=e,this.newKey=t}applyTo(e){let t=e.getResourceDefinition(this.oldKey);return t===void 0?v(`${this.oldKey} does not exist as a Resource`):e.getResourceDefinition(this.newKey)!==void 0?v(`${this.newKey} already exists as a resource name.`):(e.deleteResourceDefinition(this.oldKey),e.setResourceDefinition(this.newKey,t),e.chart.Vertices.forEach(i=>{let s=i.getResource(this.oldKey)||rn;i.setResource(this.newKey,s),i.deleteResource(this.oldKey)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.newKey,this.oldKey)}},cs=class n{key;oldValue;newValue;constructor(e,t,r){this.key=e,this.oldValue=t,this.newValue=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);let r=t.values.indexOf(this.oldValue);return r===-1?v(`${this.key} does not a value ${this.oldValue}`):t.values.indexOf(this.newValue)!==-1?v(`${this.key} already has a value ${this.newValue}`):(t.values.splice(r,1,this.newValue),e.chart.Vertices.forEach(s=>{s.getResource(this.key)===this.oldValue&&s.setResource(this.key,this.newValue)}),h({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.key,this.newValue,this.oldValue)}},us=class n{key;oldIndex;newIndex;constructor(e,t,r){this.key=e,this.oldIndex=t,this.newIndex=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);if(this.newIndex<0)return v(`${this.newIndex} is not a valid target value.`);if(this.oldIndex>t.values.length-1)return v(`${this.key} does not have a value at index ${this.oldIndex}`);if(this.newIndex>t.values.length-1)return v(`${this.key} does not have a value at index ${this.newIndex}`);let r=t.values[this.oldIndex];return t.values[this.oldIndex]=t.values[this.newIndex],t.values[this.newIndex]=r,h({plan:e,inverse:this.inverse()})}inverse(){return new n(this.key,this.newIndex,this.oldIndex)}},ds=class n{key;value;taskIndex;constructor(e,t,r){this.key=e,this.value=t,this.taskIndex=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);if(t.values.findIndex(o=>o===this.value)===-1)return v(`${this.key} does not have a value of ${this.value}`);if(this.taskIndex<0||this.taskIndex>=e.chart.Vertices.length)return v(`There is no Task at index ${this.taskIndex}`);let i=e.chart.Vertices[this.taskIndex],s=i.getResource(this.key);return i.setResource(this.key,this.value),h({plan:e,inverse:this.inverse(s)})}inverse(e){return new n(this.key,e,this.taskIndex)}};function Ur(n){return new V([new $r(n)],"AddResourceOp")}function Go(n){return new V([new _r(n)],"DeleteResourceOp")}function Vr(n,e){return new V([new Nr(n,e)],"AddResourceOptionOp")}function Fr(n,e){return new V([new Hr(n,e)],"DeleteResourceOptionOp")}function Jo(n,e,t){return new V([new cs(n,e,t)],"RenameResourceOptionOp")}function Xo(n,e){return new V([new ls(n,e)],"RenameResourceOp")}function sn(n,e,t){return new V([new us(n,e,t)],"MoveResourceOptionOp")}function He(n,e,t){return new V([new ds(n,e,t)],"SetResourceValueOp")}var hs=class extends HTMLElement{explanMain=null;resourceDefinition=new Je;name="";planDefinitionChangedCallback;newValueCounter=0;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}showModal(e,t,r){this.explanMain=e,this.resourceDefinition=r,this.name=t,this.render(),this.querySelector("dialog").showModal()}render(){H(this.template(),this)}cancel(){this.querySelector("dialog").close()}async executeOp(e){let t=await Y(e,"planDefinitionChanged",!0,this.explanMain);return _(t),t}async changeResourceName(e,t,r){let i=await this.executeOp(Xo(r,t));_(i),this.name=t}async changeResourceValueName(e,t,r){let i=await this.executeOp(Jo(this.name,r,t));_(i)}getProposedResourceName(){return this.newValueCounter++,`New Value ${this.newValueCounter}`}async newResourceValue(){this.newValueCounter=0;let e=this.getProposedResourceName();for(;this.explanMain.plan.resourceDefinitions[this.name].values.findIndex(t=>t===e)!=-1;)e=this.getProposedResourceName();await this.executeOp(Vr(this.name,e))}async moveUp(e,t){await this.executeOp(sn(this.name,t,t-1))}async moveDown(e,t){await this.executeOp(sn(this.name,t,t+1))}async moveToTop(e,t){await this.executeOp(sn(this.name,t,0))}async moveToBottom(e,t){await this.executeOp(sn(this.name,t,this.explanMain.plan.resourceDefinitions[this.name].values.length-1))}async deleteResourceValue(e,t){await this.executeOp(Fr(this.name,e))}template(){return k`
      <dialog>
        <label>
          Name:
          <input
            type="text"
            .value=${oe(this.name)}
            data-old-name=${this.name}
            @change=${e=>{let t=e.target;this.changeResourceName(e,t.value,t.dataset.oldName||"")}}
          />
        </label>
        <table>
          ${this.resourceDefinition.values.map((e,t)=>k`<tr>
                <td>${t===0?"*":""}</td>
                <td>
                  <input
                    data-old-value=${e}
                    @change=${r=>{let i=r.target;this.changeResourceValueName(r,i.value,i.dataset.oldValue||"")}}
                    .value=${oe(e)}
                    type="text"
                  />
                </td>
                <td>
                  <button
                    @click=${()=>this.moveUp(e,t)}
                    class="icon-button"
                    .disabled=${t===0}
                  >
                    ${q("keyboard-up-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===this.resourceDefinition.values.length-1}
                    class="icon-button"
                    @click=${()=>this.moveDown(e,t)}
                  >
                    ${q("keyboard-down-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===this.resourceDefinition.values.length-1}
                    class="icon-button"
                    @click=${()=>this.moveToBottom(e,t)}
                  >
                    ${q("keyboard-double-down-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===0}
                    class="icon-button"
                    @click=${()=>this.moveToTop(e,t)}
                  >
                    ${q("keyboard-double-up-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${this.resourceDefinition.values.length===1}
                    class="icon-button"
                    @click=${()=>this.deleteResourceValue(e,t)}
                  >
                    ${q("delete-icon")}
                  </button>
                </td>
              </tr>`)}
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>
              <button
                @click=${()=>{this.newResourceValue()}}
              >
                New
              </button>
            </td>
          </tr>
        </table>
        <div class="dialog-footer">
          <button @click=${()=>this.cancel()}>Close</button>
        </div>
        <p>* = default</p>
      </dialog>
    `}};customElements.define("edit-resource-definition",hs);var Ie=class n{_precision;constructor(e=0){Number.isFinite(e)||(e=0),this._precision=Math.abs(Math.trunc(e))}round(e){return+e.toFixed(this._precision)}rounder(){return e=>this.round(e)}get precision(){return this._precision}toJSON(){return{precision:this._precision}}static fromJSON(e){return e===void 0?new n:new n(e.precision)}};var $e=class n{range;default;isStatic;precision;hideEditor;constructor(e,t=new ce,r=!1,i=new Ie(1),s=!1){this.precision=i,this.range=t,this.default=e,this.isStatic=r,this.hideEditor=s,this.rationalize()}rationalize(){this.range=new ce(this.precision.round(this.range.min),this.precision.round(this.range.max)),this.default=this.clampAndRound(this.default)}clampAndRound(e){return this.precision.round(this.range.clamp(e))}toJSON(){return{range:this.range.toJSON(),default:this.default,precision:this.precision.toJSON()}}static fromJSON(e){return e===void 0?new n(0):new n(e.default||0,ce.fromJSON(e.range),!1,Ie.fromJSON(e.precision))}};var ps=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){H(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){let e=this.explanMain.plan.metricDefinitions,t=Object.keys(e).sort((r,i)=>{let s=e[r],o=e[i];return s.isStatic===o.isStatic?r.localeCompare(i):s.isStatic?-1:1});return k` <h3>Metrics</h3>
      <table>
        <tr>
          <th>Name</th>
          <th>Min</th>
          <th>Max</th>
          <th>Default</th>
          <th></th>
          <th></th>
        </tr>

        ${t.map(r=>{let i=this.explanMain.plan.metricDefinitions[r];return k`
            <tr>
              <td>${r}</td>
              <td>${Ot(i.range.min)}</td>
              <td>${Ot(i.range.max)}</td>
              <td>${i.default}</td>
              <td>
                ${this.delButtonIfNotStatic(r,i.isStatic)}
              </td>
              <td>
                ${this.editButtonIfNotStatic(r,i.isStatic)}
              </td>
            </tr>
          `})}
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              class="icon-button"
              title="Add a new Resource."
              @click=${()=>{this.newMetric()}}
            >
              ${q("add-icon")}
            </button>
          </td>
        </tr>
      </table>`}delButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Delete this metric."
      @click=${()=>this.deleteMetric(e)}
    >
      ${q("delete-icon")}
    </button>`}async deleteMetric(e){let t=await Y(ko(e),"planDefinitionChanged",!0,this.explanMain);_(t),this.render()}editButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Edit the resource definition."
      @click=${()=>this.editMetric(e)}
    >
      ${q("edit-icon")}
    </button>`}editMetric(e){this.explanMain.querySelector("edit-metric-definition").showModal(this.explanMain,e)}async newMetric(){let e=await document.querySelector("prompt-dialog").prompt("Metric Name");if(e===null)return;if(e=e.trim(),e===""){le(new Error("Metric names cannot be empty and must contain more than whitespace characters."));return}let t=await Y(On(e,new $e(0)),"planDefinitionChanged",!0,this.explanMain);_(t),this.render()}};customElements.define("edit-metrics-panel",ps);var ms=class extends HTMLElement{explanMain=null;metricName="";planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){H(this.template(),this)}template(){let e=this.explanMain?.plan.metricDefinitions[this.metricName];return e?k`<dialog>
      <table>
        <tr>
          <th>Name</th>
          <td>
            <input
              .value=${oe(this.metricName)}
              @change=${t=>this.nameChange(t)}
            />
          </td>
          <td></td>
        </tr>
        <tr>
          <th>Min</th>
          <td>
            <input
              .value=${oe(Ot(e.range.min))}
              ?disabled=${e.range.min===-Number.MAX_VALUE}
              @change=${t=>this.minChange(t)}
            />
          </td>
          <td>
            <label>
              <input
                type="checkbox"
                ?checked=${e.range.min!==-Number.MAX_VALUE}
                @change=${t=>{this.minLimitChange(t)}}
              />
              Limit</label
            >
          </td>
        </tr>
        <tr>
          <th>Max</th>
          <td>
            <input
              .value=${oe(Ot(e.range.max))}
              ?disabled=${e.range.max===Number.MAX_VALUE}
              @change=${t=>this.maxChange(t)}
            />
          </td>
          <td>
            <label>
              <input
                type="checkbox"
                ?checked=${e.range.max!==Number.MAX_VALUE}
                @change=${t=>{this.maxLimitChange(t)}}
              />
              Limit</label
            >
          </td>
        </tr>
        <tr>
          <th>Precision</th>
          <td>
            <input
              .value=${oe(e.precision.precision)}
              @change=${t=>{this.precisionChange(t)}}
            />
          </td>
          <td></td>
        </tr>
        <tr>
          <th>Default</th>
          <td>
            <input
              .value=${oe(e.default)}
              @change=${t=>{this.defaultChange(t)}}
            />
          </td>
          <td></td>
        </tr>
      </table>
      <div class="dialog-footer">
        <button @click=${()=>this.cancel()}>Close</button>
      </div>
    </dialog>`:k``}async executeOp(e){let t=await Y(e,"planDefinitionChanged",!0,this.explanMain);return _(t),t}async minLimitChange(e){let t=e.target,r=this.getDefinitionCopy();if(t.checked){let i=0<r.range.max?0:r.range.max-1;r.range=new ce(i,r.range.max)}else r.range=new ce(-Number.MAX_VALUE,r.range.max);this.updateMetricDefinition(r)}async maxLimitChange(e){let t=e.target,r=this.getDefinitionCopy();if(t.checked){let i=100>r.range.min?100:r.range.min+1;r.range=new ce(r.range.min,i)}else r.range=new ce(r.range.min,Number.MAX_VALUE);this.updateMetricDefinition(r)}async nameChange(e){let t=e.target,r=this.metricName,i=t.value;this.metricName=i,(await this.executeOp(To(r,i))).ok||(this.metricName=r),this.render()}async defaultChange(e){let t=e.target,r=this.getDefinitionCopy();r.default=+t.value,this.updateMetricDefinition(r)}async precisionChange(e){let t=e.target,r=this.getDefinitionCopy();r.precision=new Ie(+t.value),this.updateMetricDefinition(r)}async minChange(e){let r=+e.target.value,i=this.getDefinitionCopy();i.range=new ce(r,i.range.max),this.updateMetricDefinition(i)}async maxChange(e){let r=+e.target.value,i=this.getDefinitionCopy();i.range=new ce(i.range.min,r),this.updateMetricDefinition(i)}async updateMetricDefinition(e){e.rationalize();let t=await this.executeOp(yo(this.metricName,e));t.ok||le(t.error),this.render()}getDefinitionCopy(){let e=this.explanMain?.plan.metricDefinitions[this.metricName];return $e.fromJSON(e?.toJSON())}cancel(){this.querySelector("dialog").close()}showModal(e,t){this.explanMain=e,this.metricName=t,this.render(),this.querySelector("dialog").showModal()}};customElements.define("edit-metric-definition",ms);var gs={pred:"Predecessors",succ:"Successors"},Yo=(n,e,t)=>k`
  <tr>
    <th>${gs[e]}</th>
    <th></th>
  </tr>
  ${t.map(r=>{let i=n.tasks[r];return k`<tr>
      <td>${i.name}</td>
      <td>
        <button
          class="icon-button"
          title="Delete the dependency on ${i.name}"
          @click=${()=>n.deleteDep(r,e)}
        >
          ${q("delete-icon")}
        </button>
      </td>
    </tr>`})}
  <tr>
    <td></td>
    <td>
      <button
        class="icon-button"
        @click=${()=>n.addDep(e)}
        title="Add dependency."
      >
        ${q("add-icon")}
      </button>
    </td>
  </tr>
`,Qo=n=>k`
  <table>
    ${Yo(n,"pred",n.predIndexes)}
    ${Yo(n,"succ",n.succIndexes)}
  </table>
`,fs=class extends HTMLElement{tasks=[];predIndexes=[];succIndexes=[];connectedCallback(){H(Qo(this),this)}setTasksAndIndices(e,t,r){this.tasks=e;let i=e.length-1;this.predIndexes=t.filter(s=>s!==0&&s!==i),this.succIndexes=r.filter(s=>s!==0&&s!==i),H(Qo(this),this)}deleteDep(e,t){this.dispatchEvent(new CustomEvent("delete-dependency",{bubbles:!0,detail:{taskIndex:e,depType:t}}))}addDep(e){this.dispatchEvent(new CustomEvent("add-dependency",{bubbles:!0,detail:{taskIndex:-1,depType:e}}))}};customElements.define("dependencies-panel",fs);var Zo=(n,e,t)=>{let r=at(n.Edges),i=s=>{if(t(n.Vertices[s],s)===!1)return;let o=r.get(s);o!==void 0&&o.forEach(a=>{i(a.j)})};i(e)};var ml=(n,e)=>{if(n>=e.Vertices.length-1||n<=0)return[];let t=new Set;return Zo(e,n,(r,i)=>(t.add(i),!0)),t.delete(e.Vertices.length-1),[...t.values()]},fl=(n,e)=>{if(n>=e.Vertices.length-1||n<=0)return[];let t=[n],r=new Set,i=Ct(e.Edges);for(;t.length!==0;){let s=t.pop();r.add(s);let o=i.get(s);o&&t.push(...o.map(a=>a.i))}return r.delete(0),[...r.values()]},ea=n=>{let e=[];for(let t=1;t<n.Vertices.length-1;t++)e.push(t);return e},on=(n,e)=>{let t=new Set(e);return n.filter(r=>t.has(r)===!1)},ta=(n,e)=>{let i=(at(e.Edges).get(n)||[]).map(s=>s.j);return on(ea(e),[...fl(n,e),...i])},na=(n,e)=>{let i=(Ct(e.Edges).get(n)||[]).map(l=>l.i),s=ml(n,e),o=ea(e),a=[...s,...i];return on(o,a)};var bs=class extends HTMLElement{titleElement=null;taskSearchControl=null;dialog=null;resolve=()=>{};connectedCallback(){this.titleElement=this.querySelector("h2"),this.taskSearchControl=this.querySelector("task-search-control"),this.dialog=this.querySelector("dialog"),this.dialog.addEventListener("cancel",()=>this.resolve(void 0)),this.taskSearchControl.addEventListener("task-change",e=>{this.dialog.close(),this.resolve(e.detail.taskIndex)}),this.querySelector("#dependency-cancel").addEventListener("click",()=>{this.dialog.close()})}selectDependency(e,t,r){this.titleElement.textContent=gs[r];let i=[];return r==="pred"?i=na(t,e):i=ta(t,e),this.taskSearchControl.tasks=e.Vertices,this.taskSearchControl.includedIndexes=i,this.taskSearchControl.setKeyboardFocusToInput("name-only"),new Promise((o,a)=>{this.resolve=o,this.dialog.showModal()})}};customElements.define("add-dependency-dialog",bs);var ra=80,vs=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}setConfig(e){this.explanMain=e,this.render()}render(){H(this.template(),this)}valuesToShortString(e){let t=e.join(", ");return t.length>ra&&(t=t.slice(0,ra)+" ..."),t}delButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Delete this resource."
      @click=${()=>this.deleteResource(e)}
    >
      ${q("delete-icon")}
    </button>`}editButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Edit the resource definition."
      @click=${()=>this.editResource(e)}
    >
      ${q("edit-icon")}
    </button>`}async deleteResource(e){let t=await Y(Go(e),"planDefinitionChanged",!0,this.explanMain);_(t),this.render()}editResource(e){this.explanMain.querySelector("edit-resource-definition").showModal(this.explanMain,e,this.explanMain.plan.resourceDefinitions[e])}async newResource(){let e=await document.querySelector("prompt-dialog").prompt("Resource Name");if(e===null)return;if(e=e.trim(),e===""){le(new Error("Resource names cannot be empty and must contain more than whitespace characters."));return}let t=await Y(Ur(e),"planDefinitionChanged",!0,this.explanMain);_(t),this.render()}template(){let e=this.explanMain.plan.resourceDefinitions,t=Object.keys(e).sort((r,i)=>{let s=e[r],o=e[i];return s.isStatic===o.isStatic?r.localeCompare(i):s.isStatic?-1:1});return k`
      <h3>Resources</h3>
      <table>
        <tr>
          <th>Name</th>
          <th>Values</th>
          <th>Delete</th>
          <th>Edit</th>
        </tr>
        ${t.map(r=>{let i=e[r];return k`<tr>
            <td>${r}</td>
            <td>${this.valuesToShortString(i.values)}</td>
            <td>${this.delButtonIfNotStatic(r,i.isStatic)}</td>
            <td>${this.editButtonIfNotStatic(r,i.isStatic)}</td>
          </tr>`})}
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              class="icon-button"
              title="Add a new Resource."
              @click=${()=>{this.newResource()}}
            >
              ${q("add-icon")}
            </button>
          </td>
        </tr>
      </table>
    `}};customElements.define("edit-resources-panel",vs);var Br=class{a;b;c;F_c;constructor(e,t,r){this.a=e,this.b=t,this.c=r,this.F_c=(r-e)/(t-e)}sample(e){return e<0?0:e>1?1:e<this.F_c?this.a+Math.sqrt(e*(this.b-this.a)*(this.c-this.a)):this.b-Math.sqrt((1-e)*(this.b-this.a)*(this.b-this.c))}};var ks={low:1.1,moderate:1.5,high:2,extreme:5},zr=class{triangular;constructor(e,t){let r=ks[t];this.triangular=new Br(e/r,e*r,e)}sample(e){return this.triangular.sample(e)}};var ia={Duration:new $e(0,new ce(0),!0,new Ie(0),!0)},sa={Uncertainty:new Je(Object.keys(ks),!0)},Ue=class n{chart;_durationUnits;_status={stage:"unstarted",start:0};taskCompletion={};resourceDefinitions;metricDefinitions;get status(){return this._status}get durationUnits(){return this._durationUnits}set status(e){this._status=e,this._durationUnits=Lr[this._durationUnits.kind()](new Date(Jt(this.status)),this.getStaticMetricDefinition("Duration"))}setTaskCompletion(e,t){let r=this.chart.Vertices[e];return r===void 0?v(new Error(`${e} is not a valid Task index.`)):(this.taskCompletion[r.id]=t,h(null))}getTaskCompletion(e){let t=this.chart.Vertices[e];return t===void 0?v(new Error(`${e} is not a valid Task index.`)):h(this.taskCompletion[t.id]||{stage:"unstarted"})}constructor(){this.chart=new Xt,this.resourceDefinitions=Object.assign({},sa),this.metricDefinitions=Object.assign({},ia),this._durationUnits=new nn(new Date(Jt(this.status)),this.getStaticMetricDefinition("Duration")),this.applyMetricsAndResourcesToVertices()}setDurationUnits(e){let t=$t(this._durationUnits.kind()),r=$t(e);this._durationUnits=Lr[e](new Date(Jt(this.status)),this.getStaticMetricDefinition("Duration")),this.chart.Vertices.forEach(i=>{let s=Wo(i.duration,t,r);if(!s.ok){reportError(s.error);return}i.duration=s.value})}getStaticMetricDefinition(e){return this.metricDefinitions[e]}getStaticResourceDefinition(e){return this.resourceDefinitions[e]}applyMetricsAndResourcesToVertices(){Object.keys(this.metricDefinitions).forEach(e=>{let t=this.metricDefinitions[e];this.chart.Vertices.forEach(r=>{r.setMetric(e,t.default)})}),Object.entries(this.resourceDefinitions).forEach(([e,t])=>{this.chart.Vertices.forEach(r=>{r.setResource(e,t.values[0])})})}getMetricDefinition(e){return this.metricDefinitions[e]}setMetricDefinition(e,t){this.metricDefinitions[e]=t}deleteMetricDefinition(e){delete this.metricDefinitions[e]}getResourceDefinition(e){return this.resourceDefinitions[e]}setResourceDefinition(e,t){this.resourceDefinitions[e]=t}deleteResourceDefinition(e){delete this.resourceDefinitions[e]}newTask(){let e=new Tt;return Object.keys(this.metricDefinitions).forEach(t=>{let r=this.getMetricDefinition(t);e.setMetric(t,r.default)}),Object.entries(this.resourceDefinitions).forEach(([t,r])=>{e.setResource(t,r.values[0])}),e}toJSON(){return{status:Ln(this.status),taskCompletion:Nn(this.taskCompletion),_durationUnits:this._durationUnits.toJSON(),chart:this.chart.toJSON(),resourceDefinitions:Object.fromEntries(Object.entries(this.resourceDefinitions).filter(([e,t])=>!t.isStatic).map(([e,t])=>[e,t.toJSON()])),metricDefinitions:Object.fromEntries(Object.entries(this.metricDefinitions).filter(([e,t])=>!t.isStatic).map(([e,t])=>[e,t.toJSON()]))}}static fromJSON(e){let t=new n;t.chart=Xt.fromJSON(e.chart),t.status=In(e.status),t.taskCompletion=Hn(e.taskCompletion);let r=Object.fromEntries(Object.entries(e.metricDefinitions).map(([s,o])=>[s,$e.fromJSON(o)]));t.metricDefinitions=Object.assign({},ia,r);let i=Object.fromEntries(Object.entries(e.resourceDefinitions).map(([s,o])=>[s,Je.fromJSON(o)]));return t.resourceDefinitions=Object.assign({},sa,i),t._durationUnits=Et.fromJSON(e._durationUnits,new Date(Jt(t.status)),t.getStaticMetricDefinition("Duration")),t}static FromJSONText=e=>{try{let t=JSON.parse(e),r=n.fromJSON(t),i=Ao().applyTo(r);if(!i.ok)return i;let s=lt(r.chart);return s.ok?h(r):s}catch(t){return v(t)}}};var gl="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xF6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",bl="\u03B5\u03BB1\u03C52\u0431\u04331\u0435\u043B3\u0434\u0435\u0442\u04384\u0435\u044E2\u043A\u0430\u0442\u043E\u043B\u0438\u043A6\u043E\u043C3\u043C\u043A\u04342\u043E\u043D1\u0441\u043A\u0432\u04306\u043E\u043D\u043B\u0430\u0439\u043D5\u0440\u04333\u0440\u0443\u04412\u04442\u0441\u0430\u0439\u04423\u0440\u04313\u0443\u043A\u04403\u049B\u0430\u04373\u0570\u0561\u05753\u05D9\u05E9\u05E8\u05D0\u05DC5\u05E7\u05D5\u05DD3\u0627\u0628\u0648\u0638\u0628\u064A5\u0631\u0627\u0645\u0643\u06485\u0644\u0627\u0631\u062F\u06464\u0628\u062D\u0631\u064A\u06465\u062C\u0632\u0627\u0626\u06315\u0633\u0639\u0648\u062F\u064A\u06296\u0639\u0644\u064A\u0627\u06465\u0645\u063A\u0631\u06285\u0645\u0627\u0631\u0627\u062A5\u06CC\u0631\u0627\u06465\u0628\u0627\u0631\u062A2\u0632\u0627\u06314\u064A\u062A\u06433\u06BE\u0627\u0631\u062A5\u062A\u0648\u0646\u06334\u0633\u0648\u062F\u0627\u06463\u0631\u064A\u06295\u0634\u0628\u0643\u06294\u0639\u0631\u0627\u06422\u06282\u0645\u0627\u06464\u0641\u0644\u0633\u0637\u064A\u06466\u0642\u0637\u06313\u0643\u0627\u062B\u0648\u0644\u064A\u06436\u0648\u06453\u0645\u0635\u06312\u0644\u064A\u0633\u064A\u06275\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u06277\u0642\u06394\u0647\u0645\u0631\u0627\u06475\u067E\u0627\u06A9\u0633\u062A\u0627\u06467\u0680\u0627\u0631\u062A4\u0915\u0949\u092E3\u0928\u0947\u091F3\u092D\u093E\u0930\u09240\u092E\u094D3\u094B\u09245\u0938\u0902\u0917\u0920\u09285\u09AC\u09BE\u0982\u09B2\u09BE5\u09AD\u09BE\u09B0\u09A42\u09F0\u09A44\u0A2D\u0A3E\u0A30\u0A244\u0AAD\u0ABE\u0AB0\u0AA44\u0B2D\u0B3E\u0B30\u0B244\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE6\u0BB2\u0B99\u0BCD\u0B95\u0BC86\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD11\u0C2D\u0C3E\u0C30\u0C24\u0C4D5\u0CAD\u0CBE\u0CB0\u0CA44\u0D2D\u0D3E\u0D30\u0D24\u0D025\u0DBD\u0D82\u0D9A\u0DCF4\u0E04\u0E2D\u0E213\u0E44\u0E17\u0E223\u0EA5\u0EB2\u0EA73\u10D2\u10D42\u307F\u3093\u306A3\u30A2\u30DE\u30BE\u30F34\u30AF\u30E9\u30A6\u30C94\u30B0\u30FC\u30B0\u30EB4\u30B3\u30E02\u30B9\u30C8\u30A23\u30BB\u30FC\u30EB3\u30D5\u30A1\u30C3\u30B7\u30E7\u30F36\u30DD\u30A4\u30F3\u30C84\u4E16\u754C2\u4E2D\u4FE11\u56FD1\u570B1\u6587\u7F513\u4E9A\u9A6C\u900A3\u4F01\u4E1A2\u4F5B\u5C712\u4FE1\u606F2\u5065\u5EB72\u516B\u53662\u516C\u53F81\u76CA2\u53F0\u6E7E1\u70632\u5546\u57CE1\u5E971\u68072\u5609\u91CC0\u5927\u9152\u5E975\u5728\u7EBF2\u5927\u62FF2\u5929\u4E3B\u65593\u5A31\u4E502\u5BB6\u96FB2\u5E7F\u4E1C2\u5FAE\u535A2\u6148\u55842\u6211\u7231\u4F603\u624B\u673A2\u62DB\u80582\u653F\u52A11\u5E9C2\u65B0\u52A0\u57612\u95FB2\u65F6\u5C1A2\u66F8\u7C4D2\u673A\u67842\u6DE1\u9A6C\u95213\u6E38\u620F2\u6FB3\u95802\u70B9\u770B2\u79FB\u52A82\u7EC4\u7EC7\u673A\u67844\u7F51\u57401\u5E971\u7AD91\u7EDC2\u8054\u901A2\u8C37\u6B4C2\u8D2D\u72692\u901A\u8CA92\u96C6\u56E22\u96FB\u8A0A\u76C8\u79D14\u98DE\u5229\u6D663\u98DF\u54C12\u9910\u53852\u9999\u683C\u91CC\u62C93\u6E2F2\uB2F7\uB1371\uCEF42\uC0BC\uC1312\uD55C\uAD6D2",Ht=(n,e)=>{for(let t in e)n[t]=e[t];return n},Rs="numeric",Ds="ascii",Ms="alpha",cn="asciinumeric",ln="alphanumeric",Cs="domain",ha="emoji",vl="scheme",kl="slashscheme",Ts="whitespace";function Tl(n,e){return n in e||(e[n]=[]),e[n]}function St(n,e,t){e[Rs]&&(e[cn]=!0,e[ln]=!0),e[Ds]&&(e[cn]=!0,e[Ms]=!0),e[cn]&&(e[ln]=!0),e[Ms]&&(e[ln]=!0),e[ln]&&(e[Cs]=!0),e[ha]&&(e[Cs]=!0);for(let r in e){let i=Tl(r,t);i.indexOf(n)<0&&i.push(n)}}function yl(n,e){let t={};for(let r in e)e[r].indexOf(n)>=0&&(t[r]=!0);return t}function Ee(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}Ee.groups={};Ee.prototype={accepts(){return!!this.t},go(n){let e=this,t=e.j[n];if(t)return t;for(let r=0;r<e.jr.length;r++){let i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(n))return s}return e.jd},has(n,e=!1){return e?n in this.j:!!this.go(n)},ta(n,e,t,r){for(let i=0;i<n.length;i++)this.tt(n[i],e,t,r)},tr(n,e,t,r){r=r||Ee.groups;let i;return e&&e.j?i=e:(i=new Ee(e),t&&r&&St(e,t,r)),this.jr.push([n,i]),i},ts(n,e,t,r){let i=this,s=n.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(n[o]);return i.tt(n[s-1],e,t,r)},tt(n,e,t,r){r=r||Ee.groups;let i=this;if(e&&e.j)return i.j[n]=e,e;let s=e,o,a=i.go(n);if(a?(o=new Ee,Ht(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ee,s){if(r)if(o.t&&typeof o.t=="string"){let l=Ht(yl(o.t,r),t);St(s,l,r)}else t&&St(s,t,r);o.t=s}return i.j[n]=o,o}};var I=(n,e,t,r,i)=>n.ta(e,t,r,i),ne=(n,e,t,r,i)=>n.tr(e,t,r,i),oa=(n,e,t,r,i)=>n.ts(e,t,r,i),g=(n,e,t,r,i)=>n.tt(e,t,r,i),Qe="WORD",As="UWORD",pa="ASCIINUMERICAL",ma="ALPHANUMERICAL",fn="LOCALHOST",Ps="TLD",Os="UTLD",Kr="SCHEME",Nt="SLASH_SCHEME",Is="NUM",Ls="WS",$s="NL",un="OPENBRACE",dn="CLOSEBRACE",Gr="OPENBRACKET",Jr="CLOSEBRACKET",Xr="OPENPAREN",Yr="CLOSEPAREN",Qr="OPENANGLEBRACKET",Zr="CLOSEANGLEBRACKET",ei="FULLWIDTHLEFTPAREN",ti="FULLWIDTHRIGHTPAREN",ni="LEFTCORNERBRACKET",ri="RIGHTCORNERBRACKET",ii="LEFTWHITECORNERBRACKET",si="RIGHTWHITECORNERBRACKET",oi="FULLWIDTHLESSTHAN",ai="FULLWIDTHGREATERTHAN",li="AMPERSAND",ci="APOSTROPHE",ui="ASTERISK",dt="AT",di="BACKSLASH",hi="BACKTICK",pi="CARET",ht="COLON",_s="COMMA",mi="DOLLAR",Ve="DOT",fi="EQUALS",Ns="EXCLAMATION",Le="HYPHEN",hn="PERCENT",gi="PIPE",bi="PLUS",vi="POUND",pn="QUERY",Hs="QUOTE",fa="FULLWIDTHMIDDLEDOT",Us="SEMI",Fe="SLASH",mn="TILDE",ki="UNDERSCORE",ga="EMOJI",Ti="SYM",ba=Object.freeze({__proto__:null,ALPHANUMERICAL:ma,AMPERSAND:li,APOSTROPHE:ci,ASCIINUMERICAL:pa,ASTERISK:ui,AT:dt,BACKSLASH:di,BACKTICK:hi,CARET:pi,CLOSEANGLEBRACKET:Zr,CLOSEBRACE:dn,CLOSEBRACKET:Jr,CLOSEPAREN:Yr,COLON:ht,COMMA:_s,DOLLAR:mi,DOT:Ve,EMOJI:ga,EQUALS:fi,EXCLAMATION:Ns,FULLWIDTHGREATERTHAN:ai,FULLWIDTHLEFTPAREN:ei,FULLWIDTHLESSTHAN:oi,FULLWIDTHMIDDLEDOT:fa,FULLWIDTHRIGHTPAREN:ti,HYPHEN:Le,LEFTCORNERBRACKET:ni,LEFTWHITECORNERBRACKET:ii,LOCALHOST:fn,NL:$s,NUM:Is,OPENANGLEBRACKET:Qr,OPENBRACE:un,OPENBRACKET:Gr,OPENPAREN:Xr,PERCENT:hn,PIPE:gi,PLUS:bi,POUND:vi,QUERY:pn,QUOTE:Hs,RIGHTCORNERBRACKET:ri,RIGHTWHITECORNERBRACKET:si,SCHEME:Kr,SEMI:Us,SLASH:Fe,SLASH_SCHEME:Nt,SYM:Ti,TILDE:mn,TLD:Ps,UNDERSCORE:ki,UTLD:Os,UWORD:As,WORD:Qe,WS:Ls}),Xe=/[a-z]/,an=/\p{L}/u,ys=/\p{Emoji}/u;var Ye=/\d/,xs=/\s/;var aa="\r",Es=`
`,xl="\uFE0F",El="\u200D",Ss="\uFFFC",jr=null,Wr=null;function Sl(n=[]){let e={};Ee.groups=e;let t=new Ee;jr==null&&(jr=la(gl)),Wr==null&&(Wr=la(bl)),g(t,"'",ci),g(t,"{",un),g(t,"}",dn),g(t,"[",Gr),g(t,"]",Jr),g(t,"(",Xr),g(t,")",Yr),g(t,"<",Qr),g(t,">",Zr),g(t,"\uFF08",ei),g(t,"\uFF09",ti),g(t,"\u300C",ni),g(t,"\u300D",ri),g(t,"\u300E",ii),g(t,"\u300F",si),g(t,"\uFF1C",oi),g(t,"\uFF1E",ai),g(t,"&",li),g(t,"*",ui),g(t,"@",dt),g(t,"`",hi),g(t,"^",pi),g(t,":",ht),g(t,",",_s),g(t,"$",mi),g(t,".",Ve),g(t,"=",fi),g(t,"!",Ns),g(t,"-",Le),g(t,"%",hn),g(t,"|",gi),g(t,"+",bi),g(t,"#",vi),g(t,"?",pn),g(t,'"',Hs),g(t,"/",Fe),g(t,";",Us),g(t,"~",mn),g(t,"_",ki),g(t,"\\",di),g(t,"\u30FB",fa);let r=ne(t,Ye,Is,{[Rs]:!0});ne(r,Ye,r);let i=ne(r,Xe,pa,{[cn]:!0}),s=ne(r,an,ma,{[ln]:!0}),o=ne(t,Xe,Qe,{[Ds]:!0});ne(o,Ye,i),ne(o,Xe,o),ne(i,Ye,i),ne(i,Xe,i);let a=ne(t,an,As,{[Ms]:!0});ne(a,Xe),ne(a,Ye,s),ne(a,an,a),ne(s,Ye,s),ne(s,Xe),ne(s,an,s);let l=g(t,Es,$s,{[Ts]:!0}),c=g(t,aa,Ls,{[Ts]:!0}),u=ne(t,xs,Ls,{[Ts]:!0});g(t,Ss,u),g(c,Es,l),g(c,Ss,u),ne(c,xs,u),g(u,aa),g(u,Es),ne(u,xs,u),g(u,Ss,u);let p=ne(t,ys,ga,{[ha]:!0});g(p,"#"),ne(p,ys,p),g(p,xl,p);let m=g(p,El);g(m,"#"),ne(m,ys,p);let T=[[Xe,o],[Ye,i]],S=[[Xe,null],[an,a],[Ye,s]];for(let P=0;P<jr.length;P++)ut(t,jr[P],Ps,Qe,T);for(let P=0;P<Wr.length;P++)ut(t,Wr[P],Os,As,S);St(Ps,{tld:!0,ascii:!0},e),St(Os,{utld:!0,alpha:!0},e),ut(t,"file",Kr,Qe,T),ut(t,"mailto",Kr,Qe,T),ut(t,"http",Nt,Qe,T),ut(t,"https",Nt,Qe,T),ut(t,"ftp",Nt,Qe,T),ut(t,"ftps",Nt,Qe,T),St(Kr,{scheme:!0,ascii:!0},e),St(Nt,{slashscheme:!0,ascii:!0},e),n=n.sort((P,C)=>P[0]>C[0]?1:-1);for(let P=0;P<n.length;P++){let C=n[P][0],$=n[P][1]?{[vl]:!0}:{[kl]:!0};C.indexOf("-")>=0?$[Cs]=!0:Xe.test(C)?Ye.test(C)?$[cn]=!0:$[Ds]=!0:$[Rs]=!0,oa(t,C,C,$)}return oa(t,"localhost",fn,{ascii:!0}),t.jd=new Ee(Ti),{start:t,tokens:Ht({groups:e},ba)}}function va(n,e){let t=wl(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=t.length,i=[],s=0,o=0;for(;o<r;){let a=n,l=null,c=0,u=null,p=-1,m=-1;for(;o<r&&(l=a.go(t[o]));)a=l,a.accepts()?(p=0,m=0,u=a):p>=0&&(p+=t[o].length,m++),c+=t[o].length,s+=t[o].length,o++;s-=p,o-=m,c-=p,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function wl(n){let e=[],t=n.length,r=0;for(;r<t;){let i=n.charCodeAt(r),s,o=i<55296||i>56319||r+1===t||(s=n.charCodeAt(r+1))<56320||s>57343?n[r]:n.slice(r,r+2);e.push(o),r+=o.length}return e}function ut(n,e,t,r,i){let s,o=e.length;for(let a=0;a<o-1;a++){let l=e[a];n.j[l]?s=n.j[l]:(s=new Ee(r),s.jr=i.slice(),n.j[l]=s),n=s}return s=new Ee(t),s.jr=i.slice(),n.j[e[o-1]]=s,s}function la(n){let e=[],t=[],r=0,i="0123456789";for(;r<n.length;){let s=0;for(;i.indexOf(n[r+s])>=0;)s++;if(s>0){e.push(t.join(""));for(let o=parseInt(n.substring(r,r+s),10);o>0;o--)t.pop();r+=s}else t.push(n[r]),r++}return e}var gn={defaultProtocol:"http",events:null,format:ca,formatHref:ca,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function yi(n,e=null){let t=Ht({},gn);n&&(t=Ht(t,n instanceof yi?n.o:n));let r=t.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=i}yi.prototype={o:gn,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,e,t){let r=e!=null,i=this.o[n];return i&&(typeof i=="object"?(i=t.t in i?i[t.t]:gn[n],typeof i=="function"&&r&&(i=i(e,t))):typeof i=="function"&&r&&(i=i(e,t.t,t)),i)},getObj(n,e,t){let r=this.o[n];return typeof r=="function"&&e!=null&&(r=r(e,t.t,t)),r},render(n){let e=n.render(this);return(this.get("render",null,n)||this.defaultRender)(e,n.t,n)}};function ca(n){return n}function ka(n,e){this.t="token",this.v=n,this.tk=e}ka.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){let e=this.toString(),t=n.get("truncate",e,this),r=n.get("format",e,this);return t&&r.length>t?r.substring(0,t)+"\u2026":r},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=gn.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){let e=this,t=this.toHref(n.get("defaultProtocol")),r=n.get("formatHref",t,this),i=n.get("tagName",t,e),s=this.toFormattedString(n),o={},a=n.get("className",t,e),l=n.get("target",t,e),c=n.get("rel",t,e),u=n.getObj("attributes",t,e),p=n.getObj("events",t,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Ht(o,u),{tagName:i,attributes:o,content:s,eventListeners:p}}};function xi(n,e){class t extends ka{constructor(i,s){super(i,s),this.t=n}}for(let r in e)t.prototype[r]=e[r];return t.t=n,t}var ua=xi("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),da=xi("text"),Rl=xi("nl"),qr=xi("url",{isLink:!0,toHref(n=gn.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){let n=this.tk;return n.length>=2&&n[0].t!==fn&&n[1].t===ht}});var Oe=n=>new Ee(n);function Dl({groups:n}){let e=n.domain.concat([li,ui,dt,di,hi,pi,mi,fi,Le,Is,hn,gi,bi,vi,Fe,Ti,mn,ki]),t=[ci,ht,_s,Ve,Ns,hn,pn,Hs,Us,Qr,Zr,un,dn,Jr,Gr,Xr,Yr,ei,ti,ni,ri,ii,si,oi,ai],r=[li,ci,ui,di,hi,pi,mi,fi,Le,un,dn,hn,gi,bi,vi,pn,Fe,Ti,mn,ki],i=Oe(),s=g(i,mn);I(s,r,s),I(s,n.domain,s);let o=Oe(),a=Oe(),l=Oe();I(i,n.domain,o),I(i,n.scheme,a),I(i,n.slashscheme,l),I(o,r,s),I(o,n.domain,o);let c=g(o,dt);g(s,dt,c),g(a,dt,c),g(l,dt,c);let u=g(s,Ve);I(u,r,s),I(u,n.domain,s);let p=Oe();I(c,n.domain,p),I(p,n.domain,p);let m=g(p,Ve);I(m,n.domain,p);let T=Oe(ua);I(m,n.tld,T),I(m,n.utld,T),g(c,fn,T);let S=g(p,Le);g(S,Le,S),I(S,n.domain,p),I(T,n.domain,p),g(T,Ve,m),g(T,Le,S);let P=g(T,ht);I(P,n.numeric,ua);let C=g(o,Le),A=g(o,Ve);g(C,Le,C),I(C,n.domain,o),I(A,r,s),I(A,n.domain,o);let $=Oe(qr);I(A,n.tld,$),I(A,n.utld,$),I($,n.domain,o),I($,r,s),g($,Ve,A),g($,Le,C),g($,dt,c);let nt=g($,ht),Se=Oe(qr);I(nt,n.numeric,Se);let O=Oe(qr),we=Oe();I(O,e,O),I(O,t,we),I(we,e,O),I(we,t,we),g($,Fe,O),g(Se,Fe,O);let ge=g(a,ht),rt=g(l,ht),Be=g(rt,Fe),de=g(Be,Fe);I(a,n.domain,o),g(a,Ve,A),g(a,Le,C),I(l,n.domain,o),g(l,Ve,A),g(l,Le,C),I(ge,n.domain,O),g(ge,Fe,O),g(ge,pn,O),I(de,n.domain,O),I(de,e,O),g(de,Fe,O);let ve=[[un,dn],[Gr,Jr],[Xr,Yr],[Qr,Zr],[ei,ti],[ni,ri],[ii,si],[oi,ai]];for(let ze=0;ze<ve.length;ze++){let[be,Re]=ve[ze],he=g(O,be);g(we,be,he),g(he,Re,O);let ke=Oe(qr);I(he,e,ke);let ee=Oe();I(he,t),I(ke,e,ke),I(ke,t,ee),I(ee,e,ke),I(ee,t,ee),g(ke,Re,O),g(ee,Re,O)}return g(i,fn,$),g(i,$s,Rl),{start:i,tokens:ba}}function Ml(n,e,t){let r=t.length,i=0,s=[],o=[];for(;i<r;){let a=n,l=null,c=null,u=0,p=null,m=-1;for(;i<r&&!(l=a.go(t[i].t));)o.push(t[i++]);for(;i<r&&(c=l||a.go(t[i].t));)l=null,a=c,a.accepts()?(m=0,p=a):m>=0&&m++,i++,u++;if(m<0)i-=u,i<r&&(o.push(t[i]),i++);else{o.length>0&&(s.push(ws(da,e,o)),o=[]),i-=m,u-=m;let T=p.t,S=t.slice(i-u,i);s.push(ws(T,e,S))}}return o.length>0&&s.push(ws(da,e,o)),s}function ws(n,e,t){let r=t[0].s,i=t[t.length-1].e,s=e.slice(r,i);return new n(s,t)}var fe={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Cl(){fe.scanner=Sl(fe.customSchemes);for(let n=0;n<fe.tokenQueue.length;n++)fe.tokenQueue[n][1]({scanner:fe.scanner});fe.parser=Dl(fe.scanner.tokens);for(let n=0;n<fe.pluginQueue.length;n++)fe.pluginQueue[n][1]({scanner:fe.scanner,parser:fe.parser});return fe.initialized=!0,fe}function Vs(n){return fe.initialized||Cl(),Ml(fe.parser.start,n,va(fe.scanner.start,n))}Vs.scan=va;function Ta(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Al(n){return n.replace(/"/g,"&quot;")}function Pl(n){let e=[];for(let t in n){let r=n[t]+"";e.push(`${t}="${Al(r)}"`)}return e.join(" ")}function Ol({tagName:n,attributes:e,content:t}){return`<${n} ${Pl(e)}>${Ta(t)}</${n}>`}function Fs(n,e={}){e=new yi(e,Ol);let t=Vs(n),r=[];for(let i=0;i<t.length;i++){let s=t[i];s.t==="nl"&&e.get("nl2br")?r.push(`<br>
`):!s.isLink||!e.check(s)?r.push(Ta(s.toString())):r.push(e.render(s))}return r.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(e){return Fs(this,e)}});var bn=class extends _t{constructor(e){if(super(e),this.it=te,e.type!==Ge.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===te||e==null)return this._t=void 0,this.it=e;if(e===Me)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;let t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}};bn.directiveName="unsafeHTML",bn.resultType=1;var ya=Ir(bn);var Bs=class extends HTMLElement{explanMain=null;plan=new Ue;taskIndex=-1;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){this.render(),document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}updateSelectedTaskPanel(e,t){this.explanMain=e,this.plan=e.plan,this.taskIndex=t,this.render(),window.setTimeout(()=>{let r=this.querySelector("#task-name");r.focus(),r.select()},0)}render(){H(this.template(),this)}humanDurationValue(e){let t=this.plan.durationUnits.durationToHuman(e.duration);return t.ok?t.value:(le(t.error),"")}template(){let e=this.taskIndex;if(e===-1)return k`
        <button
          class="icon-button"
          @click=${async()=>await ue("NewTaskAction",this.explanMain)}
          title="Add Task"
        >
          ${q("add-icon")}
        </button>
        <button
          class="icon-button"
          @click=${async()=>await ue("GoToSearchAction",this.explanMain)}
          title="Search (Ctrl-F)"
        >
          ${q("search")}
        </button>
        <div>No task selected.</div>
      `;if(this.explanMain===null)return k``;let t=Object.keys(this.plan.metricDefinitions).filter(s=>this.plan.metricDefinitions[s].hideEditor===!1).sort(),r=Object.keys(this.plan.resourceDefinitions).sort(),i=this.plan.chart.Vertices[e];return k`
      <button
        class="icon-button"
        @click=${async()=>await ue("NewTaskAction",this.explanMain)}
        title="Add Task"
      >
        ${q("add-icon")}
      </button>
      <button
        class="icon-button"
        @click=${async()=>await ue("DupTaskAction",this.explanMain)}
        title="Duplicate Task"
      >
        ${q("dup")}
      </button>
      <button
        class="icon-button"
        @click=${async()=>await ue("SplitTaskAction",this.explanMain)}
        title="Split Task"
      >
        ${q("split")}
      </button>

      <button
        class="icon-button"
        @click=${async()=>ue("DeleteTaskAction",this.explanMain)}
        title="Delete Task"
      >
        ${q("delete-icon")}
      </button>
      <button
        class="icon-button"
        @click=${async()=>await ue("GoToSearchAction",this.explanMain)}
        title="Search (Ctrl-F)"
      >
        ${q("search")}
      </button>
      <table>
        <tr>
          <td class="underline-first-char">Name</td>
          <td>
            <input
              type="text"
              id="task-name"
              accesskey="n"
              .value="${oe(i.name)}"
              @change=${s=>this.dispatchEvent(new CustomEvent("task-name-change",{bubbles:!0,detail:{taskIndex:e,name:s.target.value}}))}
            />
          </td>
        </tr>
        <tr>
          <!-- 
          
          Should be a div with an edit button. Contents processed through linkify.

          Assure the linkify links open in another tab/window.

          Add an edit button to open a dialog for editing the description.
          
          -->
          <td>De<u>s</u>cription</td>
          <td class="task-description">
            <p>
              ${ya(Fs(i.description,{target:"_blank"}))}
            </p>
            <button
              accesskey="s"
              class="icon-button"
              title="Edit description"
              @click=${()=>this.editDescription()}
            >
              ${q("edit-icon")}
            </button>
          </td>
        </tr>
        <tr>
          <td>D<u>u</u>ration</td>
          <td class="aligned-td">
            <input
              type="text"
              spellcheck="false"
              id="human-duration"
              accesskey="u"
              .value="${oe(this.humanDurationValue(i))}"
              @change="${s=>{let o=s.target.value,a=this.plan.durationUnits.parseHumanDuration(o);if(!a.ok){le(a.error),s.stopPropagation(),s.preventDefault();return}this.dispatchEvent(new CustomEvent("task-metric-value-change",{bubbles:!0,detail:{taskIndex:e,value:a.value,name:"Duration"}}))}}"
            />
            ${this.optionalCalculateButton(e)}
          </td>
        </tr>

        ${r.map(s=>k` <tr>
              <td>
                <label for="${s}">${s}</label>
              </td>
              <td>
                <select
                  id="${s}"
                  @change=${async o=>this.dispatchEvent(new CustomEvent("task-resource-value-change",{bubbles:!0,detail:{taskIndex:e,value:o.target.value,name:s}}))}
                >
                  ${this.plan.resourceDefinitions[s].values.map(o=>k`<option
                        name=${o}
                        .selected=${i.resources[s]===o}
                      >
                        ${o}
                      </option>`)}
                </select>
              </td>
            </tr>`)}
        ${t.map(s=>k` <tr>
              <td><label for="${s}">${s}</label></td>
              <td>
                <input
                  id="${s}"
                  .value=${oe(i.metrics[s])}
                  type="number"
                  @change=${async o=>this.dispatchEvent(new CustomEvent("task-metric-value-change",{bubbles:!0,detail:{taskIndex:e,value:+o.target.value,name:s}}))}
                />
              </td>
            </tr>`)}
      </table>
    `}optionalCalculateButton(e){if(this.plan.status.stage!=="started")return k``;let t=this.plan.getTaskCompletion(e);return t.ok?t.value.stage!=="started"?k``:k`
      <button
        class="icon-button"
        @click=${async()=>{let r=this.explanMain.getToday();r.ok&&await Y(Lo(r.value,e),"planDefinitionChanged",!0,this.explanMain)}}
        title="Recalculate Duration"
      >
        ${q("calculate")}
      </button>
    `:k``}async editDescription(){let e=this.plan.chart.Vertices[this.taskIndex],t=await document.querySelector("edit-description-dialog")?.prompt(e.description);t!=null&&await Y($o(this.taskIndex,t),"planDefinitionChanged",!0,this.explanMain)}};customElements.define("selected-task-panel",Bs);var xa=1e3,zs=new Ie(2),Ll=n=>Math.floor(Math.random()*n),Ea=(n,e,t,r)=>{let i=new Map;i.set(`${t}`,{count:0,criticalPath:t.slice(),durations:n.Vertices.map(s=>s.duration)});for(let s=0;s<e;s++){let o=n.Vertices.map((p,m)=>{if(r.has(m))return p.duration;let T=new zr(p.duration,p.getResource("Uncertainty")).sample(Ll(xa)/xa);return zs.round(T)}),a=$n(n,p=>o[p],zs.rounder());if(!a.ok)throw a.error;let l=_n(a.value,zs.rounder()),c=`${l}`,u=i.get(c);u===void 0&&(u={count:0,criticalPath:l,durations:o},i.set(c,u)),u.count++}return{paths:i,tasks:Il(i,n)}},Il=(n,e)=>{let t=new Map;return n.forEach(r=>{r.criticalPath.forEach(i=>{let s=t.get(i);s===void 0&&(s={taskIndex:i,duration:e.Vertices[i].duration,numTimesAppeared:0},t.set(i,s)),s.numTimesAppeared+=r.count})}),[...t.values()].sort((r,i)=>i.duration-r.duration)};var js=class extends HTMLElement{results={paths:new Map,tasks:[]};plan=null;chart=null;numSimulationLoops=0;originalCriticalPath=[];connectedCallback(){this.render()}simulate(e,t,r,i){return this.plan=e,this.chart=e.chart,this.results=Ea(this.chart,t,r,i),this.numSimulationLoops=t,this.originalCriticalPath=r,this.render(),this.results.tasks.map(s=>s.taskIndex)}clear(){this.results={paths:new Map,tasks:[]},this.dispatchEvent(new CustomEvent("simulation-select",{bubbles:!0,detail:{durations:null,criticalPath:[]}})),this.render()}pathClicked(e){this.dispatchEvent(new CustomEvent("simulation-select",{bubbles:!0,detail:{durations:this.results.paths.get(e).durations,criticalPath:this.results.paths.get(e).criticalPath}}))}render(){H(this.template(),this)}displayCriticalPathDifferences(e){let t=on(this.originalCriticalPath,e),r=on(e,this.originalCriticalPath);return t.length===0&&r.length===0?k`Original Critical Path`:k`
      ${r.map(i=>k`
          <span class="added">+${this.chart.Vertices[i].name}</span>
        `)}
      ${t.map(i=>k`
          <span class="removed">-${this.chart.Vertices[i].name}</span>
        `)}
    `}humanDurationValue(e){let t=this.plan.durationUnits.durationToHuman(e);return t.ok?t.value:(le(t.error),"")}template(){if(this.results.paths.size===0)return k``;let t=[...this.results.paths.keys()].sort((r,i)=>this.results.paths.get(i).count-this.results.paths.get(r).count);return k`
      <button
        @click=${()=>{this.clear()}}
      >
        Clear
      </button>

      <table class="paths">
        <tr>
          <th>Count</th>
          <th>Critical Path</th>
        </tr>
        ${t.map(r=>k`<tr @click=${()=>this.pathClicked(r)}>
              <td>${this.results.paths.get(r).count}</td>
              <td>
                ${this.displayCriticalPathDifferences(this.results.paths.get(r).criticalPath)}
              </td>
            </tr>`)}
      </table>
      <table>
        <tr>
          <th>Name</th>
          <th>Duration</th>
          <th>Frequency (%)</th>
        </tr>
        ${this.results.tasks.map(r=>k`<tr>
              <td>${this.chart.Vertices[r.taskIndex].name}</td>
              <td>${this.humanDurationValue(r.duration)}</td>
              <td>
                ${Math.floor(100*r.numTimesAppeared/this.numSimulationLoops)}
              </td>
            </tr>`)}
      </table>
    `}};customElements.define("simulation-panel",js);var Ws=class extends HTMLElement{explanMain=null;taskSearchControl=null;connectedCallback(){this.explanMain=document.querySelector("explan-main"),this.explanMain&&(this.taskSearchControl=this.querySelector("task-search-control"),this.addEventListener("task-change",e=>{this.explanMain.setSelection(e.detail.taskIndex,e.detail.focus,!0),this.classList.add("hidden")}),this.addEventListener("task-focus",()=>this.setKeyboardFocusToInput("full-info")))}setKeyboardFocusToInput(e){this.classList.remove("hidden"),this.taskSearchControl.tasks=this.explanMain.plan.chart.Vertices,this.taskSearchControl.includedIndexes=this.explanMain.plan.chart.Vertices.map((t,r)=>r).slice(1,-1),this.taskSearchControl.setKeyboardFocusToInput(e)}};customElements.define("search-task-panel",Ws);var Ra=nl(wa(),1),$l=(n,e)=>[0,...n.map(r=>[r,r+1]).flat(),e],_l=(n,e)=>{let t=[],r=!1;for(let i=0;i<n.length-1;i++){let s=e.slice(n[i],n[i+1]);r?t.push(k`<b>${s}</b>`):t.push(k`${s}`),r=!r}return t},Nl=(n,e)=>_l($l(n,e.length),e),Hl=n=>n.searchResults.map((e,t)=>k` <li
        tabindex="-1"
        @click="${()=>n.selectSearchResult(t,!1)}"
        ?data-focus=${t===n.focusIndex}
        data-index=${t}
      >
        ${Nl(e.indexes,e.target)}
      </li>`),vn=n=>k`
  <input
    autocomplete="off"
    name="task_search"
    id="search_input"
    placeholder="Search"
    type="text"
    @input="${e=>n.onInput(e.target.value)}"
    @keydown="${e=>n.onKeyDown(e)}"
    @focus="${()=>n.searchInputReceivedFocus()}"
  />
  <ul>
    ${Hl(n)}
  </ul>
`,Ul=(n,e,t,r)=>e==="full-info"?i=>{if(t.size!==0){let o=n.indexOf(i);if(!t.has(o))return""}let s=Object.keys(i.resources);return s.sort(),`${i.name} ${"-".repeat(r-i.name.length+2)} ${s.map(o=>i.resources[o]).join(" ")}`}:i=>{if(t.size!==0){let s=n.indexOf(i);if(!t.has(s))return""}return i.name},Vl=(n,e,t)=>n.filter((r,i)=>t.has(i)).map(r=>({obj:r,indexes:[],target:e(r)})),qs=class extends HTMLElement{_tasks=[];_includedIndexes=new Set;focusIndex=0;searchResults=[];searchType="name-only";taskToSearchString=()=>"";connectedCallback(){H(vn(this),this)}onInput(e){e===""?this.searchResults=Vl(this._tasks,this.taskToSearchString,this._includedIndexes):this.searchResults=Ra.default.go(e,this._tasks.slice(1,-1),{key:this.taskToSearchString,limit:this._tasks.length,threshold:.2}),this.focusIndex=0,H(vn(this),this)}onKeyDown(e){if(this.searchResults.length===0)return;switch(`${e.shiftKey?"shift-":""}${e.ctrlKey?"ctrl-":""}${e.metaKey?"meta-":""}${e.altKey?"alt-":""}${e.key}`){case"ArrowDown":this.focusIndex=(this.focusIndex+1)%this.searchResults.length,e.stopPropagation(),e.preventDefault();break;case"ArrowUp":this.focusIndex=(this.focusIndex-1+this.searchResults.length)%this.searchResults.length,e.stopPropagation(),e.preventDefault();break;case"Enter":if(this.searchResults.length===0)return;this.selectSearchResult(this.focusIndex,!1),e.stopPropagation(),e.preventDefault();break;case"ctrl-Enter":if(this.searchResults.length===0)return;this.selectSearchResult(this.focusIndex,!0),e.stopPropagation(),e.preventDefault();break;default:break}H(vn(this),this)}selectSearchResult(e,t){let r=this._tasks.indexOf(this.searchResults[e].obj);this.dispatchEvent(new CustomEvent("task-change",{bubbles:!0,detail:{taskIndex:r,focus:t}})),this.searchResults=[],H(vn(this),this)}searchInputReceivedFocus(){this.dispatchEvent(new CustomEvent("task-focus",{bubbles:!0}))}setKeyboardFocusToInput(e){this.searchType=e;let t=this.querySelector("input");t.focus(),t.select(),this.onInput(t.value),H(vn(this),this)}set tasks(e){this._tasks=e,this.buildTaskToSearchString()}set includedIndexes(e){this._includedIndexes=new Set(e),this.buildTaskToSearchString()}buildTaskToSearchString(){let e=this._tasks.reduce((t,r)=>r.name.length>t?r.name.length:t,0);this.taskToSearchString=Ul(this._tasks,this.searchType,this._includedIndexes,e),this.onInput("")}};customElements.define("task-search-control",qs);var z=(n,e)=>({x:n,y:e});var re=(n,e)=>{let[t,r]=e;return{x:Math.floor(n.x+t),y:Math.floor(n.y+r)}},Ut=(n,e)=>n.x===e.x&&n.y===e.y,Ze=n=>({x:n.x,y:n.y}),Da=(n,e)=>[e.x-n.x,e.y-n.y];var Ks="divider_move",Ma="resizing",Ca="dragging",Fl=n=>{let e=n.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height}},Si=class{begin=null;parentRect=null;currentMoveLocation=z(0,0);lastMoveSent=z(0,0);parent;divider;internvalHandle=0;dividerType;constructor(e,t,r="column"){this.parent=e,this.divider=t,this.dividerType=r,this.divider.addEventListener("mousedown",this.mousedown.bind(this))}detach(){this.parent.removeEventListener("mousemove",this.mousemove.bind(this)),this.divider.removeEventListener("mousedown",this.mousedown.bind(this)),this.parent.removeEventListener("mouseup",this.mouseup.bind(this)),this.parent.removeEventListener("mouseleave",this.mouseleave.bind(this)),window.clearInterval(this.internvalHandle)}onTimeout(){if(!Ut(this.currentMoveLocation,this.lastMoveSent)){let e=0;this.dividerType==="column"?e=100*(this.currentMoveLocation.x-this.parentRect.left)/this.parentRect.width:e=100*(this.currentMoveLocation.y-this.parentRect.top)/this.parentRect.height,e=Ne(e,5,95),this.parent.dispatchEvent(new CustomEvent(Ks,{detail:{before:e,after:100-e}})),this.lastMoveSent=Ze(this.currentMoveLocation)}}mousemove(e){this.begin!==null&&(this.currentMoveLocation.x=e.pageX,this.currentMoveLocation.y=e.pageY)}mousedown(e){this.internvalHandle=window.setInterval(this.onTimeout.bind(this),16),this.parentRect=Fl(this.parent),this.parent.classList.add(Ma),this.divider.classList.add(Ca),this.parent.addEventListener("mousemove",this.mousemove.bind(this)),this.parent.addEventListener("mouseup",this.mouseup.bind(this)),this.parent.addEventListener("mouseleave",this.mouseleave.bind(this)),this.begin=z(e.pageX,e.pageY)}mouseup(e){this.begin!==null&&this.finished(z(e.pageX,e.pageY))}mouseleave(e){this.begin!==null&&this.finished(z(e.pageX,e.pageY))}finished(e){window.clearInterval(this.internvalHandle),this.parent.classList.remove(Ma),this.divider.classList.remove(Ca),this.parent.removeEventListener("mousemove",this.mousemove.bind(this)),this.parent.removeEventListener("mouseup",this.mouseup.bind(this)),this.parent.removeEventListener("mouseleave",this.mouseleave.bind(this)),this.currentMoveLocation=e,this.onTimeout(),this.begin=null,this.currentMoveLocation=z(0,0),this.lastMoveSent=z(0,0)}};var Gs="dragrange",wi=class{begin=null;currentMoveLocation=z(0,0);lastMoveSent=z(0,0);ele;internvalHandle=0;constructor(e){this.ele=e,e.addEventListener("mousemove",this.mousemove.bind(this)),e.addEventListener("mousedown",this.mousedown.bind(this)),e.addEventListener("mouseup",this.mouseup.bind(this)),e.addEventListener("mouseleave",this.mouseleave.bind(this))}detach(){this.ele.removeEventListener("mousemove",this.mousemove.bind(this)),this.ele.removeEventListener("mousedown",this.mousedown.bind(this)),this.ele.removeEventListener("mouseup",this.mouseup.bind(this)),this.ele.removeEventListener("mouseleave",this.mouseleave.bind(this)),window.clearInterval(this.internvalHandle)}onTimeout(){Ut(this.currentMoveLocation,this.lastMoveSent)||(this.ele.dispatchEvent(new CustomEvent(Gs,{detail:{begin:Ze(this.begin),end:Ze(this.currentMoveLocation)}})),this.lastMoveSent=Ze(this.currentMoveLocation))}mousemove(e){this.begin!==null&&(this.currentMoveLocation.x=e.offsetX,this.currentMoveLocation.y=e.offsetY)}mousedown(e){this.internvalHandle=window.setInterval(this.onTimeout.bind(this),16),this.begin=z(e.offsetX,e.offsetY)}mouseup(e){this.finished(z(e.offsetX,e.offsetY))}mouseleave(e){this.begin!==null&&this.finished(z(e.offsetX,e.offsetY))}finished(e){window.clearInterval(this.internvalHandle),this.currentMoveLocation=e,this.onTimeout(),this.begin=null,this.currentMoveLocation=z(0,0),this.lastMoveSent=z(0,0)}};var Ri=class{currentMoveLocation=z(0,0);lastReadLocation=z(0,0);ele;constructor(e){this.ele=e,e.addEventListener("mousemove",this.mousemove.bind(this))}detach(){this.ele.removeEventListener("mousemove",this.mousemove.bind(this))}mousemove(e){this.currentMoveLocation.x=e.offsetX,this.currentMoveLocation.y=e.offsetY}readLocation(){return Ut(this.currentMoveLocation,this.lastReadLocation)?null:(this.lastReadLocation=Ze(this.currentMoveLocation),Ze(this.lastReadLocation))}};var kn=class{_begin;_end;constructor(e,t){this._begin=e,this._end=t,this._begin>this._end&&([this._end,this._begin]=[this._begin,this._end]),this._end-this._begin<7&&(this._end=this._begin+7)}in(e){return e>=this._begin&&e<=this._end}get begin(){return this._begin}get end(){return this._end}get rangeInDays(){return this._end-this._begin}};var Aa=(n,e,t,r,i,s)=>{let o=lt(n);if(!o.ok)return o;let a=o.value;if(e===null){let C=new Map;for(let A=0;A<n.Vertices.length;A++)C.set(A,A);return h({chartLike:n,displayOrder:o.value,emphasizedTasks:t,spans:r,labels:i,fromFilteredIndexToOriginalIndex:C,fromOriginalIndexToFilteredIndex:C,selectedTaskIndex:s})}let l=[],c=[],u=[],p=[],m=[],T=new Map,S=new Map;n.Vertices.forEach((C,A)=>{if(e(C,A)){l.push(C),p.push(r[A]),m.push(i[A]);let $=l.length-1;S.set(A,$),T.set($,A)}}),n.Edges.forEach(C=>{!S.has(C.i)||!S.has(C.j)||c.push(new se(S.get(C.i),S.get(C.j)))}),a.forEach(C=>{let A=n.Vertices[C];e(A,C)&&u.push(S.get(C))});let P=t.map(C=>S.get(C));return h({chartLike:{Edges:c,Vertices:l},displayOrder:u,emphasizedTasks:P,spans:p,labels:m,fromFilteredIndexToOriginalIndex:T,fromOriginalIndexToFilteredIndex:S,selectedTaskIndex:S.get(s)||-1})};var D={taskLineStart:"taskLineStart",textStart:"textStart",groupTextStart:"groupTextStart",percentStart:"percentStart",verticalArrowDestTop:"verticalArrowDestTop",verticalArrowDestBottom:"verticalArrowDestBottom",horizontalArrowDest:"horizontalArrowDest",verticalArrowStart:"verticalArrowStart",horizontalArrowStart:"horizontalArrowStart",verticalArrowDestToMilestoneTop:"verticalArrowDestToMilestoneTop",verticalArrowDestToMilestoneBottom:"verticalArrowDestToMilestoneBottom",horizontalArrowDestToMilestone:"horizontalArrowDestToMilestone",verticalArrowStartFromMilestoneTop:"verticalArrowStartFromMilestoneTop",verticalArrowStartFromMilestoneBottom:"verticalArrowStartFromMilestoneBottom",horizontalArrowStartFromMilestone:"horizontalArrowStartFromMilestone",groupEnvelopeStart:"groupEnvelopeStart",taskEnvelopeTop:"taskEnvelopeTop",displayRangeTop:"displayRangeTop",taskRowBottom:"taskRowBottom",timeMarkStart:"timeMarkStart",timeMarkEnd:"timeMarkEnd",timeTextStart:"timeTextStart",timeTextStartBefore:"timeTextStartBefore",groupTitleTextStart:"groupTitleTextStart",tasksClipRectOrigin:"tasksClipRectOrigin",groupByOrigin:"groupByOrigin"},Z={taskLineHeight:"taskLineHeight",percentHeight:"percentHeight",arrowHeadHeight:"arrowHeadHeight",arrowHeadWidth:"arrowHeadWidth",milestoneDiameter:"milestoneDiameter",lineDashLine:"lineDashLine",lineDashGap:"lineDashGap",textXOffset:"textXOffset",minTaskWidthPx:"minTaskWidthPx",rowHeight:"rowHeight"},Bl=n=>n%2===0?n+1:n,Tn=class{dayWidthPx;rowHeightPx;blockSizePx;taskHeightPx;lineWidthPx;marginSizePx;timelineHeightPx;origin;totalNumberOfDays;groupByColumnWidthPx;timelineOrigin;tasksOrigin;groupByOrigin;tasksClipRectOrigin;constructor(e,t,r,i=0){this.totalNumberOfDays=r,this.groupByColumnWidthPx=i*e.fontSizePx,this.blockSizePx=Math.floor(e.fontSizePx/3),this.taskHeightPx=this.blockSizePx,this.lineWidthPx=Bl(Math.floor(this.taskHeightPx/3));let s=Math.ceil(this.taskHeightPx/2)+this.lineWidthPx;this.marginSizePx=2*s,this.timelineHeightPx=e.hasTimeline?Math.ceil(e.fontSizePx*4/3):0,this.timelineOrigin=z(s,0),this.groupByOrigin=z(0,s+this.timelineHeightPx);let o=0;e.displayRange===null||e.displayRangeUsage==="highlight"?(this.dayWidthPx=(t-this.groupByColumnWidthPx-2*this.marginSizePx)/r,this.origin=z(0,0)):(this.dayWidthPx=(t-this.groupByColumnWidthPx-2*this.marginSizePx)/e.displayRange.rangeInDays,o=Math.floor(this.dayWidthPx*e.displayRange.begin+this.marginSizePx),this.origin=z(-o+this.marginSizePx,0)),this.tasksOrigin=z(this.groupByColumnWidthPx-o+s,this.timelineHeightPx+s),this.tasksClipRectOrigin=z(this.groupByColumnWidthPx,this.timelineHeightPx),e.hasText?this.rowHeightPx=6*this.blockSizePx:this.rowHeightPx=1.1*this.blockSizePx}height(e){return e*this.rowHeightPx+this.timelineHeightPx+2*this.marginSizePx}dayRowFromPoint(e){return{day:Ne(Math.floor((window.devicePixelRatio*e.x-this.origin.x-this.marginSizePx-this.groupByColumnWidthPx)/this.dayWidthPx),0,this.totalNumberOfDays),row:Math.floor((window.devicePixelRatio*e.y-this.origin.y-this.marginSizePx-this.timelineHeightPx)/this.rowHeightPx)}}taskRowEnvelopeStart(e,t){return re(this.origin,[Math.floor(t*this.dayWidthPx+this.marginSizePx+this.groupByColumnWidthPx),Math.floor(e*this.rowHeightPx+this.marginSizePx+this.timelineHeightPx)])}groupRowEnvelopeStart(e,t){return re(this.groupByOrigin,[0,e*this.rowHeightPx+this.marginSizePx+this.timelineHeightPx])}groupHeaderStart(){return re(this.origin,[this.marginSizePx,this.marginSizePx])}timeEnvelopeStart(e){return re(this.origin,[e*this.dayWidthPx+this.marginSizePx+this.groupByColumnWidthPx,0])}feature(e,t,r){switch(r){case D.taskLineStart:case D.verticalArrowDestTop:case D.verticalArrowStart:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx-this.blockSizePx]);case D.verticalArrowDestBottom:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx]);case D.textStart:return re(this.taskRowEnvelopeStart(e,t),[this.blockSizePx,this.blockSizePx]);case D.groupTextStart:return re(this.groupRowEnvelopeStart(e,t),[this.blockSizePx,this.blockSizePx]);case D.percentStart:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx-this.lineWidthPx]);case D.horizontalArrowDest:case D.horizontalArrowStart:return re(this.taskRowEnvelopeStart(e,t),[0,Math.floor(this.rowHeightPx-.5*this.blockSizePx)-1]);case D.verticalArrowDestToMilestoneTop:return re(this.feature(e,t,D.verticalArrowDestTop),[0,-1*this.metric(Z.milestoneDiameter)]);case D.verticalArrowDestToMilestoneBottom:return re(this.feature(e,t,D.verticalArrowDestTop),[0,this.metric(Z.milestoneDiameter)]);case D.horizontalArrowDestToMilestone:return re(this.feature(e,t,D.horizontalArrowDest),[-1*this.metric(Z.milestoneDiameter),-.5*this.metric(Z.milestoneDiameter)]);case D.verticalArrowStartFromMilestoneTop:return re(this.feature(e,t,D.verticalArrowStart),[0,-1*this.metric(Z.milestoneDiameter)]);case D.verticalArrowStartFromMilestoneBottom:return re(this.feature(e,t,D.verticalArrowStart),[0,this.metric(Z.milestoneDiameter)]);case D.horizontalArrowStartFromMilestone:return re(this.feature(e,t,D.horizontalArrowStart),[this.metric(Z.milestoneDiameter),0]);case D.taskEnvelopeTop:return this.taskRowEnvelopeStart(e,t);case D.groupEnvelopeStart:return this.groupRowEnvelopeStart(e,t);case D.timeMarkStart:return this.timeEnvelopeStart(t);case D.timeMarkEnd:return re(this.timeEnvelopeStart(t),[0,this.rowHeightPx*(e+1)]);case D.timeTextStart:return re(this.timeEnvelopeStart(t),[this.blockSizePx,0]);case D.timeTextStartBefore:return re(this.timeEnvelopeStart(t),[-this.blockSizePx,0]);case D.groupTitleTextStart:return re(this.groupHeaderStart(),[this.blockSizePx,0]);case D.displayRangeTop:return this.timeEnvelopeStart(t);case D.taskRowBottom:return this.taskRowEnvelopeStart(e+1,t);case D.tasksClipRectOrigin:return this.tasksClipRectOrigin;case D.groupByOrigin:return this.groupByOrigin;default:return z(0,0)}}metric(e){switch(e){case Z.taskLineHeight:return this.taskHeightPx;case Z.percentHeight:return this.lineWidthPx;case Z.arrowHeadHeight:return this.taskHeightPx*2;case Z.arrowHeadWidth:return Math.ceil(this.taskHeightPx);case Z.milestoneDiameter:return Math.ceil(this.taskHeightPx);case Z.lineDashLine:return this.blockSizePx;case Z.lineDashGap:return this.blockSizePx;case Z.textXOffset:return this.blockSizePx;case Z.minTaskWidthPx:return this.blockSizePx*10;case Z.rowHeight:return this.rowHeightPx;default:return 0}}};var zl=(n,e)=>e.topLeft.y<=n&&e.bottomRight.y>=n,jl=(n,e)=>e.topLeft.x<=n&&e.bottomRight.x>=n,Di=class{rects;constructor(e){this.rects=e.sort((t,r)=>t.topLeft.y-r.topLeft.y)}hit(e){let t=0,r=this.rects.length-1;for(;t<=r;){let i=Math.floor((t+r)/2);if(zl(e.y,this.rects[i]))return jl(e.x,this.rects[i])?this.rects[i]:null;this.rects[i].topLeft.y<e.y?t=i+1:r=i-1}return null}};var _a=(n,e)=>n.duration===0?e==="down"?D.verticalArrowStartFromMilestoneBottom:D.verticalArrowStartFromMilestoneTop:D.verticalArrowStart,Na=(n,e)=>n.duration===0?e==="down"?D.verticalArrowDestToMilestoneTop:D.verticalArrowDestToMilestoneBottom:e==="down"?D.verticalArrowDestTop:D.verticalArrowDestBottom;var Pa=n=>n.duration===0?D.horizontalArrowDestToMilestone:D.horizontalArrowDest;function Js(n,e,t,r){return t.hasTasks||(r=0),new Tn(t,n.width,e[e.length-1].finish+1).height(r)}function Xs(n,e,t,r,i,s,o=null){let a=lt(r.chart);if(!a.ok)return a;let l=r.chart.Vertices.map((E,x)=>s.taskLabel(x)),c=Aa(r.chart,s.filterFunc,s.taskEmphasize,i,l,s.selectedTaskIndex);if(!c.ok)return c;let u=c.value.chartLike,p=c.value.labels,m=r.getResourceDefinition(s.groupByResource),T=c.value.fromFilteredIndexToOriginalIndex,S=c.value.fromOriginalIndexToFilteredIndex,P=E=>{let x=T.get(E);if(x===void 0)return 0;let b=r.getTaskCompletion(x);if(!b.ok)return 0;let w=b.value;switch(w.stage){case"unstarted":return 0;case"started":return w.percentComplete;case"finished":return 100;default:return 0}},C=s.selectedTaskIndex,A=new Set(c.value.emphasizedTasks);i=c.value.spans;let $=0;s.groupByResource!==""&&s.hasText&&($=s.groupByResource.length,m!==void 0&&m.values.forEach(E=>{$=Math.max($,E.length)}));let nt=i.length,Se=i[i.length-1].finish,O=new Tn(s,e.width,Se+1,$),we=O.metric(Z.taskLineHeight),ge=O.metric(Z.milestoneDiameter),rt=O.metric(Z.percentHeight),Be=O.metric(Z.arrowHeadHeight),de=O.metric(Z.arrowHeadWidth),ve=O.metric(Z.minTaskWidthPx),ze=new Set,be=nc(s,m,u,c.value.displayOrder);if(!be.ok)return be;let Re=be.value.taskIndexToRow,he=be.value.rowRanges;ql(t,s,e),Kl(t,s);let ke=new Path2D,ee=O.feature(0,0,D.tasksClipRectOrigin),pt=e.width-ee.x;ke.rect(ee.x,0,pt,e.height),t.fillStyle=s.colors.get("on-surface"),t.strokeStyle=s.colors.get("on-surface"),he!==null&&(s.hasTasks&&rc(t,O,he,Se,s.colors.get("group-color")),m!==void 0&&s.hasText&&ic(t,s,m,O,he)),t.fillStyle=s.colors.get("on-surface"),t.strokeStyle=s.colors.get("on-surface"),t.save(),t.clip(ke);let Q=new Map,it=[],zt=O.feature(0,Se,D.timeTextStartBefore),Rt=s.durationDisplay(Se),f=t.measureText(Rt);if(zt.x=zt.x-f.width,it.push([zt.x,ee.x+pt]),u.Vertices.forEach((E,x)=>{let b=Re.get(x),w=i[x],R=O.feature(b,w.start,D.taskLineStart),N=O.feature(b,w.finish,D.taskLineStart),L=P(x);t.fillStyle=s.colors.get("on-surface-muted"),t.strokeStyle=s.colors.get("on-surface-muted"),s.drawTimeMarkersOnTasks&&tc(t,b,w.start,E,s,O,ze,it,Se),t.lineWidth=1,A.has(x)?r._status.stage==="started"?L===100?(t.fillStyle=s.colors.get("secondary-variant"),t.strokeStyle=s.colors.get("secondary-variant")):L>0?(t.fillStyle=Ft(t,s.colors.get("secondary"),s.colors.get("surface"),"crosshatch"),t.strokeStyle=s.colors.get("secondary")):(t.fillStyle=Ft(t,s.colors.get("primary"),s.colors.get("surface"),"crosshatch"),t.strokeStyle=s.colors.get("primary")):(t.fillStyle=Ft(t,s.colors.get("primary"),s.colors.get("surface"),"crosshatch"),t.strokeStyle=s.colors.get("primary")):r._status.stage==="started"?L===100?(t.fillStyle=s.colors.get("secondary-variant"),t.strokeStyle=s.colors.get("secondary-variant")):L>0?(t.fillStyle=Ft(t,s.colors.get("secondary"),s.colors.get("surface")),t.strokeStyle=s.colors.get("secondary")):t.fillStyle=Ft(t,s.colors.get("on-surface"),s.colors.get("surface")):(t.fillStyle=Ft(t,s.colors.get("on-surface"),s.colors.get("surface")),t.strokeStyle=s.colors.get("on-surface"));let K=O.feature(b,w.start,D.taskEnvelopeTop),G=O.feature(b+1,w.finish,D.taskEnvelopeTop),[F,pe]=Da(K,G);F<ve&&(G.x=K.x+ve),Q.set(x,{topLeft:K,bottomRight:G,filteredTaskIndex:x}),s.hasTasks&&(R.x===N.x?Zl(t,R,ge,rt):Yl(t,s,R,N,we,L,r._status.stage==="started"),x!==0&&x!==nt-1&&Xl(t,s,O,b,w,E,x,T.get(x),pt,p))}),t.lineWidth=1,t.strokeStyle=s.colors.get("on-surface-muted"),s.hasEdges&&s.hasTasks){let E=[],x=[];u.Edges.forEach(b=>{let w=T.get(b.j);w!==void 0&&s.taskIsStarted(w)||(A.has(b.i)&&A.has(b.j)?E.push(b):x.push(b))}),t.strokeStyle=s.colors.get("on-surface-muted"),Oa(t,s,x,i,u.Vertices,O,Re,de,Be,A),t.strokeStyle=s.colors.get("primary"),Oa(t,s,E,i,u.Vertices,O,Re,de,Be,A)}t.restore(),s.displayRange!==null&&s.displayRangeUsage==="highlight"&&(s.displayRange.begin>0&&La(t,s,O,0,s.displayRange.begin,nt),s.displayRange.end<Se&&La(t,s,O,s.displayRange.end,Se+1,nt)),s.today!==-1&&ec(t,s.today,s.colors,nt,O);let d=null,y=null;if(o!==null){let E=o.getContext("2d"),x=new Di([...Q.values()]),b=-1;d=(R,N)=>{R.x=R.x*window.devicePixelRatio,R.y=R.y*window.devicePixelRatio;let L=x.hit(R),K=L===null?-1:T.get(L.filteredTaskIndex);if(K===0||K===r.chart.Vertices.length-1)return null;if(N==="mousemove"){if(K===b)return K}else if(K===C)return K;N==="mousemove"?b=K:C=K,E.clearRect(0,0,o.width,o.height);let G=Q.get(S.get(b));return G!==void 0&&Ql(E,G.topLeft,G.bottomRight,s.colors.get("primary-variant"),we),G=Q.get(S.get(C)),G!==void 0&&Ia(E,G.topLeft,G.bottomRight,s.colors.get("primary-variant")),K};let w=Q.get(S.get(C));w!==void 0&&Ia(E,w.topLeft,w.bottomRight,s.colors.get("primary-variant"))}Q.forEach(E=>{if(y===null){y=E.topLeft;return}E.topLeft.y<y.y&&(y=E.topLeft)}),s.selectedTaskIndex!==-1&&S.has(s.selectedTaskIndex)&&(y=Q.get(S.get(s.selectedTaskIndex)).topLeft);let M=null;return y!==null&&(M=z(y.x/window.devicePixelRatio,y.y/window.devicePixelRatio)),h({scale:O,updateHighlightFromMousePos:d,selectedTaskLocation:M})}function Oa(n,e,t,r,i,s,o,a,l,c){t.forEach(u=>{let p=r[u.i],m=r[u.j],T=i[u.i],S=i[u.j],P=o.get(u.i),C=o.get(u.j),A=p.finish,$=m.start;c.has(u.i)&&c.has(u.j)?(n.strokeStyle=e.colors.get("primary"),n.fillStyle=e.colors.get("primary")):(n.strokeStyle=e.colors.get("on-surface-muted"),n.fillStyle=e.colors.get("on-surface-muted")),Wl(n,A,$,s,P,T,C,S,a,l)})}function La(n,e,t,r,i,s){let o=t.feature(0,r,D.displayRangeTop),a=t.feature(s,i,D.taskRowBottom);n.fillStyle=e.colors.get("transparent-overlay"),n.fillRect(o.x,o.y,a.x-o.x,a.y-o.y)}function Wl(n,e,t,r,i,s,o,a,l,c){e===t?Jl(n,r,i,e,s,o,t,a,l,c):Gl(n,r,i,e,s,o,a,t,c,l)}function ql(n,e,t){n.fillStyle=e.colors.get("background"),n.strokeStyle=e.colors.get("on-background"),n.fillRect(0,0,t.width,t.height)}function Kl(n,e){n.font=`${e.fontSizePx}px serif`}function Gl(n,e,t,r,i,s,o,a,l,c){n.beginPath();let u=t<s?"down":"up",p=e.feature(t,r,_a(i,u)),m=e.feature(s,r,Pa(o));n.moveTo(p.x+.5,p.y),n.lineTo(p.x+.5,m.y);let T=m,S=e.feature(s,a,Pa(o));n.moveTo(p.x+.5,T.y),n.lineTo(S.x+.5,S.y),n.stroke(),n.beginPath(),n.moveTo(S.x+.5,S.y),n.lineTo(S.x-l+.5,S.y+c),n.lineTo(S.x-l+.5,S.y-c),n.fill()}function Jl(n,e,t,r,i,s,o,a,l,c){let u=t<s?"down":"up",p=e.feature(t,r,_a(i,u)),m=e.feature(s,o,Na(a,u));n.beginPath(),n.moveTo(p.x+.5,p.y),n.lineTo(m.x+.5,m.y),n.stroke(),n.beginPath();let T=u==="down"?-c:c;n.moveTo(m.x+.5,m.y),n.lineTo(m.x-l+.5,m.y+T),n.lineTo(m.x+l+.5,m.y+T),n.fill()}function Xl(n,e,t,r,i,s,o,a,l,c){if(!e.hasText)return;let u=c[o],p=i.start,m=0;e.displayRange!==null&&e.displayRangeUsage==="restrict"&&(e.displayRange.in(i.start)?(p=i.start,m=0):e.displayRange.in(i.finish)?(p=i.finish,m=-n.measureText(u).width-2*t.metric(Z.textXOffset)):i.start<e.displayRange.begin&&i.finish>e.displayRange.end&&(p=e.displayRange.begin,m=l/2)),n.lineWidth=1,n.fillStyle=e.colors.get("on-surface"),n.textBaseline="top";let T=t.feature(r,p,D.textStart);n.fillText(u,T.x+m,T.y)}function Yl(n,e,t,r,i,s,o){n.fillRect(t.x,t.y,r.x-t.x,i),n.strokeRect(t.x,t.y,r.x-t.x,i),o&&s!==100&&(n.fillStyle=e.colors.get("secondary"),n.strokeStyle=e.colors.get("secondary"),n.fillRect(t.x,t.y,(r.x-t.x)*s/100,i))}function Ql(n,e,t,r,i){n.strokeStyle=r,n.lineWidth=i,n.strokeRect(e.x,e.y,t.x-e.x,t.y-e.y)}function Ia(n,e,t,r){n.fillStyle=r,n.fillRect(e.x,e.y,t.x-e.x,t.y-e.y)}function Zl(n,e,t,r){n.beginPath(),n.lineWidth=r/2,n.moveTo(e.x,e.y-t),n.lineTo(e.x+t,e.y),n.lineTo(e.x,e.y+t),n.lineTo(e.x-t,e.y),n.closePath(),n.stroke()}var ec=(n,e,t,r,i)=>{let s=i.feature(0,e,D.timeMarkStart),o=i.feature(r+1,e,D.taskEnvelopeTop);n.beginPath(),n.lineWidth=i.metric("percentHeight"),n.strokeStyle=t.get("error"),n.setLineDash([n.lineWidth*2,n.lineWidth*2]),n.moveTo(s.x,s.y),n.lineTo(o.x,o.y),n.stroke()},tc=(n,e,t,r,i,s,o,a,l)=>{if(o.has(t))return;o.add(t);let c=s.feature(e,t,D.timeMarkStart);if(t!==l&&a.findIndex(([A,$])=>c.x>=A&&c.x<=$)!==-1)return;let u=s.feature(e,t,Na(r,"down"));n.lineWidth=.5,n.strokeStyle=i.colors.get("on-surface-muted"),n.moveTo(c.x+.5,c.y),n.lineTo(c.x+.5,u.y),n.stroke(),n.setLineDash([]),n.fillStyle=i.colors.get("on-surface"),n.textBaseline="top";let p=i.durationDisplay(t),m=n.measureText(p),T=s.feature(e,t,D.timeTextStart),S=T.x;t===l?(T=s.feature(e,t,D.timeTextStartBefore),T.x=T.x-m.width):S+=m.width;let P=T.x,C=T.x+m.width;i.hasText&&i.hasTimeline&&(t===l||a.findIndex(([A,$])=>P<=A&&C>=A||P<=$&&C>=$)===-1)&&(n.fillText(`${p}`,T.x,T.y),a.push([P,S]))},nc=(n,e,t,r)=>{let i=new Map(r.map((m,T)=>[m,T]));if(e===void 0)return h({taskIndexToRow:i,rowRanges:null,resourceDefinition:null});let s=0,o=t.Vertices.length-1,a=[s,o],l=new Map;r.forEach(m=>{let T=t.Vertices[m].getResource(n.groupByResource)||"",S=l.get(T)||[];S.push(m),l.set(T,S)});let c=new Map;c.set(0,0);let u=1,p=new Map;return e.values.forEach((m,T)=>{let S=u;(l.get(m)||[]).forEach(P=>{a.includes(P)||(c.set(P,u),u++)}),p.set(T,{start:S,finish:u})}),c.set(o,u),h({taskIndexToRow:c,rowRanges:p,resourceDefinition:e})},rc=(n,e,t,r,i)=>{n.fillStyle=i;let s=0;t.forEach(o=>{let a=e.feature(o.start,0,D.groupEnvelopeStart),l=e.feature(o.finish,r+1,D.taskEnvelopeTop);s++,s%2!=1&&n.fillRect(a.x,a.y,l.x-a.x,l.y-a.y)})},ic=(n,e,t,r,i)=>{i&&(n.lineWidth=1),n.fillStyle=e.colors.get("on-surface");let s=r.feature(0,0,D.groupByOrigin);e.hasTimeline&&(n.textBaseline="bottom",n.fillText(e.groupByResource,s.x,s.y)),e.hasTasks&&(n.textBaseline="top",i.forEach((o,a)=>{if(o.start===o.finish)return;let l=r.feature(o.start,0,D.groupTextStart);n.fillText(t.values[a],l.x,l.y)}))},$a=new Map,Vt=8,Ft=(n,e,t,r="singlehash")=>{let i=`${e}:${t}`,s=$a.get(i);if(s!==void 0)return s;let o=document.createElement("canvas");o.width=Vt,o.height=Vt;let a=o.getContext("2d");return a.fillStyle=t,a.fillRect(0,0,o.width,o.height),a.strokeStyle=e,a.lineWidth=1,a.moveTo(0,Vt),a.lineTo(Vt,0),r==="crosshatch"&&(a.moveTo(0,0),a.lineTo(Vt,Vt)),a.stroke(),s=n.createPattern(o,"repeat"),$a.set(i,s),s};var sc=["primary","on-primary","primary-variant","on-primary-variant","secondary","secondary-variant","on-secondary","background","on-background","surface","on-surface","on-surface-muted","surface-1dp","surface-2dp","disabled","on-disabled","error","on-error","transparent-overlay","group-color"],yn=class{values=new Map;_fontSize=14;loadFromElement(e){let t=getComputedStyle(e);sc.forEach(r=>{this.values.set(r,t.getPropertyValue(`--${r}`))}),this._fontSize=+t.getPropertyValue("font-size").split("px")[0]*window.devicePixelRatio*1.8,this._fontSize===0&&(this._fontSize=24)}fontSize(){return this._fontSize}get(e){return this.values.get(e)||""}};var wt=["Fred","Barney","Wilma","Betty"],Ha=["low","moderate","high"],oc=50,et=n=>Math.floor(Math.random()*n),Ys=()=>et(oc),Qs=()=>Ha[et(Ha.length)],Va=()=>{let n=new Ue,e=$i([Gn(0),He("Uncertainty","low",1)],n);return _(e),n},Fa=()=>{let n=new Ue,e=[Ur("Person")];wt.forEach(i=>{e.push(Vr("Person",i))}),e.push(Fr("Person","")),e.push(On("Cost ($/hr)",new $e(15,new ce(0))),Mo(0),Pt("Duration",Ys(),1),It(1,Zs()),He("Person",wt[et(wt.length)],1),He("Uncertainty",Qs(),1));let t=1;for(let i=0;i<20;i++){let s=et(t)+1;e.push(Wn(s),Pt("Duration",Ys(),s+1),It(s+1,Zs()),He("Person",wt[et(wt.length)],s+1),He("Uncertainty",Qs(),s+1)),t++,s=et(t)+1,e.push(qn(s),Pt("Duration",Ys(),s+1),It(s+1,Zs()),He("Person",wt[et(wt.length)],s+1),He("Uncertainty",Qs(),s+1)),t++}let r=$i(e,n);return _(r),n},eo=["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","sed","do","eiusmod","tempor","incididunt","ut","labore","et","dolore","magna","aliqua","ut","enim","ad","minim","veniam","quis","nostrud","exercitation","ullamco","laboris","nisi","ut","aliquip","ex","ea","commodo","consequat","euis","aute","irure","dolor","in","reprehenderit","in","voluptate","velit","esse","cillum","dolore","eu","fugiat","nulla","pariatur","excepteur","sint","occaecat","cupidatat","non","proident","sunt","in","culpa","qui","officia","deserunt","mollit","anim","id","est","laborum"],Ua=eo.length,Zs=()=>`${eo[et(Ua)]} ${eo[et(Ua)]}`;var xn=new Uint8Array([137,80,78,71,13,10,26,10]),tt=class n{static textDecoder=new TextDecoder;static textEncoder=new TextEncoder;static isPNG(e){let t=new Uint8Array(e.slice(0,8));return t.byteLength<8?!1:t.every((r,i)=>r===xn[i])}static splitChunks(e){let t=new DataView(e instanceof ArrayBuffer?e:e.buffer),r=xn.length,i=[];for(;r<t.byteLength&&!(r+8>t.byteLength);){let s=t.getUint32(r);r+=4;let o=n.textDecoder.decode(new Uint8Array(e.slice(r,r+4)));if(r+=4,r+s+4>t.byteLength)break;let a=new Uint8Array(e.slice(r,r+s));r+=s;let l=t.getUint32(r);r+=4,i.push({size:s,type:o,data:a,crc:l})}return i}static joinChunks(e){let t=xn.length+e.reduce((a,l)=>a+12+l.size,0),r=new ArrayBuffer(t),i=new DataView(r),s=new Uint8Array(r);s.set(xn,0);let o=xn.length;for(let a of e)i.setUint32(o,a.size),o+=4,s.set(n.textEncoder.encode(a.type),o),o+=4,s.set(a.data,o),o+=a.size,i.setUint32(o,a.crc),o+=4;return r}static createChunk(e,t){let r=n.textEncoder.encode(e),i=n.crc32(new Uint8Array([...r,...t]));return{size:t.length,type:e,data:t,crc:i}}static crc32(e){let t=-1;for(let r=0;r<e.length;r++)t=t>>>8^n.crcTable[(t^e[r])&255];return(t^-1)>>>0}static crcTable=(()=>{let e=new Array(256);for(let t=0;t<256;t++){let r=t;for(let i=0;i<8;i++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e})()};var Bt=[97,112,112,108,105,99,97,116,105,111,110,47,118,110,100,46,101,120,112,108,97,110,46,111,114,103,43,106,115,111,110,0],Ba=async(n,e)=>{let t=new Uint8Array(await e.arrayBuffer()),r=tt.splitChunks(t),i=new TextEncoder().encode(ac(n)),s=new Uint8Array(new ArrayBuffer(Bt.length+i.length));s.set(Bt,0),s.set(i,Bt.length);let o=tt.createChunk("tEXt",s);return r.splice(-1,0,o),new Blob([tt.joinChunks(r)])},za=async n=>{let t=tt.splitChunks(n).filter(i=>i.type==="tEXt").filter(i=>i.data.slice(0,Bt.length).every((s,o)=>s===Bt[o]));if(t.length===0)return v(new Error("No tEXt chunks found."));let r=t[0].data.slice(Bt.length);return h(lc(new TextDecoder().decode(r)))},ac=n=>btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(parseInt(t,16)))),lc=n=>decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));var ja="explan-radar-visible",Wa=()=>window.localStorage.getItem(ja)!=="0",qa=n=>window.localStorage.setItem(ja,n?"1":"0");var cc=32,uc=100,Ka=1e3,to=class extends HTMLElement{plan=new Ue;spans=[];criticalPath=[];displayRange=null;radarScale=null;groupBySelection="";selectedTask=-1;topTimeline=!1;criticalPathsOnly=!1;focusOnTask=!1;mouseMove=null;dependenciesPanel=null;downloadLink=null;selectedTaskPanel=null;taskCompletionPanel=null;alternateTaskDurations=null;simulationPanel=null;_imageExportWidthPx=Ka;_imageExportBackgroundTransparent=!1;updateHighlightFromMousePos=null;connectedCallback(){this.simulationPanel=this.querySelector("simulation-panel"),this.simulationPanel.addEventListener("simulation-select",l=>{this.alternateTaskDurations=l.detail.durations,this.criticalPath=l.detail.criticalPath,this.recalculateSpansAndCriticalPath(),this.paintChart()}),this.downloadLink=this.querySelector("#download-link"),this.querySelector("#download-button").addEventListener("click",async()=>await this.prepareDownload()),this.querySelector("#download-json").addEventListener("click",async()=>await this.prepareJSONDownload()),this.querySelector("#catchup").addEventListener("click",async()=>await this.catchUp()),this.querySelector("#reset-zoom").addEventListener("click",()=>ue("ResetZoomAction",this)),this.dependenciesPanel=this.querySelector("dependencies-panel"),this.dependenciesPanel.addEventListener("add-dependency",async l=>{let c="AddPredecessorAction";l.detail.depType==="succ"&&(c="AddSuccessorAction");let u=await ue(c,this);_(u)}),this.dependenciesPanel.addEventListener("delete-dependency",async l=>{let[c,u]=[l.detail.taskIndex,this.selectedTask];l.detail.depType==="succ"&&([c,u]=[u,c]);let p=Po(c,u),m=await Y(p,"planDefinitionChanged",!0,this);_(m)}),this.selectedTaskPanel=this.querySelector("selected-task-panel"),this.selectedTaskPanel.addEventListener("task-name-change",async l=>{let c=It(l.detail.taskIndex,l.detail.name);_(await Y(c,"planDefinitionChanged",!0,this))}),this.selectedTaskPanel.addEventListener("task-resource-value-change",async l=>{let{name:c,value:u,taskIndex:p}=l.detail,m=He(c,u,p);_(await Y(m,"planDefinitionChanged",!0,this))}),this.selectedTaskPanel.addEventListener("task-metric-value-change",async l=>{let{name:c,value:u,taskIndex:p}=l.detail,m=Pt(c,u,p);_(await Y(m,"planDefinitionChanged",!0,this))}),this.taskCompletionPanel=this.querySelector("task-completion-panel");let e=this.querySelector("#radar");new wi(e),e.addEventListener(Gs,this.dragRangeHandler.bind(this));let t=this.querySelector("vertical-divider");new Si(document.body,t,"column"),document.body.addEventListener(Ks,l=>{this.style.setProperty("grid-template-columns",`calc(${l.detail.before}% - 15px) 10px auto`),this.paintChart()}),this.querySelector("#dark-mode-toggle").addEventListener("click",()=>{ue("ToggleDarkModeAction",this)}),Ho();let r=this.querySelector("#radar-toggle"),i=Wa();r.checked=i,this.setRadar(i),r.addEventListener("input",l=>{let c=l.target.checked;qa(c),this.setRadar(c)}),this.querySelector("#critical-paths-toggle").addEventListener("input",l=>{this.criticalPathsOnly=l.target.checked,this.paintChart()});let s=this.querySelector("#overlay");this.mouseMove=new Ri(s),window.requestAnimationFrame(this.onMouseMove.bind(this)),s.addEventListener("click",l=>{let c=z(l.offsetX,l.offsetY);this.updateHighlightFromMousePos!==null&&this.setSelection(this.updateHighlightFromMousePos(c,"mousedown")||-1,!1)}),s.addEventListener("dblclick",l=>{let c=z(l.offsetX,l.offsetY);if(this.updateHighlightFromMousePos!==null){let u=this.updateHighlightFromMousePos(c,"mousedown")||-1;u===-1&&ue("ResetZoomAction",this),this.setSelection(u,!0,!0)}});let o=document.querySelector("#file-upload");o.addEventListener("change",async()=>{let c=await o.files[0].arrayBuffer(),u=await this.fromUint8Array(new Uint8Array(c));_(u)}),this.querySelector("#simulate").addEventListener("click",()=>{this.recalculateSpansAndCriticalPath();let l=new Set;this.plan.chart.Vertices.filter((c,u)=>{this.plan.taskCompletion[c.id]?.stage==="finished"&&l.add(u)}),this.criticalPath=this.simulationPanel.simulate(this.plan,uc,this.criticalPath,l),this.paintChart()}),this.querySelector("edit-resources-panel").setConfig(this),this.querySelector("plan-config-panel").setConfig(this),this.querySelector("edit-metrics-panel").setConfig(this),this.querySelector("image-export-panel").setConfig(this);let a=this.querySelector("groupby-control");a.setConfig(this),a.addEventListener("group-by-resource-changed",l=>{this.groupBySelection=l.detail,this.planDefinitionHasBeenChanged()}),this.plan=Va(),this.updateTaskPanels(this.selectedTask),this.planDefinitionHasBeenChanged(),window.addEventListener("resize",()=>this.paintChart()),zo(this),console.log("Finished Init"),document.dispatchEvent(new CustomEvent("finished-init"))}get imageExportWidthPx(){let e=window.localStorage.getItem("imageExportWidthPx")||"";return e===""?Ka:+e}set imageExportWidthPx(e){window.localStorage.setItem("imageExportWidthPx",e.toString())}get imageExportBackgroundTransparent(){return(window.localStorage.getItem("imageExportBackgroundTransparent")||"")==="true"}set imageExportBackgroundTransparent(e){window.localStorage.setItem("imageExportBackgroundTransparent",e.toString())}toggleTopTimeline(){this.topTimeline=!this.topTimeline,this.paintChart()}async prepareDownload(){let e=await this.toPNG();if(!e.ok){_(e);return}let t=e.value;this.downloadLink.href=URL.createObjectURL(t),this.downloadLink.download="plan.png",this.downloadLink.click()}async catchUp(){let e=this.getToday();if(!e.ok){_(e);return}let t=await Y(Oo(e.value,this.spans),"planDefinitionChanged",!0,this);_(t)}async prepareJSONDownload(){let e=new Blob([JSON.stringify(this.plan,null,"  ")],{type:"application/json"});this.downloadLink.href=URL.createObjectURL(e),this.downloadLink.download="plan.json",this.downloadLink.click()}async undo(){let e=await ue("UndoAction",this);_(e)}async redo(){let e=await ue("RedoAction",this);_(e)}embedded(){jo(),document.querySelector("#download-controls").classList.add("hidden"),document.querySelector("#upload").classList.add("hidden"),vo("DocumentEvent")}toJSON(){return JSON.stringify(this.plan,null,"  ")}fromJSON(e){let t=Ue.FromJSONText(e);return t.ok?(this.plan=t.value,this.planDefinitionHasBeenChanged(),h(null)):t}async fromUint8Array(e){let t="";if(tt.isPNG(e)){let i=await za(new Uint8Array(e));if(!i.ok)return i;t=i.value}else t=new TextDecoder("utf-8").decode(e);let r=this.fromJSON(t);return r.ok?h(null):r}async toUnit8Array(e){if(e==="image/png"){let t=await this.toPNG();return t.ok?h(new Uint8Array(await t.value.arrayBuffer())):t}return h(new TextEncoder().encode(this.toJSON()))}async toPNG(){let e=await this.renderChartToPNG();return e.ok?h(await Ba(this.toJSON(),e.value)):e}async renderChartToPNG(){let e=document.createElement("canvas");e.width=this.imageExportWidthPx;let t=new yn;t.loadFromElement(document.body),this.imageExportBackgroundTransparent&&t.values.set("background","rgba(0,0,0,0)");let r=m=>this.plan.durationUnits.displayTime(m),i=m=>{let T=this.plan.getTaskCompletion(m);return T.ok?T.value.stage!=="unstarted":!1},s={fontSizePx:16,hasText:!0,displayRange:null,displayRangeUsage:"restrict",colors:t,hasTimeline:!0,hasTasks:!0,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:null,groupByResource:"",highlightedTask:null,selectedTaskIndex:-1,durationDisplay:r,taskIsStarted:i,today:-1},o=Js(e,this.spans,s,this.plan.chart.Vertices.length+2);e.height=o;let a=e.getContext("2d"),l=Xs(null,e,a,this.plan,this.spans,s,null);if(!l.ok)return v(l.error);let c,u,p=new Promise((m,T)=>{c=m,u=T});return e.toBlob(m=>{m===null?u():c(m)},"image/png"),h(await p)}updateTaskPanels(e){this.selectedTask=e,this.selectedTaskPanel.updateSelectedTaskPanel(this,this.selectedTask),this.taskCompletionPanel.update(this,this.selectedTask,this.spans[this.selectedTask]);let t=qe(this.plan.chart.Edges);this.dependenciesPanel.setTasksAndIndices(this.plan.chart.Vertices,(t.byDst.get(e)||[]).map(r=>r.i).reverse(),(t.bySrc.get(e)||[]).map(r=>r.j).reverse()),this.dependenciesPanel.classList.toggle("hidden",this.selectedTask===-1)}setSelection(e,t,r=!1){this.selectedTask=e,t&&this.forceFocusOnTask(),this.selectedTask===-1&&(this.focusOnTask=!1),this.paintChart(r),this.updateTaskPanels(this.selectedTask)}onMouseMove(){let e=this.mouseMove.readLocation();e!==null&&this.updateHighlightFromMousePos!==null&&this.updateHighlightFromMousePos(e,"mousemove"),window.requestAnimationFrame(this.onMouseMove.bind(this))}planDefinitionHasBeenChanged(){this.radarScale=null,this.displayRange=null,this.alternateTaskDurations=null,this.recalculateSpansAndCriticalPath(),this.paintChart(),this.querySelector("#catchup").classList.toggle("hidden",this.plan.status.stage!=="started"),document.dispatchEvent(new CustomEvent("plan-definition-changed"))}getTaskDurationFunc(){return this.alternateTaskDurations!==null?e=>this.alternateTaskDurations[e]:e=>this.plan.chart.Vertices[e].duration}recalculateSpansAndCriticalPath(){let e=[],t=this.plan.getStaticMetricDefinition("Duration").precision.rounder(),r=o=>{let a=this.plan.getTaskCompletion(o);if(!a.ok)return;let l=a.value;switch(l.stage){case"unstarted":return;case"started":return l.start;case"finished":return l.span.start;default:break}},i=o=>{let a=this.plan.getTaskCompletion(o);if(!a.ok)return;let l=a.value;switch(l.stage){case"unstarted":return;case"started":return;case"finished":return l.span.finish;default:break}},s=$n(this.plan.chart,this.getTaskDurationFunc(),t,r,i);s.ok?e=s.value:console.error(s),this.spans=e.map(o=>o.early),this.criticalPath=_n(e,t),this.updateTaskPanels(this.selectedTask)}getTaskLabeller(){return e=>`${this.plan.chart.Vertices[e].name}`}dragRangeHandler(e){if(this.radarScale===null)return;let t=this.radarScale.dayRowFromPoint(e.detail.begin),r=this.radarScale.dayRowFromPoint(e.detail.end);this.displayRange=new kn(t.day,r.day),this.paintChart()}toggleRadar(){this.querySelector("radar-parent").classList.toggle("hidden")}setRadar(e){this.querySelector("radar-parent").classList.toggle("hidden",!e),this.querySelector("#reset-zoom").classList.toggle("hidden",!e)}toggleCriticalPathsOnly(){this.criticalPathsOnly=!this.criticalPathsOnly}forceFocusOnTask(){this.focusOnTask=!0}getToday(){return this.plan.status.stage!=="started"?v(new Error("Plan is not started.")):this.plan.durationUnits.kind()=="Unitless"?v(new Error("Unitless plans have no start date.")):this.plan.durationUnits.dateStringToDuration(new Date().toISOString().slice(0,10))}paintChart(e=!1){let t=new yn;t.loadFromElement(document.body);let r=null,i=[0,this.plan.chart.Vertices.length-1];if(this.criticalPathsOnly){let S=new Set(this.criticalPath);r=(P,C)=>i.includes(C)?!0:S.has(C)}else if(this.focusOnTask&&this.selectedTask!=-1){let S=new Set;S.add(this.selectedTask);let P=this.spans[this.selectedTask].start,C=this.spans[this.selectedTask].finish;this.plan.chart.Edges.forEach(A=>{A.i===this.selectedTask&&(S.add(A.j),C<this.spans[A.j].finish&&(C=this.spans[A.j].finish)),A.j===this.selectedTask&&(S.add(A.i),P>this.spans[A.i].start&&(P=this.spans[A.i].start))}),this.displayRange=new kn(P-1,C+1),r=(A,$)=>i.includes($)?!0:S.has($)}let s=S=>this.plan.durationUnits.displayTime(S),o=S=>{let P=this.plan.getTaskCompletion(S);return P.ok?P.value.stage!=="unstarted":!1},a=-1,l=this.getToday();l.ok&&(a=l.value);let c={fontSizePx:6,hasText:!1,displayRange:this.displayRange,displayRangeUsage:"highlight",colors:t,hasTimeline:!1,hasTasks:!0,hasEdges:!1,drawTimeMarkersOnTasks:!1,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:null,groupByResource:this.groupBySelection,highlightedTask:null,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},u={fontSizePx:t.fontSize(),hasText:!0,displayRange:this.displayRange,displayRangeUsage:"restrict",colors:t,hasTimeline:this.topTimeline,hasTasks:!0,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:r,groupByResource:this.groupBySelection,highlightedTask:1,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},p={fontSizePx:t.fontSize(),hasText:!0,displayRange:this.displayRange,displayRangeUsage:"restrict",colors:t,hasTimeline:!0,hasTasks:!1,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:r,groupByResource:this.groupBySelection,highlightedTask:null,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},m=this.paintOneChart("#radar",c);if(!m.ok)return;this.radarScale=m.value.scale,this.paintOneChart("#timeline",p);let T=this.paintOneChart("#zoomed",u,"#overlay");if(T.ok&&(this.updateHighlightFromMousePos=T.value.updateHighlightFromMousePos,T.value.selectedTaskLocation!==null&&e)){let S=0;this.focusOnTask||(S=T.value.selectedTaskLocation.y),document.querySelector("chart-parent").scrollTo({top:S,left:0,behavior:"smooth"})}}prepareCanvas(e,t,r,i,s){e.width=t,e.height=r,e.style.width=`${i}px`,e.style.height=`${s}px`;let o=e.getContext("2d");return o.imageSmoothingEnabled=!1,o}paintOneChart(e,t,r=""){let i=this.querySelector(e),s=i.parentElement,o=window.devicePixelRatio,a=s.clientWidth-cc,l=s.clientHeight,c=Math.ceil(a*o),u=Math.ceil(l*o),p=Js(i,this.spans,t,this.plan.chart.Vertices.length+2);u=p,l=p/window.devicePixelRatio;let m=null;r&&(m=document.querySelector(r),this.prepareCanvas(m,c,u,a,l));let T=this.prepareCanvas(i,c,u,a,l);return Xs(s,i,T,this.plan,this.spans,t,m)}};customElements.define("explan-main",to);var no=class extends HTMLElement{explanMain=null;render(){H(this.template(),this)}template(){let[e,t]=Fo();return k`
      <dialog>
        <button @click=${()=>this.generateRandomPlan()}>Generate</button>
        <button @click=${()=>this.explanMain.toggleTopTimeline()}>
          Toggle Top Timeline
        </button>
        <section>
          <h3>Undo</h3>
          <ul>
            ${e.map(r=>k`<li>${r.description}</li>`)}
          </ul>
          <h3>Redo</h3>
          <ul>
            ${t.map(r=>k`<li>${r.description}</li>`)}
          </ul>
        </section>
        <div class="dialog-footer">
          <button @click=${()=>this.cancel()}>Close</button>
        </div>
      </dialog>
    `}generateRandomPlan(){this.explanMain.plan=Fa(),this.explanMain.planDefinitionHasBeenChanged()}cancel(){this.querySelector("dialog").close()}showDialog(e){this.explanMain=e,this.render(),this.querySelector("dialog").showModal()}};customElements.define("developer-panel",no);})();
/*! Bundled license information:

lit-html/lit-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/live.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/unsafe-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/

    </script>
    
    <div id="extensions"></div>
  </body>
</html>

    